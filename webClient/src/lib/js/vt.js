/*
 This program and the accompanying materials are
 made available under the terms of the Eclipse Public License v2.0 which accompanies
 this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html

 SPDX-License-Identifier: EPL-2.0

 Copyright Contributors to the Zowe Project.
*/
! function(exports) {if(!window.COM_RS_COMMON_LOGGER){window.COM_RS_COMMON_LOGGER=function(){console.log("Fallback logger loaded because common logger not found.")};var t=function(t){arguments.length>1&&(t=arguments[1]),console.log(t)};window.COM_RS_COMMON_LOGGER.makeComponentLogger=function(){return{info:t,warn:t,log:t,debug:t,severe:t}}}var e=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core");const i=1011,s=1001,n=4999,l=4001,h="Lucida Console, Monaco, monospace",r=240,u=241,o=243,a=244,c=245,f=242,d=247,w=249,A=250,p=251,b=252,k=253,C=254,m=255,v=0,S=1,g=3,E=5,y=6,D=24,R=25,T=29,M=31,P=32,F=33,x=34,I=35,N=36,L=38,U=39,B=40,O=46,V=1,H=2,Q=4,_=8,K=15,W=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],z=3,G=[11,1,0],q=2,j=[4,5],Z=["Cursor Up","Cursor Right","Rapid Right","Cursor Down","Cursor Left","Rapid Left","Tab","Home","End","New Line","Backspace","Back Tab"],J=1,X=2,Y=3,$=4,tt=5,et=6,it=7,st=8,nt=273,lt={Copy:273,Paste:273},ht=1,rt=0,ut=0,ot=1,at=2,ct=80,ft=77,dt=66,wt=65,At=42,pt=112,bt=63,kt=43,Ct=9,mt=88,vt=[88,32,91,93],St=1,gt=[88,32,60,45,111,45,62],Et=2,yt=3,Dt=[88,32,45,102],Rt=94,Tt=53,Mt=[43,67,82],Pt=74,Ft=47,xt=4,It=[88,32,80,114,111,103,32],Nt=[55,53,48],Lt=[55,53,50],Ut=[55,53,51],Bt=[55,54,51],Ot=["750","752","753","763"],Vt=1,Ht=2,Qt=4,_t=8,Kt=16,Wt=32,zt=64,Gt=128,qt=256,jt=0,Zt=1,Jt=2,Xt=16,Yt=64,$t=1,te=0,ee=1,ie=2,se=3,ne={A:[27,80],C:[27,91],S:[27,92]},le={A:[144],C:[155],S:[156]},he=0,re=1,ue=2,oe=3,ae=59,ce=49,fe=50,de=54,we=55,Ae=56,pe=57,be=[49,53],ke=[49,56],Ce=[49,57],me=[50,49],ve=[63,54,99],Se=[63,54,50,59,49,59,50,59,54,59,55,59,56,59,57,99],ge=[63,54,51,59,49,59,50,59,54,59,55,59,56,59,57,99],Ee=[63,54,52,59,49,59,50,59,54,59,55,59,56,59,57,59,be,59,ke,59,...be,59,...ke,59,...Ce,59,...me,99],ye=[62,49,59,50,48,59,48,99],De=[62,50,52,59,50,48,59,48,99],Re=[62,52,49,59,50,48,59,48,99],Te=[[27,91,91,65],[27,91,91,66],[27,91,91,67],[27,91,91,68],[27,91,91,69],[27,91,91,70],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,51,52,126]],Me=[[27,91,49,49,126],[27,91,49,50,126],[27,91,49,51,126],[27,91,49,52,126],[27,91,49,53,126],[27,91,49,55,126],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,51,52,126]],Pe={"Cursor Up":[[27,91,65],[27,79,65],[27,65]],"Cursor Down":[[27,91,66],[27,79,66],[27,66]],"Cursor Right":[[27,91,67],[27,79,67],[27,67]],"Cursor Left":[[27,91,68],[27,79,68],[27,68]]},Fe={0:[27,79,112],1:[27,79,113],2:[27,79,114],3:[27,79,115],4:[27,79,116],5:[27,79,117],6:[27,79,118],7:[27,79,119],8:[27,79,120],9:[27,79,121],"+":[27,79,108],".":[27,79,110]},xe={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:Me[0],PF01:Me[0],PF2:[27,79,81],F2:Me[1],PF02:Me[1],PF3:[27,79,82],F3:Me[2],PF03:Me[2],PF4:[27,79,83],F4:Me[3],PF04:Me[3],F5:Me[4],PF05:Me[4],F6:Me[5],PF06:Me[5],F7:Me[6],PF07:Me[6],F8:Me[7],PF08:Me[7],F9:Me[8],PF09:Me[8],F10:Me[9],PF10:Me[9],F11:Me[10],PF11:Me[10],F12:Me[11],PF12:Me[11],F13:Me[12],PF13:Me[12],F14:Me[13],PF14:Me[13],F15:Me[14],PF15:Me[14],F16:Me[15],PF16:Me[15],F17:Me[16],PF17:Me[16],F18:Me[17],PF18:Me[17],F19:Me[18],PF19:Me[18],F20:Me[19],PF20:Me[19],"Page Up":[21],"Page Down":[22],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[1],End:[5],Insert:[27,91,50,126],Find:[27,91,49,126],"Insert Here":[27,91,50,126],Remove:[27,91,51,126],Select:[27,91,52,126],Prev:[27,91,53,126],Next:[27,91,54,126]},Ie={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:Te[0],PF01:Te[0],PF2:[27,79,81],F2:Te[1],PF02:Te[1],PF3:[27,79,82],F3:Te[2],PF03:Te[2],PF4:[27,79,83],F4:Te[3],PF04:Te[3],F05:Te[4],PF05:Te[4],F06:Te[5],PF06:Te[5],F07:Te[6],PF07:Te[6],F08:Te[7],PF08:Te[7],F09:Te[8],PF09:Te[8],F10:Te[9],PF10:Te[9],F11:Te[10],PF11:Te[10],F12:Te[11],PF12:Te[11],F13:Te[12],PF13:Te[12],F14:Te[13],PF14:Te[13],F15:Te[14],PF15:Te[14],F16:Te[15],PF16:Te[15],F17:Te[16],PF17:Te[16],F18:Te[17],PF18:Te[17],F19:Te[18],PF19:Te[18],F20:Te[19],PF20:Te[19],"Page Up":[27,91,53,126],"Page Down":[27,91,54,126],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[27,91,49,126],End:[27,91,52,126],Insert:[27,91,50,126]},Ne={"Set Mode 7800":[27,91,49,113],"Set Mode 7700":[27,91,50,113],"Set Mode 7300":[27,91,51,113],"Set Mode 8300":[27,91,52,113],"Set Mode Ansi":[27,91,53,113],"Save Cursor":[27,91,115],"Restore Cursor":[27,91,117],"Device Status":[27,91,110],"Scrolling Region":[27,91,114],"Set Graphic Rendition":[27,91,109],"End Host Print":[27,91,52,105],"Start Host Print":[27,91,53,105],"Cursor Position":[27,91,72],"Erase Data":[27,91,74],"Erase Line":[27,91,75],"Insert Line":[27,91,76],"Delete Line":[27,91,77],"Erase Area":[27,91,79],"Scroll Up":[27,91,83],"Scroll Down":[27,91,84],"Insert Character":[27,91,64],"Device Attributes":[27,91,99],"Hor/Vertical Position":[27,91,102],"Tab Clear":[27,91,103],"Set Mode":[27,91,104]},Le=0,Ue=1,Be=0,Oe=1,Ve=2,He=3,Qe=15,_e="innerScrolling",Ke="scrollingDiv",We="Inner",ze="exit-signal",Ge=[27,80,49,36,114,54,51,59,49,34,112,27,92];var qe=function(t){return t||0===t?t.toString(16):"<FAIL: Not A Number>"},je=function(t,i,s,n){var l,h=s||0,r=n||t.length,u="";for(l=0;l<r;l++)u+=qe(t[h+l])+" ",l%16==15&&(i&&i.debug?i.debug(u):e.debug(u),u="");u.length>0&&(i&&i.debug?i.debug(u):e.debug(u))},Ze=function(t,e,i){return t<<16|e<<8|i};const Je=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Xe=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];var Ye=function(t){for(var e=[],i=t.length,s=Math.floor(i/3),n=i-3*s,l=0,h=0;h<s;h++){let i=255&t[l++],s=255&t[l++],n=255&t[l++];e.push(ti[i>>2]),e.push(ti[i<<4&63|s>>4]),e.push(ti[s<<2&63|n>>6]),e.push(ti[63&n])}if(0!=n){let i=255&t[l++];if(e.push(ti[i>>2]),1==n)e.push(ti[i<<4&63]),e.push(61),e.push(61);else{let s=255&t[l++];e.push(ti[i<<4&63|s>>4]),e.push(ti[s<<2&63]),e.push(61)}}return String.fromCharCode.apply(null,e)},$e=function(t){var i=t.length,s=i/4,n=0,l=s,h=0,r=0;if(4*s!=i)return e.warn("Base64 decode failed, encountered 4-mult"),null;0!=i&&"="==t[i-1]&&(n++,l--,"="==t[i-2]&&n++);var u=3*l;0!=n&&(1==n?u+=2:u++);var o=new Uint8Array(u);let a=4*l;for(;h<a;){let e=Je[t.charCodeAt(h++)],i=Je[t.charCodeAt(h++)],s=Je[t.charCodeAt(h++)],n=Je[t.charCodeAt(h++)];o[r++]=e<<2|i>>4,o[r++]=i<<4|s>>2,o[r++]=s<<6|n}if(0!=n){let e=Je[t.charCodeAt(h++)],i=Je[t.charCodeAt(h++)];if(o[r++]=e<<2|i>>4,1==n){let e=Je[t.charCodeAt(h++)];o[r++]=i<<4|e>>2}}return o};const ti=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var ei=function(t){},ii=function(t,e){switch(192&t){case 0:return(63&t)<<8|e;case 64:case 192:return(63&t)<<6|63&e;default:return Ns.warn("Bad SBA position, b1=0x"+qe(t)+", b2=0x"+qe(e)),0}},si=function(t,e){var i=(255&t[e])<<8;return 255&t[e+1]|i},ni=function(t,e){var i=(255&t[e])<<16,s=(255&t[e+1])<<8;return 255&t[e+2]|s|i},li=function(t,e){var i=(255&t[e])<<8|255&t[e+1];return i>=32768?i-65536:i},hi=function(t,e){var i=(255&t[e])<<24|(255&t[e+1])<<16|(255&t[e+2])<<8|255&t[e+3];return i>=2147483648?i-4294967296:i},ri=function(t,e,i,s,n){var l;for(l=0;l<i;l++)s[l]=li(t,e),n[l]=li(t,e+2),e+=4;return e},ui=function(t,e,i,s,n){var l;for(l=0;l<i;l++)s[l]=t[e+0],n[l]=t[e+1],e+=2;return e},oi=function(t,e,i,s,n){var l;for(l=0;l<n;l++)i[s+l]=t[e+l]},ai=function(t,e){var i;for(i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},ci=function(t,e,i){function s(){}for(var n in s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.D=e,t.R=e.prototype,i)t[n]=i[n]},fi=function(){this.size=0,this.T=null,this.M=null};fi.prototype={clear:function(){let t=this.size,e=this.T;for(let i=0;i<t-1;i++){e.next.P=void 0;let t=e.next;e.next=void 0,e=t}this.T=null,this.M=null,this.size=0},F:function(){let t=[],e=this.size;if(0==e)return t;let i=this.T;for(let s=0;s<e&&(t.push(i.data),i.next);s++){i.next.P=void 0;let t=i.next;i.next=void 0,i=t}return this.T=null,this.M=null,this.size=0,t},I:function(){return this.T},N:function(){return this.M},L:function(){return this.size},U:function(t){let e=new di(t);0==this.size?this.T=e:(e.P=this.M,this.M.next=e),this.M=e,this.size++},B:function(t){let e=new di(t);0==this.size?this.M=e:(e.next=this.T,this.T.P=e),this.T=e,this.size++},O:function(){if(0==this.size)return null;if(1==this.size){let t=this.M;return this.T=null,this.M=null,this.size=0,t.P=void 0,t.next=void 0,t}{this.size--;let t=this.M;return t.P.next=null,this.M=t.P,t.P=void 0,t.next=void 0,t}},V:function(){if(0==this.size)return null;if(1==this.size){let t=this.T;return this.T=null,this.M=null,this.size=0,t.P=void 0,t.next=void 0,t}{this.size--;let t=this.T;return t.next.P=null,this.T=t.next,t.P=void 0,t.next=void 0,t}},add:function(t,e){if(t<0||t>this.size)return-1;if(t==this.size)this.U(e);else if(0==t)this.B(e);else{let i=new di(e),s=this.size-1,n=this.T;for(let e=1;e<s;e++){if(e==t)return i.P=n,i.next=n.next,n.next.P=i,n.next=i,++this.size;n=n.next}}},remove:function(t){if(t<0||t>=this.size)return null;if(t==this.size-1)return this.O();if(0==t)return this.V();{let e=this.size-1,i=this.T;for(let s=1;s<e;s++){if(s==t)return i.next.P=i.P,i.P.next=i.next,this.size--,i.P=void 0,i.next=void 0,i;i=i.next}}},get:function(t){if(t>=this.size||t<0)return null;if(0==t)return this.I();if(t==this.size-1)return this.N();{let e=this.size-1,i=this.T;for(let s=1;s<e;s++){if(s==t)return i;i=i.next}}}};var di=function(t){this.data=t,this.P,this.next};const wi={Esc:"Escape",Nonconvert:"NonConvert",Spacebar:" ",ArrowLeft:"Left",ArrowRight:"Right",ArrowDown:"Down",ArrowUp:"Up",Del:"Delete","U+001B":"Escape","U+007F":"Delete","U+0008":"Backspace","U+0009":"Tab",OS:"Win",Meta:"Win",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MediaTrackNext:"MediaNextTrack",MediaTrackPrevious:"MediaPreviousTrack",AudioVolumeMute:"VolumeMute",AudioVolumeDown:"VolumeDown",AudioVolumeUp:"VolumeUp",Caps:"CapsLock",Ctrl:"Control",Ins:"Insert",Space:" ",Ent:"Enter"},Ai=0,pi=1,bi=2,ki=4,Ci=3,mi=5,vi=6,Si=7,gi=1,Ei=2,yi=4,Di=8;function Ri(t,e){this.type=t,this.value=e}function Ti(t,e,i,s,n,l,h,r){var u=[];return u[0]=t,u[1]=e,u[2]=i,u[4]=s,u[6]=n,u[3]=l,u[5]=h,u[7]=r,u}const Mi={Accept:null,Again:null,AllCandidates:null,Alphanumeric:null,ContextMenu:null,Attn:null,BrowserBack:null,BrowserFavorites:null,BrowserForward:null,BrowserHome:null,BrowserRefresh:null,BrowserSearch:null,BrowserStop:null,CapsLock:null,Clear:null,CodeInput:null,Compose:null,Crsel:null,Convert:null,Copy:null,Cut:null,Down:new Ti(new Ri(64,"Cursor Down"),null,null,null,null,null,null,null),End:new Ti(new Ri(64,"End"),null,null,null,null,null,null,null),Enter:new Ti(new Ri(64,"Enter"),null,null,null,null,null,null,null),EraseEof:null,Execute:null,Exsel:null,F1:new Ti(new Ri(64,"F1"),new Ri(64,"F13"),null,null,null,null,null,null),F2:new Ti(new Ri(64,"F2"),new Ri(64,"F14"),null,null,null,null,null,null),F3:new Ti(new Ri(64,"F3"),new Ri(64,"F15"),null,null,null,null,null,null),F4:new Ti(new Ri(64,"F4"),new Ri(64,"F16"),null,null,null,null,null,null),F5:new Ti(new Ri(64,"F5"),new Ri(64,"F17"),null,null,null,null,null,null),F6:new Ti(new Ri(64,"F6"),new Ri(64,"F18"),null,null,null,null,null,null),F7:new Ti(new Ri(64,"F7"),new Ri(64,"F19"),null,null,null,null,null,null),F8:new Ti(new Ri(64,"F8"),new Ri(64,"F20"),null,null,null,null,null,null),F9:new Ti(new Ri(64,"F9"),new Ri(64,"F21"),null,null,null,null,null,null),F10:new Ti(new Ri(64,"F10"),new Ri(64,"F22"),null,null,null,null,null,null),F11:new Ti(new Ri(64,"F11"),new Ri(64,"F23"),null,null,null,null,null,null),F12:new Ti(new Ri(64,"F12"),new Ri(64,"F24"),null,null,null,null,null,null),F13:new Ti(new Ri(64,"F13"),null,null,null,null,null,null,null),F14:new Ti(new Ri(64,"F14"),null,null,null,null,null,null,null),F15:new Ti(new Ri(64,"F15"),null,null,null,null,null,null,null),F16:new Ti(new Ri(64,"F16"),null,null,null,null,null,null,null),F17:new Ti(new Ri(64,"F17"),null,null,null,null,null,null,null),F18:new Ti(new Ri(64,"F18"),null,null,null,null,null,null,null),F19:new Ti(new Ri(64,"F19"),null,null,null,null,null,null,null),F20:new Ti(new Ri(64,"F20"),null,null,null,null,null,null,null),F21:new Ti(new Ri(64,"F21"),null,null,null,null,null,null,null),F22:new Ti(new Ri(64,"F22"),null,null,null,null,null,null,null),F23:new Ti(new Ri(64,"F23"),null,null,null,null,null,null,null),F24:new Ti(new Ri(64,"F24"),null,null,null,null,null,null,null),FinalMode:null,Find:null,FullWidth:null,HalfWidth:null,HangulMode:null,HanjaMode:null,Help:null,Hiragana:null,Home:new Ti(new Ri(64,"Home"),null,null,null,null,null,null,null),Insert:new Ti(new Ri(64,"Insert"),null,null,null,null,null,null,null),JapaneseHiragana:null,JapaneseKatakana:null,JapaneseRomaji:null,JunjaMode:null,KanaMode:null,KanjiMode:null,Katakana:null,LaunchApplication1:null,LaunchApplication2:null,LaunchMail:null,Left:new Ti(new Ri(64,"Cursor Left"),null,null,null,null,null,null,null),MediaNextTrack:null,MediaPlayPause:null,MediaPreviousTrack:null,MediaStop:null,ModeChange:null,Nonconvert:null,NumLock:new Ti(new Ri(64,"KP_PF01"),null,null,null,null,null,null,null),PageDown:new Ti(new Ri(64,"Page Down"),null,null,null,null,null,null,null),PageUp:new Ti(new Ri(64,"Page Up"),null,null,null,null,null,null,null),Paste:null,Pause:null,Play:null,PreviousCandidate:null,PrintScreen:null,Process:null,Props:null,Right:new Ti(new Ri(64,"Cursor Right"),null,null,null,null,null,null,null),RomanCharacters:null,ScrollLock:null,Select:null,SelectMedia:null,Stop:null,Up:new Ti(new Ri(64,"Cursor Up"),null,null,null,null,null,null,null),Undo:null,VolumeDown:null,VolumeMute:null,VolumeUp:null,Win:null,Zoom:null," ":new Ti(new Ri(2," "),new Ri(2," "),new Ri(64,"Control+@"),null,null,null,null,null),"!":new Ti(null,new Ri(2,"!"),null,null,null,null,null,null,null),'"':new Ti(null,new Ri(2,'"'),null,null,null,null,null,null),"#":new Ti(null,new Ri(2,"#"),null,null,null,null,null,null),$:new Ti(null,new Ri(2,"$"),null,null,null,null,null,null),"%":new Ti(null,new Ri(2,"%"),null,null,null,null,null,null),"&":new Ti(null,new Ri(2,"&"),null,null,null,null,null,null),"'":new Ti(new Ri(2,"'"),null,null,null,null,null,null,null),"(":new Ti(null,new Ri(2,"("),null,null,null,null,null,null),")":new Ti(null,new Ri(2,")"),null,null,null,null,null,null),"*":new Ti(null,new Ri(2,"*"),null,null,null,null,null,null),"+":new Ti(null,new Ri(2,"+"),null,null,null,null,null,null),",":new Ti(new Ri(2,","),null,null,null,null,null,null,null),"-":new Ti(new Ri(2,"-"),null,new Ri(64,"Control+_"),null,null,null,null,null),".":new Ti(new Ri(2,"."),null,null,null,null,null,null,null),"/":new Ti(new Ri(2,"/"),null,null,null,null,null,null,null),0:new Ti(new Ri(2,"0"),null,null,null,null,null,null,null),1:new Ti(new Ri(2,"1"),null,null,null,null,null,null,null),2:new Ti(new Ri(2,"2"),null,new Ri(64,"Control+@"),null,null,null,null,null),3:new Ti(new Ri(2,"3"),null,new Ri(64,"Control+3"),null,null,null,null,null),4:new Ti(new Ri(2,"4"),null,null,null,null,null,null,null),5:new Ti(new Ri(2,"5"),null,null,null,null,null,null,null),6:new Ti(new Ri(2,"6"),null,new Ri(2,String.fromCharCode.apply(null,[172])),null,null,null,null,null),7:new Ti(new Ri(2,"7"),null,null,null,null,null,null,null),8:new Ti(new Ri(2,"8"),null,null,null,null,null,null,null),9:new Ti(new Ri(2,"9"),null,null,null,null,null,null,null),Numpad0:new Ti(new Ri(2,"0"),null,null,null,null,null,null,null),Numpad1:new Ti(new Ri(2,"1"),null,null,null,null,null,null,null),Numpad2:new Ti(new Ri(2,"2"),null,null,null,null,null,null,null),Numpad3:new Ti(new Ri(2,"3"),null,null,null,null,null,null,null),Numpad4:new Ti(new Ri(2,"4"),null,null,null,null,null,null,null),Numpad5:new Ti(new Ri(2,"5"),null,null,null,null,null,null,null),Numpad6:new Ti(new Ri(2,"6"),null,null,null,null,null,null,null),Numpad7:new Ti(new Ri(2,"7"),null,null,null,null,null,null,null),Numpad8:new Ti(new Ri(2,"8"),null,null,null,null,null,null,null),Numpad9:new Ti(new Ri(2,"9"),null,null,null,null,null,null,null),"Numpad/":new Ti(new Ri(64,"KP_PF02"),null,null,null,null,null,null,null),"Numpad*":new Ti(new Ri(64,"KP_PF03"),null,null,null,null,null,null,null),"Numpad-":new Ti(new Ri(64,"KP_PF04"),null,null,null,null,null,null,null),"Numpad+":new Ti(new Ri(2,"+"),null,null,null,null,null,null,null),NumpadEnter:new Ti(new Ri(2,"Enter"),null,new Ri(64,"New Line"),null,null,null,null,null),"Numpad.":new Ti(new Ri(2,"."),null,null,null,null,null,null,null),NumpadUp:new Ti(new Ri(64,"Cursor Up"),null,null,null,null,null,null,null),NumpadDown:new Ti(new Ri(64,"Cursor Down"),null,null,null,null,null,null,null),NumpadLeft:new Ti(new Ri(64,"Cursor Left"),null,null,null,null,null,null,null),NumpadRight:new Ti(new Ri(64,"Cursor Right"),null,null,null,null,null,null,null),NumpadHome:new Ti(new Ri(64,"Home"),null,null,null,null,null,null,null),NumpadPageUp:new Ti(new Ri(64,"PageUp"),null,null,null,null,null,null,null),NumpadPageDown:new Ti(new Ri(64,"PageDown"),null,null,null,null,null,null,null),NumpadEnd:new Ti(new Ri(64,"End"),null,null,null,null,null,null,null),NumpadInsert:new Ti(new Ri(64,"Insert"),null,null,null,null,null,null,null),NumpadDelete:new Ti(new Ri(64,"Delete"),null,null,null,null,null,null,null),":":new Ti(null,new Ri(2,":"),null,null,null,null,null,null),";":new Ti(new Ri(2,";"),null,null,null,null,null,null,null),"<":new Ti(null,new Ri(2,"<"),null,null,null,null,null,null),"=":new Ti(new Ri(2,"="),null,null,null,null,null,null,null),">":new Ti(null,new Ri(2,">"),null,null,null,null,null,null),"?":new Ti(null,new Ri(2,"?"),null,null,null,null,null,null),"@":new Ti(null,new Ri(2,"@"),null,null,null,new Ri(64,"Control+@"),null,null),"[":new Ti(new Ri(2,"["),null,new Ri(64,"Control+["),null,null,null,null,null),"\\":new Ti(new Ri(2,"\\"),null,new Ri(64,"Control+\\"),null,null,null,null,null),"]":new Ti(new Ri(2,"]"),null,new Ri(64,"Control+]"),null,null,null,null,null),"^":new Ti(null,new Ri(2,"^"),null,new Ri(64,"Control+^"),null,new Ri(64,"Record Separator"),null,null),_:new Ti(null,new Ri(2,"_"),null,new Ri(64,"Control+_"),null,new Ri(64,"Unit Separator"),null,null),"`":new Ti(new Ri(2,"`"),null,null,null,null,null,null,null),a:new Ti(new Ri(2,"a"),new Ri(2,"A"),new Ri(64,"Control+a"),null,null,null,null,null),b:new Ti(new Ri(2,"b"),new Ri(2,"B"),new Ri(64,"Control+b"),null,null,null,null,null),c:new Ti(new Ri(2,"c"),new Ri(2,"C"),new Ri(64,"Control+c"),null,null,null,null,null),d:new Ti(new Ri(2,"d"),new Ri(2,"D"),new Ri(64,"Control+d"),null,null,null,null,null),e:new Ti(new Ri(2,"e"),new Ri(2,"E"),new Ri(64,"Control+e"),null,null,null,null,null),f:new Ti(new Ri(2,"f"),new Ri(2,"F"),new Ri(64,"Control+f"),null,null,null,null,null),g:new Ti(new Ri(2,"g"),new Ri(2,"G"),new Ri(64,"Control+g"),null,null,null,null,null),h:new Ti(new Ri(2,"h"),new Ri(2,"H"),new Ri(64,"Control+h"),null,null,null,null,null),i:new Ti(new Ri(2,"i"),new Ri(2,"I"),new Ri(64,"Control+i"),null,null,null,null,null),j:new Ti(new Ri(2,"j"),new Ri(2,"J"),new Ri(64,"Control+j"),null,null,null,null,null),k:new Ti(new Ri(2,"k"),new Ri(2,"K"),new Ri(64,"Control+k"),null,null,null,null,null),l:new Ti(new Ri(2,"l"),new Ri(2,"L"),new Ri(64,"Control+l"),null,null,null,null,null),m:new Ti(new Ri(2,"m"),new Ri(2,"M"),new Ri(64,"Control+m"),null,null,null,null,null),n:new Ti(new Ri(2,"n"),new Ri(2,"N"),new Ri(64,"Control+n"),null,null,null,null,null),o:new Ti(new Ri(2,"o"),new Ri(2,"O"),new Ri(64,"Control+o"),null,null,null,null,null),p:new Ti(new Ri(2,"p"),new Ri(2,"P"),new Ri(64,"Control+p"),null,null,null,null,null),q:new Ti(new Ri(2,"q"),new Ri(2,"Q"),new Ri(64,"Control+q"),null,null,null,null,null),r:new Ti(new Ri(2,"r"),new Ri(2,"R"),new Ri(64,"Control+r"),null,null,null,null,null),s:new Ti(new Ri(2,"s"),new Ri(2,"S"),new Ri(64,"Control+s"),null,null,null,null,null),t:new Ti(new Ri(2,"t"),new Ri(2,"T"),new Ri(64,"Control+t"),null,null,null,null,null),u:new Ti(new Ri(2,"u"),new Ri(2,"U"),new Ri(64,"Control+u"),null,null,null,null,null),v:new Ti(new Ri(2,"v"),new Ri(2,"V"),null,null,null,null,null,null),w:new Ti(new Ri(2,"w"),new Ri(2,"W"),new Ri(64,"Control+w"),null,null,null,null,null),x:new Ti(new Ri(2,"x"),new Ri(2,"X"),new Ri(64,"Control+x"),null,null,null,null,null),y:new Ti(new Ri(2,"y"),new Ri(2,"Y"),new Ri(64,"Control+y"),null,null,null,null,null),z:new Ti(new Ri(2,"z"),new Ri(2,"Z"),new Ri(64,"Control+z"),null,null,null,null,null),"{":new Ti(null,new Ri(2,"{"),null,null,null,null,null,null),"|":new Ti(null,new Ri(2,"|"),null,null,null,null,null,null),"}":new Ti(null,new Ri(2,"}"),null,null,null,null,null,null),"~":new Ti(null,new Ri(2,"~"),null,null,null,null,null,null),Backspace:new Ti(new Ri(64,"Delete"),new Ri(64,"Erase Character"),new Ri(64,"Delete Character"),null,null,null,null,null),Tab:new Ti(new Ri(64,"Tab"),null,null,null,null,null,null,null),"U+0018":null,Escape:new Ti(new Ri(64,"Escape"),null,null,null,null,null,null,null),Delete:new Ti(new Ri(64,"Delete"),null,null,null,null,null,null,null),"U+00A1":null,"U+0300":null,"U+0301":null,"U+0302":null,"U+0303":null,"U+0304":null,"U+0306":null,"U+0307":null,"U+0308":null,"U+030A":null,"U+030B":null,"U+030C":null,"U+0327":null,"U+0328":null,"U+0345":null,"U+20AC":null,"U+3099":null,"U+309A":null};var Pi=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.render"),Fi=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.scaling"),xi=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.color");const Ii=1,Ni=2,Li=3,Ui=100,Bi=-1.5,Oi=-.25,Vi=5,Hi=1,Qi=2,_i=4,Ki=6,Wi=8,zi=10,Gi=12,qi=14,ji=16,Zi=18,Ji=22,Xi=24,Yi=26,$i=28,ts=30,es=32,is=64,ss=128,ns=256,ls=512,hs=4096,rs=8192,us=16777215,os=2281766656,as=1,cs=2;var fs=0;const ds=0,ws=4210752,As=61440,ps=16777215;var bs=function(t){if(t.match(/^#([a-fA-F0-9]){6}/)){var e=parseInt(t.substring(1,7),16);return"rgb("+(e>>16)+","+(e>>8&255)+","+(255&e)+")"}if(t.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)/))return t;Pi.warn("Webcolor: bad color value, "+t)},ks=function(t,e,i,s,n){xi.log(xi.FINEST,"Setting fill color. Previous color="+t.fillStyle+". Args length="+arguments.length),t.fillStyle=5==arguments.length?"rgba("+e+","+i+","+s+","+n+")":4==arguments.length?"rgb("+e+","+i+","+s+")":2==arguments.length?"rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":bs(e),xi.log(xi.FINEST,"Set fill color. New color="+t.fillStyle)},Cs=function(t,e,i,s,n){xi.log(xi.FINEST,"Setting stroke color. Previous color="+t.strokeStyle+". Args length="+arguments.length),t.strokeStyle=5==arguments.length?"rgba("+e+","+i+","+s+","+n+")":4==arguments.length?"rgb("+e+","+i+","+s+")":2==arguments.length?"rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":bs(e),xi.log(xi.FINEST,"Set stroke color. New color="+t.strokeStyle)},ms=function(t,e){t.globalAlpha=e},vs=function(t,e,i,s){t.beginPath(),t.arc(e,i,s,0,6.29,!1),t.closePath(),t.fill()},Ss=function(t,e,i,s,n,l){t.beginPath(),t.moveTo(e,i),t.arc(e,i,s,n,l,!1),t.closePath(),t.fill()},gs=function(t,e,i,s,n,l){for(var h=new Array(s),r=0;r<s;r++)h[r]=e[i+r];var u=String.fromCharCode.apply(null,h);Pi.log(Pi.FINEST,"Draw chars at canvas px("+n+","+l+") runLength="+s+" lineBuffer start="+i+" text="+u),t.fillText(u,n,l)};function Es(t,e,i,s,n){Pi.debug("Draw line (2) from ("+e+","+i+") to ("+s+","+n+")"),t.beginPath();var l=t.fillStyle;t.fillStyle=t.strokeStyle;for(var h=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i)),r=s-e,u=n-i,o=Math.atan(u/(0==r?.01:r))+(r<0?Math.PI:0),a=0;a<h;a++)t.fillRect(Math.round(e+Math.cos(o)*a),Math.round(i+Math.sin(o)*a),1,1);t.stroke(),t.fillStyle=l}var ys=function(t,e,i,s,n){Pi.debug("Draw line from ("+e+","+i+") to ("+s+","+n+")"),t.beginPath(),t.moveTo(e,i),t.lineTo(s,n),t.stroke()};function Ds(t,i){this.canvas=t.canvas,this.H=t,this.K=-1,this.W=-1,this.G=-1,this.Z=-1,this.font=null,this.fontSize=Number(Ds.fontSize),this.J=t.X&&t.X.J?t.X.J:h,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Y),this.tt=!0,this.et=1,this.it=1,this.st=-1,this.nt=-1,this.lt=1,this.ht=1,this.rt=1,this.ut=0,this.ot=0,this.at=i,this.ct=0,this.ft=3,this.dt=500,this.wt=!0,this.hasFocus=t.At(),this.pt=0,this.background=0,this.bt=16777215,this.kt=16777215,this.scaleMethod=1,this.Ct=null,this.vt=null,3==this.ft&&this.dt>=100&&this.St()}Ds.gt=2,Ds.fontWeight="normal",Ds.fontStyle="normal",Ds.fontSize=10,Ds.J=h,Ds.prototype.Et=function(t){if(t){if(Pi.debug("Setting font properties=",t),t.size&&null!==t.size){let e=Number(t.size);this.fontSize=e,Ds.fontSize=e}t.scaleMethod&&null!==t.scaleMethod&&(this.scaleMethod=t.scaleMethod,1==this.scaleMethod&&(Ds.fontSize=10)),this.yt(),this.Dt()}},Ds.prototype.Rt=function(t,e,i,s){t.font=Ds.fontStyle+" "+Ds.fontWeight+" "+e+"px "+i;var n=t.measureText(s);this.ut=fs,this.rt=.85*e,this.Tt=e-(this.ut+this.rt),this.ot=this.rt+this.ut;var l=e;return{width:n.width,height:l}},Ds.prototype.Mt=function(){return this.H.oiaEnabled?this.H.height+Ds.gt:this.H.height},Ds.prototype.Pt=function(t,e){var i,s=t.width,n=t.height,l=this.H;let h;if(this.tt=!0,this.nt=0,this.st=0,this.Ft="1",this.xt="1",Fi.debug("Calculate font for canvas w="+s+",h="+n),0==this.scaleMethod)for(Fi.debug("Calculating for scaleMethod=ratio"),h=50;h>4;h--){var r=(i=this.Rt(e,h,this.J,"M")).width*l.width,u=i.height*this.Mt();if(Fi.debug("At font size="+h+", need w="+r+",h="+u),r<=s&&u<=n){Fi.debug("Found size match. Chose font size ="+h+" for canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Tt+" leading="+this.ut),this.tt=!1,this.lt=i.width,this.ht=i.height,this.font=Ds.fontStyle+" "+Ds.fontWeight+" "+h+"px "+this.J,this.nt=r,this.st=u;break}}else if(1==this.scaleMethod){Fi.debug("Calculating for scaleMethod=fit"),h=10,i=this.Rt(e,h,this.J,"M"),this.tt=!1,this.lt=i.width,this.ht=i.height,this.font=Ds.fontStyle+" "+Ds.fontWeight+" "+h+"px "+this.J;var o=t.width/(l.width*i.width),a=t.height/(this.Mt()*i.height);o=(parseInt(10*o)/10).toFixed(1),a=(parseInt(10*a)/10).toFixed(1),this.et=1/o,this.it=1/a,this.nt=t.width*this.et,this.st=t.height*this.it,e.scale(o,a),this.Ft=o,this.xt=a,this.It.setTransform(1,0,0,1,0,0),this.It.scale(o,a),Fi.debug("Scaled for font size="+h+", canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Tt+" leading="+this.ut),Fi.debug("Scale factors are: sfX="+this.et+", sfY="+this.it+", aH="+this.st+", aW="+this.nt+", sW="+o+", sH="+a)}else Fi.debug("Calculating for scaleMethod=no scale"),h=Ds.fontSize,i=this.Rt(e,h,this.J,"M"),this.tt=!1,this.lt=i.width,this.ht=i.height,this.font=Ds.fontStyle+" "+Ds.fontWeight+" "+h+"px "+this.J,this.et=1,this.it=1,this.nt=t.width,this.st=t.height,e.scale("1","1"),this.It.setTransform(1,0,0,1,0,0),this.It.scale("1","1"),Fi.debug("Scaled for font size="+h+", canvas w="+s+",h="+n+" ascent="+this.rt+", descent="+this.Tt+" leading="+this.ut);if(this.J!=this.Nt){Fi.debug("Determining font size for DBCS="+this.Nt);var c=this.Rt(e,h,this.Nt,"M"),f=this.Rt(e,h,this.Nt,"䭺");Fi.debug("SBCS box=",i," dbcsBox=",c," testSymbolBox=",f)}},Ds.prototype.Lt=function(t,e,i,s){var n;for(n=0;n<s;n++)t[n]=32,e[n]=0,i[n]=0},Ds.prototype.Ut=function(t,e,i){for(var s=e;s<i;s++)if(t[s]>32)return s;return-1},Ds.prototype.Bt=function(t,e,i,s,n,l){for(var h=s+1,r=t[s],u=l?l[s]:null,o=e[s];h<n&&(r==os?t[h]==os:r==t[h])&&o==e[h]&&(!l||u==l[h]);)h++;return h-s},Ds.prototype.clear=function(){let t=this.H;var e=t.canvas.getContext("2d"),i=t.canvas.width,s=t.canvas.height;if(Pi.debug("Renderer.clear pxWidth="+i+" pxHeight="+s+" inactive=4210752"),ks(e,this.background),e.fillRect(0,0,this.nt,this.st),t.Ot){let e=t.Ot.getContext("2d");ks(e,this.background),e.fillRect(0,0,t.Ot.width,t.Ot.height)}},Ds.prototype.yt=function(){this.H.canvas.getContext("2d").setTransform(1,0,0,1,0,0),this.H.Ot&&this.H.Ot.getContext("2d").setTransform(1,0,0,1,0,0),this.et=1,this.it=1,this.K=-1},Ds.prototype.Vt=function(t,e){return 1==this.scaleMethod&&(t*=this.et,e*=this.it),(t>=this.nt||e>=this.st)&&Pi.debug("canvasX or canvasY is greater than activeWidth or activeHeight"),{rows:Math.floor(e/this.ht),columns:Math.floor(t/this.lt)}},Ds.prototype.Ht=function(){var t=this.H;let e=t.canvas;var i=this.It;i.font=this.font,ks(i,255,255,255,0),i.clearRect(0,0,e.width,e.height),i.clearRect(0,0,this.nt,this.st),!0===this.hasFocus&&(3!=this.ft||0==this.dt||!0===this.wt)&&this.ft>0&&this.Qt(i,t._t),null!=t.Kt&&null!=t.Wt&&null!=t.zt&&null!=t.Gt&&this.qt(t.Kt,t.Wt,t.Gt,t.zt),1==t.oiaEnabled&&this.jt(i,t,t.Zt?function(){t.Zt()}:void 0)},Ds.prototype.jt=function(t,e,i){let s=e.canvas;var n=t.lineWidth;t.beginPath(),Cs(t,this.bt),t.lineWidth=5*this.it;var l=s.height*this.it+-1.5*this.ht;t.moveTo(0,l),t.lineTo(this.nt,l);var h=e.Jt();ks(t,this.bt);var r=s.height*this.it+-.25*this.ht;gs(t,h,0,e.width,0,r),t.closePath(),t.stroke(),t.lineWidth=n,i&&i.call(this)},Ds.prototype.qt=function(t,e,i,s){if(t!=i&&e!=s){var n=Math.min(t,i),l=Math.max(t,i),h=Math.min(e,s),r=Math.max(e,s),u=this.H,o=u.Xt.getContext("2d");o.beginPath(),this.Yt(n,h,l,r,o,u.canvas.getContext("2d")),o.closePath()}},Ds.prototype.$t=function(){clearTimeout(this.Ct),!0!==this.wt&&(this.wt=!0,this.Ht()),3==this.ft&&this.dt>=100&&this.St()},Ds.prototype.St=function(){var t=this;this.Ct=setInterval((function(){t.wt=!t.wt,!0===t.hasFocus&&t.Ht()}),this.dt)},Ds.prototype.te=function(){clearTimeout(this.vt),1!=this.ee&&(this.ee=!0,this.Dt()),this.ie>=100&&this.se()},Ds.prototype.se=function(){var t=this;this.vt=setInterval((function(){t.ne&&(t.ee=!t.ee,t.Dt())}),this.ie)},Ds.prototype.Qt=function(t,i){if(-1!==i){var s=this.H,n=this.ht,l=this.lt,h=this.H.le?.2:1;if(0!=s.width){var r=Math.floor(i/s.width)+1,u=i%s.width;Pi.debug("show cursor pos="+i+" at row="+r+" column="+u),t.beginPath(),ks(t,this.kt),1==this.ft?(Cs(t,this.kt),t.moveTo(u*l,(r-h)*n),t.lineTo((1+u)*l,(r-h)*n),t.lineTo((1+u)*l,r*n),t.lineTo(u*l,r*n),t.lineTo(u*l,(r-h)*n),t.closePath(),t.stroke()):(this.Yt(u,r-h,1+u,r,t,s.canvas.getContext("2d")),t.closePath())}else e.info("CANNOT SHOW CURSOR screen.width==0\n")}},Ds.prototype.Yt=function(t,e,i,s,n,l){for(var h=this.ht,r=this.lt,u=t*r,o=e*h,a=i*r,c=s*h,f=1==this.scaleMethod?u/this.et:u,d=1==this.scaleMethod?o/this.it:o,w=1==this.scaleMethod?a/this.et:a,A=1==this.scaleMethod?c/this.it:c,p=Math.abs(f-w),b=Math.abs(d-A),k=l.getImageData(f,d,p,b),C=0;C<k.data.length;C+=4)k.data[C]=255-k.data[C],k.data[C+1]=255-k.data[C+1],k.data[C+2]=255-k.data[C+2],k.data[C+3]=255;n.putImageData(k,f,d)},Ds.prototype.Dt=function(){tn("fullPaint")},Ds.prototype.he=function(){e.debug("Renderer resize completed")},ci(Ts,Ds,[Ts.Dt]);const Rs=16777215;function Ts(t,i,s){this.H=t,t.re=this,this.K=-1,this.W=-1,this.G=-1,this.Z=-1,this.font=null,this.fontSize=Ds.fontSize,this.J=t.X&&t.X.J?t.X.J:h,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Y),this.tt=!0,this.et=1,this.it=1,this.st=-1,this.nt=-1,this.lt=1,this.ht=1,this.rt=1,this.ut=0,this.ot=0,this.at=i,this.ct=0,this.ft=3,this.ue=3,this.dt=500,this.ie=500,this.hasFocus=t.At(),this.scaleMethod=s||1,this.oe=16711680,this.ae=65280,this.backgroundColor=0,this.ce=16777215,this.fe=65280,this.de=this.fe,this.we=this.backgroundColor,this.Ae=0,this.pe=16777215,this.be=0,this.ke=16777215,this.Ce=0,this.me=this.fe,this.ve=0,this.Se=this.fe,this.ge=0,this.Ee=[0,12255232,47872,12303104,187,12255419,48059,12303291],this.ye=[this.Ee[0],this.Ee[1],this.Ee[2],this.Ee[3],this.Ee[4],this.Ee[5],this.Ee[6],this.Ee[7],8421504,33023,65408,8454143,16744576,16744703,16777088,12632256],this.De=[5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],this.Re=[this.De[0],this.De[1],this.De[2],this.De[3],this.De[4],this.De[5],this.De[6],this.De[7],8421504,33023,65408,8454143,16744576,16744703,16777088,16777215],this.kt=16777215,this.bt=16777215,this.Te=!1,this.ne=!0,this.Ct=null,this.vt=null,3==this.ft&&this.dt>=100&&this.St(),this.ie>=100&&this.se(),this.Dt()}Ts.Me=32,Ts.Pe=32,Ts.prototype.Fe=function(t,e,i,s){var n=this.H,l=!1;Pi.debug("Determining which rows to redraw. Include neighbors="+s);var h=n.xe;if(null==h)Pi.debug("Viewport top is null, not redrawing any rows"),e.fill(!0);else{for(let t=0;t<n.height;t++){if(!h){e.fill(!0,t);break}h.Ie&&(l=!0),i[t]==h.id&&!0!==h.updated||(e[t]=!0,s&&(t>0&&(e[t-1]=!0),t<n.height-1&&(e[t+1]=!0))),h.updated=!1,i[t]=h.id,h=h.next}h=n.xe,Pi.debug("Row redraw calculation result=",e)}this.ne!=l&&(this.ee=!0,this.ne=l,e.fill(!0))},Ts.prototype.Ne=function(){null!=this.Le&&null!=this.Le||(this.ue=this.ft),this.ft=0},Ts.prototype.Ue=function(){this.ft=3,this.$t()},Ts.prototype.Be=function(){null!=this.Le&&null!=this.Le||(this.Le=this.dt),this.dt=0},Ts.prototype.Oe=function(){this.dt=this.Le,this.Le=null},Ts.prototype.Ve=function(t,e){var i=this.H.height,s=null;let n=this.ht,l=this.nt;ks(t,this.backgroundColor),Pi.debug("Clearing updated rows by drawing with color="+this.backgroundColor);var h=e.entries();for(let e of h)!0===e[1]?null==s&&(s=e[0]):null!=s&&(t.fillRect(0,n*s,l,n*(e[0]-s)),s=null);null!=s&&t.fillRect(0,n*s,l,n*(i+1-s))},Ts.He=function(t,e,i){var s=t-i+33,n=t-i+161;switch(e){case Jn.Qe:return s;case Jn._e:switch(Pi.log(Pi.FINER,"Getting symbol in charset. code=0x"+qe(t)+", charset=0x"+e+", codeShift=0x"+i+". shifted=0x"+qe(s)+", iso8859-like=0x"+qe(n)),n){case 164:case 166:return Ts.Me;case 168:return 164;case 172:case 173:case 174:case 175:return Ts.Me;case 180:case 184:case 190:case 208:return Ts.Me;case 215:return 338;case 221:return 376;case 222:case 240:return Ts.Me;case 247:return 339;case 253:return 255;case 254:case 255:return Ts.Me;default:return n}case Jn.Ke:if(Pi.log(Pi.FINER,"Getting symbol in charset. code=0x"+qe(t)+", charset=0x"+e+", codeShift=0x"+i+". shifted=0x"+qe(s)+", iso8859-like=0x"+qe(n)),s<95)return s;switch(s){case 95:return" ";case 96:return 9674;case 97:return 9618;case 98:return 9225;case 99:return 9228;case 100:return 9229;case 101:return 9226;case 102:return 176;case 103:return 177;case 104:return 9252;case 105:return 9227;case 106:return 9496;case 107:return 9488;case 108:return 9484;case 109:return 9492;case 110:return 9532;case 111:case 112:return 8254;case 113:return 9472;case 114:case 115:return 95;case 116:return 9500;case 117:return 9508;case 118:return 9524;case 119:return 9516;case 120:return 9474;case 121:return 8804;case 122:return 8805;case 123:return 960;case 124:return 8800;case 125:return 163;case 126:return 183;default:return Pi.warn("No DEC graphic char for shifted code=0x"+qe(s))," "}default:return Pi.warn("No lookup for gl.charset=0x"+qe(e)),s}},Ts.We=function(t,e){var i=t.ze;return i<=32?32:i<127?Ts.He(i,t.Ge,33):i<=161?32:i<255?Ts.He(i,t.qe,161):!0===e?i:(null!=i&&Pi.warn("Failed to get glyph for code=0x"+qe(i)),32)};var Ms=new Hn(32);Ts.prototype.je=function(t,e,i,s,n,l,h,r){null==r&&(r=Ms,s[l]=this.ce,n[l]=this.backgroundColor),e[l]=Ts.We(r,this.H.Ze);var u=r.Je;if(0==(64&r.Xe)){switch(r.Ye){case Jn.$e:0!=(16&r.Xe)?s[l]=this.fe:s[l]=this.ce;break;case Jn.ti:0!=(16&r.Xe)?s[l]=this.De[u]:s[l]=this.Ee[u];break;case Jn.ei:0!=(16&r.Xe)?s[l]=this.Re[u]:s[l]=this.ye[u];break;case Jn.ii:s[l]=u}var o=r.si;switch(r.ni){case Jn.$e:n[l]=this.backgroundColor;break;case Jn.ti:n[l]=this.Ee[o];break;case Jn.ei:n[l]=this.ye[o];break;case Jn.ii:n[l]=o}}else xi.debug("Element is hidden, setting null color"),s[l]=null,n[l]=null;i[l]=r.Xe},Ts.prototype.li=function(){if(!this.hi){this.hi=!0;var t=this.backgroundColor;this.backgroundColor=this.ce,this.ce=t,this.Dt()}},Ts.prototype.ri=function(){if(this.hi){this.hi=!1;var t=this.backgroundColor;this.backgroundColor=this.ce,this.ce=t,this.Dt()}},Ts.prototype.Dt=function(){Pi.debug("Full paint called, will clear entire screen");let t=this.H.canvas;this.H.parentDiv;var e=t.getContext("2d");if(ks(e,this.backgroundColor),e.fillRect(0,0,t.width,t.height),this.H.Ot){let t=this.H.Ot;var i=t.getContext("2d");ks(i,this.backgroundColor),i.fillRect(0,0,t.width,t.height)}this.H.ui.fill(null),this.oi()};var Ps=!0,Fs=!0;Ts.prototype.oi=function(t){let e=this.H.canvas;var i=e.width,s=e.height,n=e.getContext("2d",{alpha:!1});if(this.It=this.H.Xt.getContext("2d"),-1!=this.K&&this.K==i&&this.W==s||(this.Pt(e,n),this.Pt(this.H.Xt,this.It),this.K=i,this.W=s,!this.H.Ot)||this.H.Ot.getContext("2d").scale(this.Ft,this.xt),this.tt)return;n.font=this.font,n.textBaseline="top",ks(n,this.ce);var l=this.H,h=Number(l.width),r=new Array(h),u=new Array(h),o=new Array(h),a=new Array(h);let c=0;var f=0,d=l.ui,w=new Array(Number(t>0?t:l.height));Fs?this.Fe(n,w,d,Ps):w.fill(!0),window.requestAnimationFrame(()=>{this.Ve(n,w);for(var t=l.xe,i=0,s=e.height/l.height,d=0;d<l.height;d++){if(!w[d]){if(Pi.debug("Skipping unmodified row="+d),f+=l.width,c+=this.ht,null==t)break;t=t.next;continue}var A;for(i++,null!=t&&"function"==typeof this.ai&&this.ai(t,d,s),d<3&&Pi.debug("startLine, baseline = "+c+" screenOffset="+f+" size="+l.size),this.Lt(r,a,u,h),A=0;A<h;A++)this.je(d,r,a,u,o,A,h,null!=t?t.elements[A]:null);var p=0;A=0;let e=this.H.ci(t)?Math.floor(h/2):h;for(;A<e;){var b=this.Bt(u,a,d,A,e,o);if(null!=u[A]){var k=a[A];if(ks(n,u[A]),Cs(n,u[A]),n.lineWidth=.8,Pi.debug("Run starts at ("+A+","+d+"). Length="+b+", Attr=0x"+qe(k)+", FG="+u[A]+", BG="+o[A]),0!=(128&k)?(Pi.debug("Transforming canvas for double width"),n.save(),n.transform(2,0,0,1,0,0)):0!=(256&k)&&(Pi.debug("Transforming canvas for double height (top)"),n.save(),n.transform(2,0,0,2,0,-Math.round(this.st/this.H.height)*d)),0==(512&k)){var C=0!=(2&k);if(C?(1==this.Te&&(0!=(16&k)?(ks(n,this.de),Cs(n,this.de)):(ks(n,this.oe),Cs(n,this.oe))),n.fillRect(p,c,b*this.lt,this.ht),1==this.Te?ks(n,0!=(16&k)?this.we:this.ae):ks(n,o[A])):o[A]!=this.backgroundColor&&(ks(n,o[A]),n.fillRect(p,c,b*this.lt,this.ht),ks(n,u[A])),0!=(1&k)?this.fi(n,r,A,b,p,c,C):(0==(8&k)||this.ee)&&gs(n,r,A,b,p,c),0!=(4&k)){var m=c+(this.ht-1);Es(n,p,m,p+b*this.lt,m)}C&&ks(n,u[A])}0==(128&k)&&0==(256&k)&&0==(512&k)||n.restore()}else-1!=this.Ut(r,A,b)&&Pi.debug("Skipping render for null/invisible color at ("+A+","+d+")");A+=b,p+=b*this.lt}f+=l.width,c+=this.ht,null!=t&&(t=t.next)}this.H.Ot&&this.di(),Pi.debug("Drew rows=",i),l._t=this.wi(),this.Ht()})},Ts.prototype.wi=function(){let t=this.H,e=t.Ai();if(-1===e)return e;let i=t.ci()?2*t.pi:t.pi;return t.width*e+Math.min(i,t.width-1)},Ts.prototype.di=function(){let t=this.H,e=t.Ot;if(e&&t.bi){let i=e.getContext("2d",{alpha:!1});ks(i,this.backgroundColor),i.fillRect(0,0,e.width,e.height),i.font=this.font,ks(i,this.ce);let s=t.bi,n=t.width,l=new Array(n),h=new Array(n),r=new Array(n),u=new Array(n);for(let t=0;t<n;t++)this.je(0,l,u,h,r,t,n,s.elements&&s.elements[t]?s.elements[t]:null);let o=0,a=0;for(;a<n;){let t=this.Bt(h,u,0,a,n,r);if(null!=h[a]){let e=u[a];if(ks(i,h[a]),Cs(i,h[a]),i.lineWidth=.8,Pi.debug("Statusline: Run starts at "+a+". Length="+t+", Attr=0x"+qe(e)+", FG="+h[a]+", BG="+r[a]),0!=(128&e)?(Pi.debug("Transforming status canvas for double width"),i.save(),i.transform(2,0,0,1,0,0)):0!=(256&e)&&(Pi.debug("Transforming status canvas for double height (top)"),i.save(),i.transform(2,0,0,2,0,0)),0==(512&e)){let s=0!=(2&e);if(r[a]!=this.backgroundColor||h[a]!=this.ce){ks(i,r[a]),s&&this.Te&&Cs(i,r[a]);const e=Gs/2/(this.xt||"1");i.fillRect(o,e,t*this.lt,this.ht),ks(i,h[a])}if(0!=(1&e)?this.fi(i,l,a,t,o,this.ht,s):(0==(8&e)||this.ee)&&gs(i,l,a,t,o,this.ht),0!=(4&e)){let e=this.ht-1;Es(i,o,e,o+t*this.lt,e)}}0==(128&e)&&0==(256&e)&&0==(512&e)||i.restore()}else-1!=this.Ut(l,a,t)&&Pi.debug("Statusline: skipping render for null/invisible color at "+a);a+=t,o+=t*this.lt}}},Ts.prototype.ki=function(t){let e=this.H;if(e.Ci<1||e.mi===e.height)return;let i=this.ht,s=e.Ci*i,n=(e.height,1==this.scaleMethod?s/this.it:s),l=t.getImageData(0,n,this.nt,this.st-n);t.putImageData(l,0,0),e.Ci=0},Ts.prototype.vi=function(t){for(var e=0,i=0;i<t.length;i++)e=e<<4|parseInt(t[i],16);return e};var xs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.keyboard"),Is=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.message"),Ns=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.protocol"),Ls=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.telnet"),Us=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.event"),Bs=window.COM_RS_COMMON_LOGGER.makeComponentLogger("org.zowe.terminal.core.parse");const Os=0,Vs=1,Hs=2,Qs=3,_s=80,Ks=24,Ws="Statusline",zs="statusline_id_0",Gs=10,qs=896,js={Si:0,gi:1},Zs="Input",Js="Hotspots",Xs="hotspotButton",Ys=200,$s=200;function tn(t){alert(t+": You are in the superclass!")}var en,sn=function(t){return new RegExp("[a-zA-Z]").test(t.charAt(0))};function nn(t,e){this.Ei=new Array(e||80),this.Ei.fill(32)}function ln(t,e){this.canvas=null,this.Xt=null,this.parentDiv=null,this.oiaEnabled=1,this.width=t,this.height=e,this.yi=js.Si,this.Di=new nn(this),this.Ri=new Array(this.height*this.width),this.re=null,this.Ti=80,this.Mi=24,this.Pi=[],this.Fi=null,this.xi=0,this.Wt=null,this.Kt=null,this.zt=null,this.Gt=null,this.Ii=!1,this.Ni=!1,this.Li="rgb(255,255,255)",this.Ui,this.Bi=null,this.Oi=!0,this.Vi=null,this.Hi=!1,this.Qi=new Array,this._i=!1,this.Ki=!1,this.Wi=!1,this.zi=0,this.Gi=0,this.qi=!1,this.ji=["Reset"],this.Zi=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH\n3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfH\noSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAEx\nBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576\nv////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS\n4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQ\nRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDA\nmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAU\nABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM\n7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ\n+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGt\njLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDA\nAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveE\nAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTI\nnzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dz\nNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkw\ndxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eD\nvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU\n8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAo\nRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImN\ng3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzr\nO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUd\nU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHp\nMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb//////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n/////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3ku\nZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=")}function hn(t,e){this.state,this.screen=t,this.Ji,this.Xi,this.Yi,this.$i=e}function rn(t){this.message=t,this.name="RuntimeException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function un(t){this.message=t,this.name="Exception",e.warn("Encountered exception:"+this.name+", msg:"+t)}function on(t){this.message=t,this.name="TerminalInputException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function an(t){this.message=t,this.name="UnsupportedOperationException",e.warn("Encountered exception:"+this.name+", msg:"+t)}ln.prototype.ts=function(){this.Zi&&this.Zi.play()},ln.es=function(t,parentDiv,i,s,n){e.debug(`make canvas w/ id=${t}, parentDiv=${parentDiv}, w,h=${i},${s}`);var l=document.createElement("canvas");l.id=t,l.style.zIndex=n,l.style.position="absolute",l.style.left="0px",l.style.top="0px";var h=i,r=s;return l.width=h,l.height=r,l.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",parentDiv.appendChild(l),l},ln.ss=new Array(W.length),ln.ss.fill(!1),ln.prototype.ns=function(){let t=ln.ss.length;for(var e=0;e<t;e++)if(!ln.ss[e]){ln.ss[e]=!0,this.ls=W[e];break}this.ls||(this.ls=" "),this.hs=this.ls},ln.prototype.rs=function(t){this.us(4999,t.data,"Connection to host closed due to error.\nHost: "+this.os.host+"\nPort: "+this.os.port+"\nError:"+t.data)},ln.prototype.as=function(t){this.us(t.code,t.reason,"Connection to host closed.\nHost: "+this.os.host+"\nPort: "+this.os.port+"\nCode: "+t.code+"\nReason: "+t.reason)},ln.prototype.us=function(t,e,i){if(t!=this.cs){if(Us.warn(i),!this.callbacks.wsErrorCallback)return void setTimeout(()=>{alert(i),this.closeConnection(t,e),this.Fi=null,this.fs=!1},500);this.callbacks.wsErrorCallback(t,e,i)}this.closeConnection(t,e),this.Fi=null,this.fs=!1},ln.prototype.isConnected=function(){return 2===this.zi},ln.prototype.disconnect=function(){e.info("Disconnected terminal with ID="+this.id),this.fs=!0,this._i=!0,this.closeConnection(4e3,"Terminal Closed"),this.re.Dt()},ln.prototype.closeConnection=function(t,e){this.cs=t;var i=this.Fi;if(i)try{i.close(t,e)}catch(t){}if(this.ds(),this.clear(),!this.fs){var parentDiv=this.parentDiv?this.parentDiv:document.getElementById(this.canvas.id).parentNode;try{this.ws(parentDiv);var s=parentDiv.id;this.callbacks&&this.callbacks.closeCallback&&this.callbacks.closeCallback(s)}catch(t){}this.ls&&" "!=this.ls&&(ln.ss[this.ls.charCodeAt(0)-65]=!1,this.ls=null)}this.fs=!1},ln.prototype.Jt=function(){tn("getOIAArray")},ln.prototype.As=function(){tn("initScreen")},ln.prototype.connect=function(t,e){tn("connect")},ln.prototype.ps=function(t){tn("paste")},ln.prototype.bs=function(t){tn("copy")},ln.prototype.ks=function(t,e,i,s,n,l){tn("getScreenContents")},ln.prototype.Cs=function(t){tn("setCursorPos")},ln.prototype.ms=function(t){tn("modifyCursorPos")},ln.prototype.vs=function(t){tn("enterCharacterAtCursor")},ln.prototype.clear=function(){tn("clear")},ln.prototype.ds=function(){e.info("handle unbind function")},ln.prototype.handleContainerResizeFromUI=function(parentDiv,t,e,i){null!=t&&(this.Ui=t.Ui,this.Qi=t.Qi),this.handleContainerResize(parentDiv,e,i)},ln.prototype.At=function(){var t=document.activeElement;return document.getElementById(this.canvas.id)==t||document.getElementById(this.Xt.id)==t||document.getElementById(this.Ss.id)==t},ln.prototype.ws=function(parentDiv){parentDiv.removeChild(this.Ss),parentDiv.removeChild(this.canvas),parentDiv.removeChild(this.Xt)},ln.gs=function(parentDiv,t,i,s){let n=document.createElement("div");n.id=parentDiv.id+"Statusline",n.style.zIndex="1",n.style.position="absolute",n.style.top=s+"px",n.style.left="0px",n.style.opacity="255",n.style.width=t+"px",n.style.height=i+"px";let l=n.id+"Canvas";e.debug("make canvas "+l+" parentDiv="+n);let h=document.createElement("canvas");return h.id=n.id+"Canvas",h.width=t,h.height=i,h.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",n.appendChild(h),parentDiv.appendChild(n),h},ln.Es=function(t){let e=document.createElement("textarea");e.id=t+"Input";let i=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),s=navigator.userAgent;return(i||-1!==s.indexOf("Android")||-1!==s.indexOf("iOS"))&&(e.readOnly=!0),e.style.position="relative",e.style.zIndex="3",e.style.bottom="0px",e.style.left="0px",e.style.opacity=0,e.style.width="100%",e.style.height="100%",e.style.cursor="default",e},ln.prototype.handleContainerResize=function(parentDiv,t,i){e.info("handling resize"),clearTimeout(en);var s=t||parentDiv.clientWidth,n=i||parentDiv.clientHeight;this.parentDiv=parentDiv,0!==n&&null!=n||(n=this.Ui.height),this.ws(parentDiv),this.re&&this.re.clear(),e.info("resize w="+s+" h="+n),this.ys(parentDiv,{width:s,height:n}),this.Ds(),this.re&&(this.re.canvas=this.canvas,this.re.yt(),this.Rs(this.Ui),this.re.Dt(),this.re.he());var l=this;en=setTimeout((function(){l.Ts()}),200)},ln.prototype.resize=function(t,i,s){this.width=t,this.height=i,this.size=t*this.height,this.Di.Ei=new Array(t||80),this.Di.Ei.fill(32),e.info("Resized canvas grid to r="+this.height+", c="+this.width+", size="+this.size),s||this.clear(),this.re&&(this.re.yt(),null!==this.Ui&&void 0!==this.Ui&&this.Rs(this.Ui),this.re.Dt())},ln.prototype.Ms=function(t){console.log("VirtualScreen.handleKeyUp")},ln.prototype.Ps=function(t){var e=t.keyCode,i=t.key?t.key:t.keyIdentifier;if(xs.debug("keyup "+t+" target="+t.target+" keyName='"+i+"' keyCode=0x"+qe(e)),this.Ki&&!["Shift","Control","Alt"].includes(i))return Us.debug("Screen locked by error occurrence"),t.stopPropagation(),void t.preventDefault();if(this.Ms(),xs.debug("keyup, modifier state starts at "+this.xi.toString(2)),0!==this.xi&&256!==this.xi){if("AltLeft"==i?this.xi&=-2:"AltRight"==i&&(this.xi&=-3),"Alt"==i)this.xi&=-2;else if("ControlLeft"==i)this.xi&=-5;else if("ControlRight"==i)this.xi&=-9;else if("Control"==i)this.xi&=-5;else if("OSLeft"==i||"Win"==i)this.xi&=-17;else if("OSRight"==i)this.xi&=-33;else if("ShiftLeft"==i)this.xi&=-65;else if("ShiftRight"==i)this.xi&=-129;else{if("Shift"!=i)return;this.xi&=-65}if(0===this.xi||256===this.xi){if(!this.qi&&["Shift","Control","Alt"].includes(i)){i=t.code;var s=this.Bi[i];s&&s[0]&&s[0].type&&(!this.Ki||this.ji&&this.ji.includes(s[0].value))&&this.Fs(s[0],t)}this.qi=!1}t.stopPropagation(),t.preventDefault(),xs.debug("keyup, modifier state is now "+this.xi.toString(2))}},ln.prototype.Fs=function(t,e){tn("handleKeyDown")},ln.prototype.xs=function(t){-1===navigator.appName.indexOf("Safari")&&t.getModifierState&&(t.getModifierState("CapsLock")?this.xi|=256:this.xi&=-257)},ln.prototype.Is=function(t,e){if(e.getModifierState)return this.xi=0,e.getModifierState("Control")&&(this.xi|=4),e.getModifierState("Alt")&&(this.xi|=1),e.getModifierState("Shift")&&(this.xi|=64),e.getModifierState("CapsLock")&&(this.xi|=256),(e.getModifierState("Meta")||e.getModifierState("OS")||e.getModifierState("Win"))&&(this.xi|=16),!0;if(2===t.type||8===t.type&&t.value.length>1){var i=t.value;if("CapsLock"==i)this.xi^=256;else if("AltLeft"==i)this.xi|=1;else if("AltRight"==i)this.xi|=2;else if("Alt"==i)this.xi|=1;else if("ControlLeft"==i)this.xi|=4;else if("ControlRight"==i)this.xi|=8;else if("Control"==i)this.xi|=4;else if("OSLeft"==i||"Win"==i)this.xi|=16;else if("OSRight"==i)this.xi|=32;else if("ShiftLeft"==i)this.xi|=64;else if("ShiftRight"==i)this.xi|=128;else{if("Shift"!=i)return!1;this.xi|=64}return!0}return!1},ln.prototype.Ns=function(t){const e={Add:"+",Subtract:"-",Multiply:"*",Divide:"/",Decimal:"."};this.xs(t);var i=t.keyCode,s=e[t.key]?e[t.key]:"Cancel"===t.key&&3===t.charCode&&void 0===t.code?"Pause":"Cancel"===t.key||t.key?t.key:t.keyIdentifier;if(this.Is(new Ri(8,s),t),(t.ctrlKey||t.shiftKey||t.altKey)&&!["Control","Alt","Shift"].includes(s)&&(this.qi=!0),xs.debug("keydown "+t+" target="+t.target+" keyName='"+s+"' keyCode=0x"+qe(i)),xs.debug("keydown, modifier state starts at "+this.xi.toString(2)),s.startsWith("U+")&&6==s.length){if("U+0000"===s&&(this.Us.Ls||this.Us.Bs))return;var n=parseInt(s.substring(2),16);n>=32&&n<127&&(s=String.fromCharCode(n))}var l=1==s.length&&sn(s);l&&(s=s.toLowerCase());var h=wi[s];h&&(s=h),3!==t.location||"NumLock"==s||s.startsWith("Numpad")||(s="Numpad"+s);var r,u=this.Bi[s];if(u&&null!=u){var o=0;12&this.xi&&(o|=2),3&this.xi&&(o|=4),192&this.xi&&(o|=1),256==this.xi&&l?o=1:1==o&&256&this.xi&&l&&(o=0),xs.debug("keydown modifier="+o),0===o&&(o=0);var a=u[o];a&&a.type&&a.value&&(r=a)}r?4===r.type&&(r=new Ri(1,String.fromCharCode.apply(null,r.value))):r=new Ri(8,s),(!this.Ki||this.ji&&this.ji.includes(r.value))&&(xs.debug("keydown mapping result: type="+r.type+" value="+r.value),this.Fs(r,t),xs.debug("keydown, modifier state is now "+this.xi.toString(2)))},ln.prototype.Os=function(t){if(t&&"string"==typeof t){var e=t.toLowerCase();document.execCommand(e)}},ln.prototype.Vs=function(t){tn("handleKeyCode")},ln.prototype.Hs=function(t){var e=t.charCode;this.Qs(e)},ln.prototype._s=function(t){var e=t.charCodeAt(0);this.Qs(e)},ln.prototype.Qs=function(t){tn("handleCharCodeInput")},ln.prototype.Ks=function(t){if(!this.Oi)return t;let e=t.trim().replace(/ {2,}/g,"\t");return e=e.replace(/ ([\+\-\.\d])/g,"\t$1"),e},ln.prototype.Ws=function(t){return this.Oi?t.trim().replace(/\t/g," "):t},ln.prototype.zs=function(t,e){tn("autoType")},ln.prototype.Gs=function(t){if(this.Ii&&this.re){var e=this.re.Vt(t.offsetX,t.offsetY);e.columns+1<=this.width&&(this.Gt=e.columns+1),e.rows+1<=this.height&&(this.zt=e.rows+1),this.re.Ht()}},ln.prototype.qs=function(t){this.Ii=!1},ln.prototype.js=function(t){if(!0===this.Ni)this.Ni=!1,clearTimeout(this.Zs);else{var e=this;if(this.Zs=setTimeout((function(){!0===e.Ii&&(e.Ni=!0)}),200),(2==t.button||2==t.buttons)&&this.Js||!this.re)return;this.Ii=!0;var i=this.re.Vt(t.offsetX,t.offsetY);this.Kt=i.columns,this.Wt=i.rows}},ln.prototype.Xs=function(t,e,i,s){tn("handleClick")},ln.prototype.Ys=function(t,e,i,s){tn("handleTripleClick")},ln.prototype.$s=function(t){var e=t.offsetX,i=t.offsetY;if(Us.debug("click "+t+", pos=("+e+","+i+")"),!1===this.Ni&&(this.Kt=null,this.Wt=null,this.Gt=null,this.zt=null,this.tn&&(this.tn.style.display="none"),this.re)){var s=this.re.Vt(e,i);if(Us.debug("click row,col = ",s),null!=s){var n=s.rows*this.width+s.columns;if("dblclick"==t.type){var l,h=this.Bi.en;if(h&&null!=h){var r=0;12&this.xi&&(r|=2),3&this.xi&&(r|=4),192&this.xi&&(r|=1),256==this.xi?r=1:1==r&&256&this.xi&&(r=0),xs.debug("keydown modifier="+r),0===r&&(r=0);var u=h[r];u&&(l=u)}this.in(e,i,s,n,l)}else 3==t.detail?this.Ys(e,i,s,n):this.Xs(e,i,s,n)}else Us.warn("rejecting mouse event, type="+t.type+" because rowColumn == null")}},ln.prototype.in=function(t){tn("handleDoubleClick"),Us.debug("dblclick "+t)},ln.prototype.sn=function(t){e.debug("Received connected message from server"),this.zi=2},ln.prototype.nn=function(t){this.Fi.close(4001,"server sent close/error/exception message"),this.Ki=!0},ln.prototype.Ts=function(){tn("handleResizeComplete")},ln.prototype.ln=function(t,e){return this.width*t+e},ln.prototype.Ds=function(){var t=this.Xt,e=this.Ss,i=this.hn,s=this;t.tabIndex=0,t.contentEditable=!0;let n=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),l=navigator.userAgent;var h,r=!1,u=!1;n&&(-1!==l.indexOf("Android")?r=!0:-1!==l.indexOf("iOS")&&(u=!0)),this.Us={Ls:r,Bs:u},s.Ri.fill(null),document.addEventListener("copy",(function(t){if((document.activeElement==e||document.activeElement==i)&&!s._i){Us.debug("Copy, box region start=("+this.Kt+","+this.Wt+"), end=("+this.Gt+","+this.zt+")"),t.stopPropagation();let e=s.bs(!1,!0);e=s.Ks(e),null!=e&&t.clipboardData.setData("text/plain",e),t.preventDefault(),a()}})),document.addEventListener("paste",(function(t){if((document.activeElement==e||document.activeElement==i)&&!s._i){Us.debug("Paste, box region start=("+this.Kt+","+this.Wt+"), end=("+this.Gt+","+this.zt+")"),t.stopPropagation(),Us.debug("PASTE: Found types: ",t.clipboardData.types);let e=t.clipboardData.getData("text/plain");e=s.Ws(e),e&&!0===s.ps(e)&&t.preventDefault(),a()}}));var o=this;("Firefox"==navigator.appName||"Netscape"==navigator.appName)&&parseInt(navigator.appVersion,10)<52?(e.addEventListener("blur",(function(t){o.xi&=256,o.re&&(o.re.hasFocus=!1,Us.info("Terminal focus lost"),o.re.Ht())})),e.addEventListener("focus",(function(t){o.re&&(o.re.hasFocus=!0,Us.info("Terminal gained focus"),o.re.Ht())}))):(e.addEventListener("focusout",(function(t){o.xi&=256,o.re&&(o.re.hasFocus=!1,Us.info("Terminal focus lost"),o.re.Ht())})),e.addEventListener("focusin",(function(t){o.re&&(o.re.hasFocus=!0,Us.info("Terminal gained focus"),o.re.Ht())}))),e.addEventListener("compositionstart",(function(t){if(Us.debug("Compositionstart: ",t),s.Hi=!0,!s._i){a();var i=Math.floor(s._t/this.width),n=Math.floor(s._t%this.width);e.style.top=i*(s.re.ht/s.re.it)+"px",e.style.left=n*(s.re.lt/s.re.et)+"px"}})),e.addEventListener("compositionupdate",(function(t){Us.debug("Compositionupdate: data="+t.data),s.Hi=!0,s._i||(h=t.data,s.Ri.fill(null),s.rn(h))})),e.addEventListener("compositionend",(function(t){Us.debug("Compositionend seen"),Us.debug("Compositionend: "+JSON.stringify(t)+", data="+t.data),s.Hi=!1,s._i||(s.Ri.fill(null),h&&(s.zs(h),e.value="",e.style.top="0px",e.style.left="0px"))})),e.addEventListener("unload",(function(t){s.closeConnection()}));var a=function(){s.Ni=!1;let t=s.Ss;t.value="",t.selectionEnd=0,t.selectionStart=0,s.Kt=null,s.Wt=null,s.Gt=null,s.zt=null,s.re&&s.re.Ht()};e.addEventListener("wheel",(function(t){s._i?(Us.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):s.un(t)})),e.addEventListener("keydown",(function(t){s._i?(Us.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):s.Hi||(e.value="",Us.debug("Keydown: ",t),s.Ns(t))})),e.addEventListener("keyup",(function(t){s._i?(Us.debug("Script in progress: rejecting keyup"),t.stopPropagation(),t.preventDefault()):(a(),s.Hi||s.Ps(t))})),e.addEventListener("keypress",(function(t){s._i?(Us.debug("Script in progress: rejecting keypress"),t.stopPropagation(),t.preventDefault()):s.Ki?(Us.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):s.Hi||(e.value="",Us.debug("Keypress: ",t),s.Ns(t),t.stopPropagation(),t.preventDefault())})),(r||u)&&e.addEventListener("input",(function(){if(Us.debug("Input event seen. value="+e.value+", textContent="+e.textContent),s._i)Us.debug("Script in progress: rejecting input");else if(s.Ki)Us.debug("Screen locked by error occurrence: rejecting input");else{a();var t=e.value;if(t){e.value="",Us.debug("Input was "+t),Us.debug("Textcontent is now "+e.value);for(var i=0;i<t.length;i++)s._s(t.charAt(i))}Us.debug("Empty input event ignored.")}})),e.addEventListener("mouseup",(function(t){s._i?Us.debug("Script in progress: rejecting mouseup"):(Us.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.qs(t))})),e.addEventListener("mousedown",(function(t){s._i?Us.debug("Script in progress: rejecting mousedown"):(Us.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.js(t))})),e.addEventListener("mouseenter",(function(t){Us.log(Us.FINER,"mouse event "+t+" target="+t.target);let e=s.Ss;!s.Hi&&e&&e.value.length>0&&(e.value="",e.selectionEnd=0,e.selectionStart=0)})),e.addEventListener("mousemove",(function(t){s._i?Us.log(Us.FINER,"Script in progress: rejecting mousemove"):(Us.log(Us.FINER,"mouse event "+t+" target="+t.target),t.target.focus(),s.Gs(t))})),t.addEventListener("click",(function(t){s._i?(Us.debug("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),Us.debug("click event "+t+" target="+t.target),t.target.focus(),s.$s(t))})),e.addEventListener("click",(function(t){s._i?(Us.warn("Script in progress: rejecting click"),t.stopPropagation()):(Us.debug("click event "+t+" target="+t.target),t.target.focus(),s.$s(t))})),e.addEventListener("dblclick",(function(t){s._i?(Us.warn("Script in progress: rejecting dblclick"),t.stopPropagation()):s.Ki?(Us.warn("Screen locked by error occurrence: rejecting dblclick"),t.stopPropagation()):(t.stopPropagation(),Us.debug("dblclick event "+t+" target="+t.target),!0===s.Ni&&(Us.debug("dblclick set drag to false"),s.Ni=!1,clearTimeout(s.Zs)),t.target.focus(),s.$s(t))})),e.addEventListener("contextmenu",(function(t){if(s.Ni=!1,s.Ii=!1,s.Js&&t.shiftKey||!s.Js&&!t.shiftKey)s._i?(Us.debug("Script in progress: rejecting contextmenu"),t.stopPropagation()):(Us.debug("mouse event "+t+" target="+t.target),t.target.focus(),s.on(t));else if(null!=s.Kt&&null!=s.Gt){let t=s.Ss;t&&(0==t.value.length&&(t.value="c"),t.select())}}))},ln.prototype.toString=function(){return"<VirtualScreen size="+this.size+">"},ln.prototype.an=function(t){tn("processMessage")},ln.prototype.cn=function(){tn("getPos")},ln.prototype.fn=function(){this.callbacks||(this.callbacks={}),this.callbacks.passwordPrompt||(this.callbacks.passwordPrompt=function(t){setTimeout((function(){let e=prompt("Script paused for password input. Enter password.");t(e)}),100)})},ln.prototype.ys=function(parentDiv,t){this.parentDiv=parentDiv;let e=parentDiv.id;var i=e+"Canvas";this.canvas=ln.es(i,parentDiv,t.width,t.height,1);var s=e+"SelectionCanvas";return this.Xt=ln.es(s,parentDiv,t.width,t.height,2),this.Xt.innerHTMLMessageLength=this.Xt.innerHTML.length,this.Ss=ln.Es(e),parentDiv.appendChild(this.Ss),{canvas:this.canvas,Xt:this.Xt,dn:this.Ss}},hn.prototype.wn=function(){if(this.$i&&this.Ji.length>0){var t=Ye(this.Ji),e={t:this.$i,data:t};Is.debug("sending telnet options, dump follows"),je(this.Ji,Is),null!=this.screen.Fi&&this.screen.Fi.send(JSON.stringify(e)),this.Ji=[]}},ci(Jn,ln,[Jn.Fs,Jn.Ps,Jn.Qs,Jn.Vs,Jn.Xs,Jn.in,Jn.Ts,Jn.zs,Jn.Jt,Jn.As,Jn.cn,Jn.connect,Jn.bs,Jn.ps,Jn.ws,Jn.handleContainerResize]);const cn=/[`~!@#$%^&\*()+={}\[\];:\'<>?,]+/,fn=/[0-9a-zA-Z-_.\/]+/;var dn=!1;const wn=1,An=2,pn=-1,bn=0,kn=1,Cn=2,mn=3,vn=4,Sn=5,gn=6,En=7,yn=8,Dn=9,Rn=10,Tn=11,Mn=12,Pn=13,Fn=14,xn=15,In=16,Nn=17,Ln=18,Un=19,Bn=20,On=21,Vn=22;function Hn(t){this.An=65533,this.Ye=Jn.$e,this.Je=0,this.ni=Jn.$e,this.si=0,this.Ge=Jn.Qe,this.qe=Jn._e,this.ze=t}function Qn(parentDiv,t,e){this.scrollPos=0,this.pn(parentDiv,t,e)}Hn.prototype.bn=function(){return 65533!=this.An?65533:this.ze},Qn.prototype.pn=function(parentDiv,t,e){this.kn=document.createElement("div"),this.kn.id=parentDiv.id+"scrollingDiv",this.kn.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   overflow-y: scroll;\n                                   width: ${t}; height: ${e};`,this.kn.style.zIndex=1,this.kn.style["background-color"]="white",this.kn.style.width=t+"px",this.kn.style.height=e+"px",this.Cn=e,this.mn=e,this.vn=document.createElement("div"),this.vn.id=this.kn.id+"Inner",this.vn.style.cssText="position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   width: 90%;",this.vn.style.height=e+"px",this.vn.style.zIndex=1,this.kn.appendChild(this.vn)},Qn.prototype.Sn=function(t){let e=this.kn.scrollHeight-this.kn.clientHeight;-1==t||t>e?(this.scrollPos=e,this.kn.scrollTop=e):(this.scrollPos=t,this.kn.scrollTop=t)},Qn.prototype.gn=function(){return this.kn},Qn.prototype.En=function(parentDiv){if(this.vn||this.kn)try{this.kn.removeChild(this.vn),parentDiv.removeChild(this.kn),this.vn=null,this.kn=null}catch(t){e.severe("Could not remove scrolling div from parent="+parentDiv)}},Qn.prototype.resize=function(t,e){this.kn.style.width=t,this.kn.style.height=e,this.kn.style["overflow-y"]="scroll",this.vn.style.width="90%";let i=this.mn/this.Cn*e;this.vn.style.height=i,this.Cn=e,this.mn=i},Qn.prototype.yn=function(){return this.scrollPos},Qn.prototype.cn=function(){return this.kn.scrollTop},Qn.prototype.Dn=function(){this.scrollPos=this.kn.scrollTop},Qn.prototype.Rn=function(t){return t/this.Tn},Qn.prototype.Mn=function(t,e){let i=t*e;this.Tn=t,this.vn&&(this.vn.style.height=i+"px",this.mn=i,this.Dn())},Jn.prototype.Pn=function(){let t=new Array(Jn.Fn);for(let e=0;e<Jn.Fn;e++)t[e]={elements:new Array};return t},Jn.prototype.xn=function(t){const e=parseInt(Jn.Fn/this.height);return Math.min(Math.max(1,t),e)},Jn.prototype.In=function(){return(this.xn(this.Nn)-1)*this.height},Jn.prototype.Ln=function(){let t=this.In(),e=this.Un;for(let i=0;i<this.height&&e;i++)e.elements&&(this.Bn[t].elements=JSON.parse(JSON.stringify(e.elements))),this.On(e),this.Vn(!0),e=e.next,t++},Jn.prototype.Hn=function(t){let e=this.In();for(let i=0;i<this.height;i++){let s=new Kn(this.width),n=this.Bn[e].elements||[];s.elements.splice(0,n.length||0,...n),0===i?(t?(s.Qn=t,t.next=s):this._n=s,this.Un=s,this.xe=s,this.Kn=s):(s.Qn=this.Kn,s.updated=!0,this.Kn.next=s,this.Kn=s),this.Wn(!0),e++}},Jn.prototype.zn=function(t){const e=t||this.height;this.mi=this.Gn?this.qn+e:e},Jn.prototype.jn=function(){(null!==this.Zn&&null!==this.Jn&&this.Zn>=this.Jn||this.Zn>=this.height||this.Jn>this.height)&&(this.Zn=0,this.Jn=this.height-1)},Jn.prototype.Xn=function(t,e,i){t=this.xn(t);let s=this.Un&&this.Un.Qn?this.Un.Qn:null;const n=e?this.Yn():0,l=e?this.pi:0;(t!==this.Nn||i)&&(this.Ln(),i&&(this.$n=this.tl>t,this.zn(i),this.resize(this.width,i,!0),this.jn(),t=this.xn(t)),this.Nn=t,this.Hn(s)),this.el(n,l)};var _n=0;function Kn(t,e){this.elements=new Array(t),this.updated=!0,null==e&&(this.id=_n++)}var Wn=function(t,e){t||(t={fontProperties:{scaleMethod:2}});var i=t.fontProperties.size?t.fontProperties.size:Ds.fontSize,s=t.fontProperties.weight?t.fontProperties.weight:Ds.fontWeight,n=t.fontProperties.style?t.fontProperties.style:Ds.fontStyle,l=t.fontProperties.name?t.fontProperties.name:Ds.J,h=e.getContext("2d");h.font=n+" "+s+" "+i+"px "+l;var r=i,u=h.measureText("M").width,o=Math.floor(e.width/u);return{rows:Math.floor(e.height/r),columns:o}},zn=function(t){var i="--------------------------------------------------------------------------------";t&&t.debug?t.debug(i):e.debug(i)};const Gn=function(t,e){var i=e;return t.length>0&&(i=Number(t)),i<e&&(i=e),i},qn=function(t,e,i){let s=!1;for(let n=e;n>=0;n--)if(1===i[n]&&0==--t)return s=!0,n;if(!s)return 0},jn=function(t,e,i){const s=t+e;return Math.max(Math.min(s,i-1),0)},Zn=function(t,e,i){const s=t+e;return Math.max(Math.min(s,i-1),0)};function Jn(t,i,s,n){this.zi=0,this.canvas=null,this.Xt=null,this.parentDiv=null,this.oiaEnabled=0,this.width=t,this.height=i,this.yi=js.Si,this.Di=new nn(this,this.width),this.Ri=new Array(this.height*t),this.re=null,this.Ti=t,this.Mi=i,this.Pi=[],this.Fi=null,this.vn=n,this.xi=0,this.Wt=null,this.Kt=null,this.zt=null,this.Gt=null,this.Ii=!1,this.Ni=!1,this.Li="rgb(255,255,255)",this.il,this.size=t*i,this.sl=new Array(this.size),this.clear(),this._t=0,this.nl=0,this.Y=Jn.X,e.debug("charsetInfo = "+this.Y),this.qn=s-i,this.mi=s,this.ll=0,this.pi=0,this.hl=[],this.xe=null,this.Un=null,this.rl=null,this.tl=0,this.ul=!1,this.ol=0,this.al=0,this._n=null,this.Kn=null,this.cl=[],this.fl=null,this.dl=!0,this.wl=!1,this.Al=!1,this.pl=!1,this.bl=0,this.kl=80,this.Cl=24,this.ml=24,this.vl=0,this.Bi=Mi,this.$n=!1,this.Xe=0,this.Ye=Jn.$e,this.Je=0,this.ni=Jn.$e,this.si=0,this.Sl=!1,this.gl=!1,this.El=0,this.yl=0,this.Dl=!1,this.Rl=Jn.Tl(),this.Ml=0,this.Pl=1,this.Fl=!1,this.xl=0,this.termType=1,this.Il=!1,this.Nl=!0,this.Ll={status:!1,key:""},this.Oi=!0,this.Ul=!1,this.Zn=null,this.Jn=null,this.Bl=!1,this.ns(),this.ui=new Array(this.height),this.Ci=0,this.Ol=!1,this.Vl=2,this.Hl=!1,this.Ql=!1,this._l=!1,this.lineNumber=0,this.Ze=!0,this.Kl=0,this.Wl=0,this.zl=0,this.Gl=0,this.ql=Jn.jl(),this.Zl=0,this.Jl="",this.Ki=!1,this.Gi=0,this.Xl=!1,this.Nn=1,this.Bn=this.Pn(),this.Yl=!1,this.$l=!1,this.Qt=!0,this.Ot=null,this.th=0,this.eh=0,this.bi=null,this.ih=0,this.sh=this.sh.bind(this),this.nh=!0}Jn.Tl=function(){return[Jn.Qe,Jn._e,Jn.Ke,Jn.lh]},Jn.jl=function(){return[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},Jn.hh=function(parentDiv,t,e){let i=document.createElement("div");return i.id=parentDiv.id+"innerScrolling",i.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 255; cursor: default;\n                             width: ${t}; height: ${e};`,i.style.zIndex=2,i.style.width=t+"px",i.style.height=e+"px",i},Jn.$e=0,Jn.ti=1,Jn.ei=2,Jn.ii=3,Jn.Qe=66,Jn._e=60,Jn.Ke=48,Jn.lh=65,Jn.Fn=144,Jn.rh="insert",Jn.uh="delete",Jn.oh=function(t){if(t)return{t:"VT_INPUT",data:Ye(t)}},Jn.ah=function(t,e,i){for(var s,n=t,l=e;l<i.elements.length;l++)s=i.elements[l],i.elements[l]=n,n=s},Jn.prototype.Fs=function(t,e){[Oe,Ve].indexOf(this.Wl)>-1&&["Cursor Down","Cursor Up"].indexOf(t.value)>-1?console.log("don't handle cursor up and cursor down when input username/password"):(this.Ll.key!==e.code&&(this.Ll.key=e.code,this.Ll.status=!1),this.Nl||!this.Ul||"virtualKey"===e.code?this.fh(t,e):this.Ll.status||(this.Ll.status=!0,this.fh(t,e)))},Jn.prototype.Ms=function(t){this.Ll.status=!1},Jn.dh=function(t){return t.push(27),t.push(91),t.push(56),t.push(109),t},Jn.prototype.wh=function(){let t=this.Ah()+1,e=this.ph();t>this.width-1&&(e.elements.push(null),e.elements.shift(),t=this.width-1),this.bh()?this.ih=t:this.pi=t,this.kh(t)},Jn.Ch=function(t){return t.push(27),t.push(91),t.push(48),t.push(109),t},Jn.mh=function(t){switch(t.termType){case 1:t.vh=Ie;break;default:t.vh=xe}},Jn.Sh=function(t){switch(t.termType){case 1:t.termTypeString="xterm";break;case 2:t.termTypeString="vt220";break;case 0:t.termTypeString="vt320";break;case 3:t.termTypeString="vt420"}},Jn.gh=function(t,e,i,s){var n=t.fontProperties.size?t.fontProperties.size:Ds.fontSize,l=t.fontProperties.weight?t.fontProperties.weight:Ds.fontWeight,h=t.fontProperties.style?t.fontProperties.style:Ds.fontStyle,r=t.fontProperties.name?t.fontProperties.name:Ds.J;let u=ln.es(e.id+"tempSizeCalc",e,i,s,0);var o=u.getContext("2d");o.font=h+" "+l+" "+n+"px "+r;var a=n,c=o.measureText("M").width;let f=Math.floor(u.width/c),d=Math.floor(u.height/a);return e.removeChild(u),{width:f,height:d}},Jn.prototype.Eh=function(parentDiv){if(this.Ot){let t=this.Ot.parentNode;t.removeChild(this.Ot),parentDiv.removeChild(t)}},Jn.prototype.ws=function(parentDiv){this.yh?(this.yh.En(parentDiv),this.vn.removeChild(this.Ss),this.vn.removeChild(this.canvas),this.vn.removeChild(this.Xt),this.Eh(this.vn),parentDiv.removeChild(this.vn)):(parentDiv.removeChild(this.Ss),parentDiv.removeChild(this.canvas),parentDiv.removeChild(this.Xt),this.Eh(parentDiv))},Jn.prototype.sh=function(t){var e=!1;if(this.re)if(e)t.preventDefault();else{this.Dh=-1,e=!0;try{this.Rh(t.target.scrollTop)}catch(t){console.log(t.stack?t.stack:t.message)}finally{e=!1}}},Jn.prototype.Th=function(){this.yh.gn().addEventListener("scroll",this.sh)},Jn.prototype.Rh=function(t){const e=this.yh,i=e.mn-e.Cn,s=Math.max(this.ol,this.al)-this.height;let n=Math.max(0,Math.round(t*s/i)),l=this._n;for(;n>=0;)this.xe=l,l=l.next,n--;this.$n&&(this.$n=!1,this.Un=this.xe),this.Wt=n,this.zt=n+this.height,this.re.oi(n),e.Dn()},Jn.prototype.Mh=function(parentDiv){if(!this.Fl||!this.tl)return;const t=parentDiv.clientHeight||this.Ui.height,e=parentDiv.clientWidth||this.Ui.width,i=Jn.gh(this.Ui,parentDiv,e,t),s=this.Yn();let n=this.height-i.height;if(s>=i.height){for(;n>0;)this.Un=this.Un.next,n--;for(;n<0;)this.Un=this.Un.Qn,n++}else{let t=i.height-Math.min(this.height,this.tl);for(;t>0;)this.Ph(),t--;this.Kn=this.Fh(i.height-1)}this.yh&&(this.ol-=n,this.al-=n),this.width=i.width,this.height=i.height},Jn.prototype.handleContainerResize=function(parentDiv,t,i){e.info("handling resize"),clearTimeout(en),this.Mh(parentDiv);var s=t||parentDiv.clientWidth,n=i||parentDiv.clientHeight;0!==n&&null!=n||(n=this.Ui.height),null==this.xh&&(this.xh=this.yh?this.yh.cn():0),this.ws(parentDiv),this.re&&this.re.clear(),e.info("resize w="+s+" h="+n);let l=this.Ih(n,this.height,this.th);if(this.Gn){let t=this.yh;t.pn(parentDiv,s,n),s-=15;let e=Jn.hh(parentDiv,s,l);this.vn=e,parentDiv.appendChild(t.gn()),parentDiv.appendChild(e),this.ys(e,{width:s,height:l}),this.parentDiv=parentDiv,e.style.position="absolute",this.Th(),0!==this.th&&this.Nh(l,this.th)}else this.ys(parentDiv,{width:s,height:l}),0!==this.th&&this.Nh(l,this.th);this.Ds(),this.re&&(this.re.canvas=this.canvas,this.re.yt(),this.Rs(this.Ui),this.re.Dt(),this.re.he()),this.Gn&&(this.yh.gn().style.opacity="255"),this.yh&&(this.$n=!0,this.Lh());var h=this;en=setTimeout(()=>{h.Ts()},200)},Jn.prototype.on=function(t){t.preventDefault()},Jn.prototype.Ai=function(){if(!this.xe||!this.rl)return-1;let t=this.height,e=this.xe,i=this.rl.id;for(let s=0;s<t;s++){if(!e)return-1;if(e.id===i)return s;e=e.next}return-1},Jn.prototype.Uh=function(){return 1},Jn.prototype.connect=function(t,e){if(0===this.zi){this.zi=1;let n=this;var i=new WebSocket(t);n.Fi=i,i.onopen=function(){if(e.host&&e.port){var t={t:"CONFIG",host:e.host,port:Number(e.port)};1===e.security?t.security={t:"ssh",termt:n.termTypeString,termr:n.height,termc:n.width,badCert:e.Bh}:2===e.security?(Is.warn("We dont support TLS yet. Try SSH!"),i.close()):0!=e.security&&(Is.info("Unknown security type requested!"),i.close()),i.send(JSON.stringify(t)),Is.debug("Sent ",t)}};var s=!1;i.onmessage=function(t){var e=JSON.parse(t.data);if(Is.log(Is.FINER,"ws.onMessage ",e),null!=n.re){var i=9;n.Di.Ei[i++]=88,n.Di.Ei[i++]=vt[0],n.Di.Ei[i++]=vt[1],n.Di.Ei[i++]=vt[2],n.re.Ht()}n.an(e),s||(s=!0,n.callbacks&&n.callbacks.readyCallback&&n.callbacks.readyCallback.apply(this,null))},i.onerror=function(t){n.callbacks&&n.callbacks.unexpectedErrorConnectionHook?n.callbacks.unexpectedErrorConnectionHook(n,t):(n.rs(t),i=null)},i.onclose=function(t){n.callbacks&&n.callbacks.unexpectedCloseConnectionHook?n.callbacks.unexpectedCloseConnectionHook(n,t):(n.as(t),i=null)}}},Jn.prototype.Jt=function(){var t,e=this.Di.Ei,i=this.pi+1,s=(this.Yn()+1).toString(),n=i.toString(),l=76;e[l--]=47;for(let i=2;i>-1;i--)s.length<i?e[l--]=32:(t=s.charAt(i))&&(e[l--]=t.charCodeAt(0));l=79;for(let i=2;i>-1;i--)n.length<i+1?e[l--]=32:(t=n.charAt(i))&&(e[l--]=t.charCodeAt(0));return this.yi==js.Si&&0!=this.os.security&&(e[3]=43),e},Jn.prototype.un=function(t){const e=this.yh;if(!e)return;const i=Math.max(e.cn()+t.deltaY,0);e.Sn(i)},Jn.prototype.Ys=function(t,e,i,s){var n=i.rows,l=i.columns;let h=this.xe;if(n<0||n>this.height||l<0||l>this.width)Us.warn("clicking out of bound "+i);else{for(let t=0;t<n;t++){if(!h)return void Us.warn("clicking out of bound "+i);h=h.next}h&&(this.Wt=n,this.zt=n+1,this.Kt=0,this.Gt=this.width,this.re&&this.re.Ht())}},Jn.prototype.in=function(t,e,i,s){var n=i.rows,l=i.columns;let h=this.xe;if(n<0||n>this.height||l<0||l>this.width)Us.warn("clicking out of bound "+i);else{for(let t=0;t<n;t++){if(!h)return void Us.warn("clicking out of bound "+i);h=h.next}if(h){this.Wt=n,this.zt=n+1;var r=this.Oh(h),u=r.charAt(l),o=l,a=l;if(" "==u){for(;" "==r.charAt(o--););for(;" "==r.charAt(a++););}else if(null!=u.match(cn)){for(;null!=r.charAt(o--).match(cn););for(;null!=r.charAt(a++).match(cn););}else if(null!=u.match(fn)){for(;null!=r.charAt(o--).match(fn););for(;null!=r.charAt(a++).match(fn););}o++,a--,this.Kt=o+1,this.Gt=a,this.re&&this.re.Ht()}}},Jn.prototype.On=function(t){let e=t.Qn;e&&(e.next=t.next),t.next&&(t.next.Qn=e),t.id==this._n.id&&(this._n=this._n.next),t.id==this.Un.id&&(this.Un=this.Un.next)},Jn.prototype.Vh=function(t,e){let i=this.lineNumber;const s=this.Yn();for(let s=0;s<t;s++){if(e&&null!=this.Zn&&(i<this.Zn||i>this.Jn)){Ns.debug("-- DL: deleteLine range is out of current cursor position");break}this.Hh(e),e=e.next,i++}this.rl=this.Fh(s)},Jn.prototype.Qh=function(t,e){let i=this.lineNumber;const s=this.Yn();for(let s=0;s<t;s++){if(e&&null!=this.Zn&&(i<this.Zn||i>this.Jn)){Ns.debug("-- DL: deleteLine range is out of current cursor position");break}let t=e||this._h(i);this.Kh(t),e=e.Qn,i++}this.rl=this.Fh(s)},Jn.prototype.Wh=function(t,e,i,s,n){let l=null!=this.Zn?this.Fh(this.Zn):null;for(var h=t+i>this.height?this.height-1-i:t,r=this.Fh(s),u=0;u<h;u++){if(null!=r){var o=new Kn(this.width);r.next?r.next.Qn=o:r.id===this.Kn.id&&(this.Kn=o),o.Qn=r,o.next=r.next,r.next=o,r=o}var a;e.next?a=e.next:(a=new Kn(this.width),e.next=a,a.Qn=e,this.Wn(!0)),e.id!=this.Un.id||l&&e.id==this.Un.id&&l.id==this.Un.id?this.On(e):e.id==this.Un.id&&(this.mi<=this.height||this.al>=this.mi?this.Un.id==this._n.id?this.On(this.Un):(this.On(this._n),this.Un=this.Un.next):(this.Un=this.Un.next,this.Wn(!1))),e=a,n&&(this.rl=e)}},Jn.prototype.Vn=function(t){this.al--,this.ol--,t&&this.tl--},Jn.prototype.Wn=function(t){this.al++,this.ol++,t&&this.tl++},Jn.prototype.zh=function(t,e,i,s,n){for(var l=t+i>this.height?this.height-1-i:t,h=this.Fh(s),r=0;r<l;r++){h.id===this.Kn.id&&(this.Kn=h.Qn),h.Qn.next=h.next,h=h.Qn;var u=new Kn(this.width);e.Qn?e.Qn.next=u:this._n=u,this.Un.id==e.id&&(this.Un=u,this.xe=this.Un),u.Qn=e.Qn,u.next=e,e.Qn=u,e=u,n&&(this.rl=u)}},Jn.prototype.ks=function(t,e,i,s,n,l,h,r){var u=[],o=this.xe;let a=-1!==navigator.userAgent.indexOf("Windows");if(i>=0)for(let t=0;t<i;t++){if(!o)return"";o=o.next}else for(let t=0;t>i;t--){if(!o)return"";o=o.Qn}for(var c=i;c<s;c++){h||c==i||(a&&u.push(13),u.push(10));var f=e,d=t;r&&c!=s-1&&(f=this.width),r&&c!=i&&(d=0);for(var w=d;w<f;w++)if(null!=o){var A=o.elements[w];if(A&&0!=(64&A.Xe))u.push(32);else if(A||!0!==l){var p=A.ze;(!p||p<32)&&!0===l?u.push(32):u.push(p)}else u.push(32)}else u.push(32);o&&(o=o.next)}return String.fromCharCode.apply(null,u)},Jn.prototype.bs=function(t,e,i){if(null!=this.Kt&&null!=this.Gt){var s=Math.min(this.Kt,this.Gt),n=Math.max(this.Kt,this.Gt),l=Math.min(this.Wt,this.zt),h=Math.max(this.Wt,this.zt);return this.ks(s,n,l,h,t,e,i)}return null},Jn.prototype.ps=function(t){if(this.rl&&t){for(var e=[],i=0;i<t.length;i++)e.push(t.charCodeAt(i));return this.Gh(e),!0}return!1},Jn.prototype.qh=function(){var t=(65280&this.width)>>8,e=255&this.width,i=(65280&this.height)>>8,s=255&this.height;this.jh(31,[t,e,i,s])},Jn.prototype.Zh=function(){var t={t:"SSH_CH_REQ",reqt:"window-change",reply:!1,data:[this.width,this.height,this.canvas.width,this.canvas.height]};1===this.Fi.readyState&&this.Fi.send(JSON.stringify(t))},Jn.prototype.Ts=function(){if(Us.debug("Resize completed"),this.Il){var t=Wn(this.Ui,this.Xt),e=!1;t.rows<this.height&&(Us.debug("Resizing, old height was "+this.height+", new height will be "+t.rows),e=!0),this.Gn?this.mi=this.qn+t.rows:this.mi=t.rows,this.resize(t.columns,t.rows,!0),this.Un&&Us.debug("After resize, scrolling viewport to bottom. Top ID="+this.Un.id),this.Jh(1),this.xe=this.Un,this.Un&&Us.debug("Scroll complete. Top ID="+this.Un.id),this.Gn&&(this.yh.gn().scrollTop=this.yh.gn().scrollHeight,this.yh.scrollPos=this.yh.gn().scrollTop),1!=this.os.security?this.qh():this.Zh(),e&&this.xe&&(Us.debug("After resize, scrolling viewport to bottom. Top ID="+this.xe.id),this.Jh(1),Us.debug("Scroll complete. Top ID="+this.xe.id))}},Jn.prototype.Xs=function(t,e,i,s){Us.debug("VT click encountered")},Jn.prototype.Rs=function(t){null!=t&&this.re.Et(this.Ui.fontProperties),this.re.Dt()},Jn.prototype.Xh=function(t){return!this._n||(null==t&&(t=this.Yn()),this.rl.id==this.Kn.id||this.Yh&&t==this.Jn)},Jn.prototype.$h=function(){return!this._n||this.rl.id==this._n.id},Jn.prototype.tr=function(t){if(Ns.log(Ns.FINEST,"Addline entry. IL ID="+(null==this.rl?null:this.rl.id)+", TT ID="+(null==this.Un?null:this.Un.id)+", Buff lines="+this.al),this.bh())return this.bi=this.er(),void(this.ih=0);var e=new Kn(this.width);const i=this.Yn();return this.Bl=this.ir(i),null==this._n?(this._n=e,this.Kn=e,this.Un=e,this.xe=e,this.rl=null,this.lineNumber=0,this.Wn(!0)):(this.al>=this.mi&&!t&&this.tl>this.height?1===this.mi?(this._n=e,this.Kn=e,this.Un=e,this.xe=this.Un):2===this.mi?(this._n=this._n.next,this._n.Qn=null,this._n.next=e,e.Qn=this._n,this.Un=this._n,this.xe=this.Un,this.Kn=e):this.mi<=this.height?(this._n=this._n.next,this.Un=this._n,this.xe=this.Un,this._n.Qn=null,this.Kn.next=e,e.Qn=this.Kn,this.Kn=e):(this._n=this._n.next,this._n.Qn=null,this.Kn.next=e,e.Qn=this.Kn,this.Kn=e,this.Un=this.Un.next,this.xe=this.xe.next):!t&&(this.tl>=this.height||this.Bl&&i===this.Jn)?(this.sr(e,i===this.Jn),this.nr()):(e.Qn=this.Kn,this.Kn.next=e,this.Kn=e,this.Wn(!0)),this.lineNumber++,this.lineNumber++),this.yh&&(this.mi<this.al||this.mi<this.ol)&&(this._n=this._n.next,this.ol=Math.min(this.mi,this.ol),this.al=Math.min(this.mi,this.al)),this.rl=e,this.pi=0,this.Lh(),Ns.log(Ns.FINEST,"-- Addline exit. IL ID="+this.rl.id+", TT ID="+this.Un.id+", Buff lines="+this.al),e},Jn.prototype.sr=function(t,e){if(e&&this.Jn<this.height-1&&this.rl){let e=this.rl;t.Qn=e,t.next=e.next,e.next=t,this.Kn&&this.Kn.id===e.id&&(this.Kn.next=t,this.Kn=t)}else t.Qn=this.Kn,this.Kn.next=t,this.Kn=t},Jn.prototype.lr=function(){if(!this.Un)return null;let t=this.Un;for(let e=0;e<this.Zn;e++){if(!t.next){t=null;break}t=t.next}return t},Jn.prototype.nr=function(){if(this.Bl&&this.Zn>0&&this.lr()){let t=this.Un.Qn,e=this.lr();t&&(t.next=e),this.Un.Qn=e;let i=e.Qn;i.next=e.next,e.next.Qn=i,e.Qn=t,e.next=this.Un,this._n.id===this.Un.id&&(this._n=e),this.ol=Math.max(this.al,this.ol,this.height)}else this.Un=this.Un.next,this.xe=this.Un;this.Wn(!1)},Jn.prototype.hr=function(t){return!this.Jn||(void 0===t&&(t=this.Yn()),t>=this.Zn&&t<=this.Jn)},Jn.prototype.ir=function(t){return!!this.Jn&&(void 0===t&&(t=this.Yn()),t>=this.Zn&&t<=this.Jn)},Jn.prototype.Oh=function(t){var e="";if(void 0!==t.elements)for(var i=0;i<t.elements.length;i++)if(null!==t.elements[i]&&void 0!==t.elements[i]){var s=String.fromCharCode(t.elements[i].ze);e+=null===s||" "===s?" ":s}else e+=" ";return e},Jn.prototype.rn=function(t){this.Hi=!1,"Delete"!==this.Jl&&"Backspace"!==this.Jl&&this.Qs(t.charCodeAt(t.length-1))},Jn.prototype.As=function(t){this.pi=0,t?(this.Un=null,this.xe=null,this.rl=null,this.tl=0,this.al=0,this._n=null,this.Kn=null,this.Ci=0):this.rr()},Jn.prototype.ur=function(){return null!=this.Zn?this.Fh(this.Zn):this.Un},Jn.prototype.or=function(){return null!=this.Jn?this.Fh(this.Jn):this.Fh(this.height-1)},Jn.prototype.ar=function(t){let e=t;const i=this.Yn();for(;e>0;)this.Hh(),e--;this.rl=this.Fh(i)},Jn.prototype.cr=function(t){let e=t;const i=this.Yn();for(;e>0;)this.Kh(),e--;this.rl=this.Fh(i)},Jn.prototype.Kh=function(t){const e=null!=this.Jn,i=this._n.id===this.Un.id,s=this.pi,n=new Kn(this.width),l=t||this.ur(),h=l.Qn,r=this.or(),u=!t||t.id===this.Un.id,o=!e&&u||e&&(t?u:0===this.Zn);h?(n.Qn=h,h.next=n,n.next=l,l.Qn=n):(n.next=l,l.Qn=n),this.pi=s,this.On(r),o&&(this.Un=n,this.xe=n,this._n=i?n:this._n),this.Kn.id===r.id&&(this.Kn=r.Qn)},Jn.prototype.Hh=function(t){const e=null!=this.Jn,i=this._n.id===this.Un.id,s=this.pi,n=new Kn(this.width),l=t||this.ur(),h=this.or(),r=!t||t.id===this.Un.id;n.Qn=h,n.next=h.next,h.next=n,this.pi=s,this.On(l),(!e&&r||0==this.Zn)&&(this.xe=this.Un,this._n=i?this.Un:this._n),this.Kn.id===h.id&&(this.Kn=n)},Jn.prototype.Vs=function(t){Us.debug("Handlekeycode hit")},Jn.prototype.Qs=function(t){if(xs.debug("keypress, charCode="+t),160==t&&(t=32),t>=32&&t<127){if(xs.debug("normal press code=0x"+qe(t)),this.Wl===Ve)return void this.cl.push(t);this.Gh([t])}else xs.debug("Unhandled key press 0x"+qe(t)),this.ts()},Jn.prototype.clear=function(){this.yh?this.As(!1):this.As(!0),Ns.debug("Clear: should have cleared screen")},Jn.prototype.ds=function(){this.yh&&this.yh.kn&&this.yh.kn.removeEventListener("scroll",this.sh),Ns.debug("unbind: should unbind event")},Jn.prototype.Gh=function(t){if(this.Hl&&t){var e={t:"TELNET_DATA",B64:Ye(t)};Is.debug("Sending local echo message"),this.an(e)}0===this.Wl&&this.dr(t)},Jn.prototype.zs=function(t,i){var s=i?t.substring(0,i):t,n=[];for(let t=0;t<s.length;t++){var l=s.charCodeAt(t);if(!(l>=32&&l<127))return e.info("Invaid ASCII input="+s.charAt(t)),!1;n.push(l)}return this.Wl===Ve&&(this.cl=n),n.length>0?(this.Gh(n),!0):(e.info("0 length bufer found for autotype"),!0)},Jn.prototype.wr=function(t){xs.debug("keypress, charCode="+t);var e=Fe[t];e?this.Gh(e):(xs.debug("Unhandled key press 0x"+qe(t)),this.ts())},Jn.prototype.Ar=function(){let t=this.Ah()-1,e=this.ph();t<0&&(e.elements.splice(0,0,null),e.elements.pop(),t=0),this.bh()?this.ih=t:this.pi=t,this.kh(t)},Jn.prototype.fh=function(t,e){if(this.Ol)xs.warn("Keyboard Locked: Cannot accept input at this time");else{if(this.Jl="Process"===t.value?e.code:t.value,8===t.type&&3&this.xi&&1===t.value.length){var i=t.value.charCodeAt(0);xs.debug("Executing alt keypress for keycode="+i);var s=[27,i];this.Gh(s)}else if(2===t.type||8===t.type){let i=t.value;if(1!=i.length)return;3===e.location&&this.Xl?this.wr(i):this.Qs(i.charCodeAt(0))}else{if(64!==t.type)return;this.pr(t.value,e.location)}e.stopPropagation(),e.preventDefault()}},Jn.prototype.br=function(t){return{kr:Math.floor(t/this.width),Cr:Math.floor(t%this.width)}},Jn.prototype.mr=function(t){Is.debug("---------------TELNET_DATA hex dump----------------"),je(t,Is),Is.debug("---------------TELNET_DATA ascii dump--------------"),Is.debug(String.fromCharCode.apply(null,t)),Is.debug("---------------TELNET_DATA dump end----------------"),this.fl||(this.fl=new Xn(this,"VT_INPUT"));var e=this.fl,i=t.entries();this.xe&&this.Un&&this.xe.id!=this.Un.id&&(this.Gn&&(this.yh.gn().scrollTop=this.yh.gn().scrollHeight),this.Jh(1),this.xe=this.Un),this.vr={Sr:0,gr:void 0};for(let t of i){let i=t[1];e.process(i)}e.wn();let s=Date.now(),n=0;this.Er&&s-this.Er<5&&(n=5,this.Er&&this.Er-s<3&&(n=3),clearTimeout(this.yr)),this.Er=s,this.yr=setTimeout(()=>{this.Dr()},n)},Jn.prototype.an=function(t){Is.debug("Processing websocket message. Type="+t.t);let i=this;switch(t.t){case"CONNECTED":this.sn(t);break;case"IP_RES":i.clientIP=t.data;break;case"TELNET_DATA":var s=$e(t.B64);this.mr(s);break;case"CERT_PROMPT":this.callbacks&&this.callbacks.Rr?this.callbacks.Rr(this.os.host,t.fp,(t,i)=>{this.Fi.send(JSON.stringify({t:"CERT_RES",a:t})),t||e.info("Rejecting TLS certificate and closing connection. Reason="+i)}):this.Fi.send(JSON.stringify({t:"CERT_RES",a:!0}));break;case"SSH_USER_AUTH_INFO_REQ":this.Wl=3,this.Ql=this.Hl,this.Hl=!0,this.Tr=t.prompts,this.Mr=0;var n=[];for(let e=0;e<t.name.length;e++)n.push(t.name.charCodeAt(e));n.push(13);for(let e=0;e<t.inst.length;e++)n.push(t.inst.charCodeAt(e));if(n.push(13),t.prompts.length>0){var l=t.prompts[0];l.e&&Jn.dh(n);var h=l.s;for(let t=0;t<h.length;t++)n.push(h.charCodeAt(t));l.e&&Jn.Ch(n),this.Mr=1,this.Pr=[]}var r=Ye(n);this.an({t:"TELNET_DATA",B64:r});break;case"SSH_USER_AUTH_REQ":this.rl||this.tr(),this.pi=0,this.Ql=this.Hl,this.Hl=!0,void 0===this.username||null===this.username?(this.Wl=Oe,this.zs("login as: "),this.Gl=this.pi):(this.zs("Password rejected by host"),this.cl=[],this.Fr());break;case"CERT_REJECT":this.Fi.close(4001,"server sent close/error/exception message");break;case"SSH_CH_REQ":let u=t.reqt.data,o="";u instanceof Array&&(o=String.fromCharCode.apply(null,u)),"exit-signal"===o?this.Fi.close(4001,"server sent close/error/exception message"):Is.warn("Unhandled websocket message. Type="+o);break;case"ERR":this.nn(t);default:Is.warn("Unhandled websocket message. Type="+t.t)}},Jn.prototype.jh=function(t,e){for(var i=[255,250,t],s=0;s<e.length;s++)i.push(e[s]);i.push(255),i.push(240);var n={t:"VT_INPUT",data:Ye(i)};Is.debug("Sending telnet sub, dump follows"),je(i,Is),null!=this.Fi&&this.Fi.send(JSON.stringify(n))},Jn.prototype.xr=function(){this.Zn=null,this.Jn=null},Jn.prototype.Dr=function(){let t=!1;null==this.re&&(t=!0,e.debug("showScreen"),this.re=new Ts(this,null,this.Il?2:1),null!==this.Ui&&void 0!==this.Ui&&this.Rs(this.Ui));for(var i=9;i<18;i++)this.Di.Ei[i]=32;this.re.oi(),t&&this.yh&&(this.yh.gn().style.opacity="255")},Jn.prototype.Ir=function(t,e){if(this.bh())this.kh(this.ih+e);else{var i=this.Yn()+t,s=this.pi+e;this.el(i,s)}},Jn.prototype.Nr=function(t){var e=this.br(t);this.el(e.kr,e.Cr)},Jn.prototype.kh=function(t){var e=Math.max(this.Gl,Math.min(t,this.width));t!=e&&Ns.warn("Column for setcursor abnormal. column="+t+". Set to "+e),this.bh()?this.ih=e:(this.pi=e,1===this.th&&this.Lr()),this.re&&this.re.Ct&&this.re.$t()},Jn.prototype.el=function(t,e){if(this.bh())this.kh(e);else{this.Yh&&this.Zn&&(t=this.Zn+t);var i=null!=this.Jn&&this.Yh?this.Jn:this.height-1,s=Math.max(0,Math.min(t,i)),n=Math.max(this.Gl,Math.min(e,this.width-1));t==s&&e==n||Ns.warn("Column and row given for setcursor abnormal. column="+e+", row="+t+". Set to column="+n+", row="+s),this.rl=this._h(s),this.rl.Ur=!1,this.lineNumber=s,this.pi=n,this.re&&this.re.Ct&&this.re.$t(),1===this.th&&this.Lr()}},Jn.prototype.Fr=function(){if(this.username){for(var t=this.username+"@"+this.os.host+"'s password: ",e=[13,10],i=0;i<t.length;i++)e.push(t.charCodeAt(i));Jn.dh(e);var s=Ye(e);this.zl=t.length,this.Gl=t.length,this.Wl=Ve,this.an({t:"TELNET_DATA",B64:s})}},Jn.prototype.pr=function(t,e){var i,s;if(("Delete"===t||"Backspace"===t)&&0!=this.Wl)return this.Wl===Ve?void this.cl.pop():(this.Br(),this.re.oi(),!0);if("Enter"===t){if(Ns.debug("Handling enter, input state=0x"+qe(this.Wl)),this.Wl===Oe){var n=[];for(let t=10;t<this.pi;t++){let e=this.rl.elements[t];e&&e.ze&&n.push(e.ze)}return this.cl=[],this.username=String.fromCharCode.apply(null,n),this.Fr(),!0}if(this.Wl===Ve){const t=String.fromCharCode(...this.cl);var l=Ye([13,10,27,91,48,109]);return this.an({t:"TELNET_DATA",B64:l}),this.Hl=this.Ql,this.Wl=0,this.Gl=0,this.Fi.send(JSON.stringify({t:"SSH_USER_AUTH_RES",m:"password",u:this.username,p:t})),!0}if(3===this.Wl){var h=this.Tr[this.Mr-1].length,r=[],u=this.rl;let t;for(let e=h;e<this.width&&(t=u.elements[e],t&&t.ze);e++)r.push(t.ze);if(this.Pr.push(String.fromCharCode.apply(null,r)),this.Mr>=this.Tr.length)this.Wl=0,this.Hl=this.Ql,this.Fi.send(JSON.stringify({t:"SSH_USER_AUTH_INFO_RES",res:this.Pr}));else{var o=this.Tr[this.Mr++],a=[13];o.e&&Jn.dh(a);var c=o.s;for(let t=0;t<c.length;t++)a.push(c.charCodeAt(t));o.e&&Jn.Ch(a)}return!0}if(0===this.Wl)return this.Xl&&3==e?this.Gh([27,79,77]):this._l?this.Gh([13,10]):this.Gh([13]),!0}else{var f;if(i=Pe[t])return!!(f=this.Or?i[2]:this.yl?i[1]:i[0])&&(this.Gh(f),!0);if(null!=(s=lt[t])&&16&s)return this.Os(t),!0;if(this.vh){"Backspace"==t&&this.Vr&&(t="Delete");var d=this.vh[t];if(null!=d)return this.Gh(d),!0}}return xs.warn("Unhandled VT function="+t),!1},Jn.prototype.Hr=function(t){if(this.xe){let e,i=0;-1==t?(e=0,t=1):e=1;for(let s=0;s<t&&this.xe.Qn;s+=e)this.xe=this.xe.Qn,i++;this.Wt+=i,this.zt+=i,this.re&&this.re.oi(i)}},Jn.prototype.Jh=function(t){let e,i=Math.min(Math.abs(t)),s=this.xe;for(let t=0;t<this.height&&s;t++)s.next&&(s=s.next);1==i?(e=0,i=-1):e=1;let n=0;for(let t=0;t<i;t+=e){if(this.xe.id===this.Un.id)return;if(this.xe=this.xe.next,n--,!s||!s.next)break;s=s.next}this.Wt+=n,this.zt+=n,this.re&&this.re.oi(n)},Jn.prototype.Qr=function(){for(var t=this.xe,e=0,i=0;i<this.height&&t.next;i++)t=t.next,e++;if(e<this.height-1)return this.tl=e,!0;for(;t;)this.xe=this.xe.next,t.updated=!0,this.Kn=t,t=t.next;return this.tl=this.height,!0},Jn.prototype._r=function(){return this.Zn?this.Zn+1:1},Jn.prototype.Kr=function(t){const e=this.bh(),i=this.Ah();if(Ns.log(Ns.FINEST,"insertChar: "+t+" - posInLine="+i+"  width="+this.width+"glidx=0x"+qe(this.Ml)+" gridx=0x"+qe(this.Pl)),null==this.ph())this.bh()||this.As(!0),this.tr();else if(i>=this.width){if(!this.Al)return void Ns.debug("No implicit wrap, maybe overwrite if not in INSERT mode");if(this.rl.next)this.rl=this.rl.next,this.kh(0);else if(this.tr(),this._l)this.kh(0);else for(var s=0;s<this.Ah();s++)this.Kr(32)}const n=this.Wr(t);return 2===this.Vl?(e?this.bi.elements[this.ih++]=n:this.rl.elements[this.pi++]=n,1===this.th&&this.Lr()):e?(Jn.ah(n,this.ih,this.bi),this.ih++):(Jn.ah(n,this.pi,this.rl),this.pi++),this.rl.updated=!e||this.rl.updated,n},Jn.prototype.bh=function(){return 1===this.eh&&2===this.th},Jn.prototype.ph=function(){return this.bh()?this.bi:this.rl},Jn.prototype.Ah=function(){return this.bh()?this.ih:this.pi},Jn.prototype.Wr=function(t,e){var i=new Hn(t);return this.Sl?(i.Ge=this.Rl[2],this.Sl=!1):this.gl?(i.Ge=this.Rl[3],this.gl=!1):(i.Ge=this.Rl[this.Ml],i.qe=this.Rl[this.Pl]),i.Xe=this.zr(e),this.Gr(i,this.rl),i.Ye=this.Ye,i.Je=this.Je,i.ni=this.ni,i.si=this.si,i.pl=this.pl,i},Jn.prototype.Gr=function(t,e){let i=e||this.ph();0!=(8&t.Xe)&&(i.Ie=!0)},Jn.prototype.ci=function(t){let e=t||this.rl;if(e&&e.elements&&e.elements[0]&&e.elements[0].Xe){const t=e.elements[0].Xe;return 0!=(128&t)||0!=(256&t)}return!1},Jn.prototype.qr=function(){return this.ci()?this.width/2:this.width},Jn.prototype.zr=function(t){if((t||1===this.eh)&&1===this.th)return 0;let e=0,i=this.Ah(),s=this.ph();return s.elements[i]&&s.elements[i].Xe&&(e=s.elements[i].Xe,e&=896),e|=this.Xe,e},Jn.prototype.jr=function(t){return[0,1,2].indexOf(t)>-1},Jn.prototype.Ih=function(t,e,i){return i&&1===i||2===i?Math.round((t-Gs)*e/(e+1)):t},Jn.prototype.Zr=function(t){this.canvas.height=t,this.Xt.height=t,this.hn.style.height=t},Jn.prototype.Nh=function(t,e){if(e&&1===e||2===e){let e=this.vn.clientHeight-t;this.Ot=ln.gs(this.vn,this.vn.clientWidth,e,t)}else this.Ot=null},Jn.prototype.er=function(){return{elements:new Array(this.width),id:zs}},Jn.prototype.Lr=function(){if(1!==this.th||!this.bi||!this.bi.elements)return;let t=[32,...this.fl.Jr(this.Nn),32,40,...this.fl.Jr(this.Yn()+1),44,32,...this.fl.Jr(this.pi+1),41];for(let e=0;e<13;e++){let i=t[e]?t[e]:32;this.bi.elements[e]?this.bi.elements[e].ze=i:this.bi.elements[e]=this.Wr(i,!0)}},Jn.prototype.Xr=function(t){this.Nh(t,this.th),this.bi=this.er(),this.ih=0,1===this.th&&this.Lr()},Jn.prototype.Yr=function(){this.Eh(this.vn),this.Ot=null,this.bi=null,this.ih=0,this.eh=0,this.Qt=!0,this.re.Ue()},Jn.prototype.$r=function(t){let e=this.Ih(this.vn.clientHeight||this.Ui.height,this.height,this.th);this.Zr(e),0===t?this.Xr(e):0===this.th&&this.Yr(),this.resize(this.width,this.height,!0)},Jn.prototype.tu=function(){this.bi=this.er(),this.ih=0,1===this.th&&(this.Lr(),1===this.eh&&(this.eh=0,this.Qt=!0,this.re.Ue()))},Jn.prototype.eu=function(t){if(!this.jr(t)||this.th===t)return;const e=this.th;this.th=t,0===e||0===t?this.$r(e):this.tu()},Jn.prototype.Ph=function(t){let e=new Kn(this.width);e.Ur=!0,this.Kn=this.Kn||this.Qh,e.Qn=this.Kn,this.Kn.next=e,this.Kn=e,t&&(this.ol++,this.tl++)},Jn.prototype.iu=function(){let t=this.height-this.Yn();for(;t>=0;)this.tr(),t--},Jn.prototype.rr=function(){if(this.yh){this.tr();const t=this.Kn;this.Un=t,this.xe=this.Un,this.tl=1,this._h(this.height-1),this.el(0,0),this.Lh()}else this.As(!0)},Jn.prototype.Lh=function(){const t=this.yh;if(!t||!t.kn)return;const e=this.vn.clientHeight/this.height;t.Mn(e,Math.min(Math.max(this.height,this.al,this.ol),this.mi)),this.xh=Math.floor(t.mn),t.kn.scrollTop=this.xh,t.Sn(this.xh)},Jn.prototype.su=function(t,e,i,s,n){const l=n>=0?n:0;if(0===l)return;const h=Array(l).fill(null);let r=i;for(let i=0;i<s;i++)if(r&&r.elements){const i=r.elements.length;t===Jn.rh?(r.elements.splice(e,0,...h),r.elements.splice(i)):t===Jn.uh&&(r.elements.splice(i,0,...h),r.elements.splice(e,l)),r.updated=!0,r=r.next}},Jn.prototype.Fh=function(t){this._h(t);for(var e=0,i=this.Un;e!=t;)i=i.next,e++;return i},Jn.prototype.nu=function(){let t=this.Un,e=0;for(;t&&!t.Ur&&e<this.tl;)t=t.next,e++;return e},Jn.prototype.cn=function(){return this.ln(this.Yn(),this.pi)},Jn.prototype.Yn=function(){if(!0===dn)return this.lineNumber;{if(null==this.rl||null==this.Un)return 0;let i=this.rl.id;for(var t=this.Un,e=0;t&&t.id!=i;)t=t.next,e++;return this.lineNumber=e,e}},Jn.prototype._h=function(t){let e=this.Un;var i=e;t>=this.height&&(Ns.warn("ensureLine requested to check row "+t+" greater than height:"+this.height),t=this.height-1);for(var s=0;s<t&&null!=i;)e=i,i=i.next,s++;if(Ns.log(Ns.FINER,"After ensureline loop, line="+i+", y="+s+", terminalLineNumber="+t),null==i||!i)for(var n=s;n<t+1;n++)i=this.tr(!0);return i},Jn.prototype.lu=function(t,e,i){Ns.debug("eraseInLine startColumn="+e+" endColumn="+i);for(var s=e;s<=i;s++)t.elements[s]&&this.hu(t.elements[s]);t.updated=!0},Jn.prototype.hu=function(t){t&&(t.ze=null,t.Xe=896&t.Xe,t.Je=this.Je,t.si=this.si)},Jn.prototype.ru=function(t,e,i,s){if(null!=this.rl&&null!=this.Un){var n=this.pi;-1==e&&(e=n),-1==s&&(s=n),t=Math.max(0,Math.min(t,this.height-1)),e=Math.max(0,Math.min(e,this.width-1)),i=Math.max(0,Math.min(i,this.height-1)),s=Math.max(0,Math.min(s,this.width-1));for(var l=this.Un,h=0;h<t;){if(null==(l=l.next))return;h++}do{this.lu(l,h==t?e:0,h==i?s:this.width-1),l=l.next,h++}while(h<=i&&l)}},Jn.prototype.uu=function(t){return["","0","1","2"].indexOf(t)>-1},Jn.prototype.ou=function(t,e,i){if(!this.uu(t))return;let s=""===t||"0"===t?this.ih:0,n="1"===t?this.ih:this.width-1;s=Math.max(0,s),n=Math.min(n,this.width-1);let l=this.bi;Ns.debug("eraseInLine startColumn="+s+" endColumn="+n);for(var h=s;h<=n;h++)e&&l.elements[h]&&l.elements[h].pl||(i?l.elements[h]=null:this.hu(l.elements[h]));l.updated=!0},Jn.prototype.au=function(){var t=this.Yn();Ns.debug("cursor row="+t+" cursor="+this.pi)},Jn.prototype.cu=function(t,e){return 0},Jn.prototype.fu=function(t,e){return 0},Jn.prototype.du=function(){this.Ir(0,-1)},Jn.prototype.Br=function(){var t=this.rl;if(this.pi>0){var e=this.pi-1;this.wu(1,t,e),this.kh(e)}},Jn.prototype.Au=function(){let t=this.canvas.height%this.height;return(this.canvas.height-t)/this.height};var startVT=function(t,i,s,callbacks,n){let l,h,r=t.parentDiv,u=t.height,o=t.width,a=!1,c=null,f=r;if(s&&s.screenBufferLines){let e=Number(s.screenBufferLines),n=Number(i.screenHeight);if(h="MAX"==i.screenWidth||"MAX"==i.screenHeight,h?n=Jn.gh(s,f,o,u).height:(i.screenHeight=Number(i.screenHeight),i.screenWidth=Number(i.screenWidth)),e>n){l=e+n,a=!0,c=new Qn(r,o,u);let i=u%n;c.Mn((u-i)/n,l),o=t.width=o-15,f=Jn.hh(r,o,u),r.appendChild(c.gn()),c.Sn(-1),r.appendChild(f)}}var d=!1;if(h="MAX"==i.screenWidth||"MAX"==i.screenHeight,h){d=!0;let t=Jn.gh(s,f,o,u);i.screenHeight=t.height,i.screenWidth=t.width}else i.screenHeight=Number(i.screenHeight),i.screenWidth=Number(i.screenWidth);let w=i.screenWidth?i.screenWidth:80,A=i.screenHeight?i.screenHeight:24;a||(l=A);var p=0,b=1,k=new Jn(w,A,l,f);if(k.callbacks=callbacks,n&&(k=Object.assign(k,n)),k.ys(f,t),k.parentDiv=r,k.fn(),k.Gn=a,i&&(i.termTypeString&&"string"==typeof i.termTypeString&&(k.termTypeString=i.termTypeString),void 0!==i.termType&&"number"==typeof i.termType&&(k.termType=i.termType),void 0!==i.oiaEnabled&&"boolean"==typeof i.oiaEnabled&&(k.oiaEnabled=i.oiaEnabled?1:0),i.security&&"object"==typeof i.security&&(i.security.type&&"number"==typeof i.security.type&&(p=i.security.type),i.security.badCert&&"number"==typeof i.security.badCert&&(b=i.security.badCert)),i.answerback&&"string"==typeof i.answerback)){for(var C=[],m=0;m<i.answerback.length;m++)C.push(i.answerback.charCodeAt(m));k.answerback=C}return k.termTypeString||Jn.Sh(k),Jn.mh(k),void 0!==s.Ul&&(k.Ul=s.Ul),k.Fl=h,c&&(k.yh=c,k.Th()),null!=s&&(k.Ui=s,null!==s.pu&&void 0!==s.pu&&(k.Bi=s.pu),void 0!==s.Js&&(k.Js=s.Js)),k.Il=d,k.As(!0),e.debug("connect = "+i.connect),k.os={host:i.host,port:Number(i.port),security:p,Bh:b},i.connect?k.connect(i.url,k.os):k._i=!0,k.Ds(),k.canvas.focus(),k.callbacks&&"function"==typeof k.callbacks.onInit&&k.callbacks.onInit(),k};function Xn(t,e){this.$i=e,this.screen=t,this.state=1,this.data=[],this.bu=0,this.ku=new Array(1e3),this.Cu=0,this.mu=[],this.vu,this.Su=[],this.Xi=null,this.Ji=[],this.gu=!0,this.Eu=!0,this.yu=!0,this.Yi=[],this.Du=!1,this.Ru=[],this.Tu=[],this.Mu=0}ci(Xn,hn),Xn.Pu=function(t){let e=t.length,i=0;switch(e){case 2:i=31&t[0];break;case 3:i=15&t[0];break;case 4:i=7&t[0];break;case 5:i=3&t[0];break;case 6:i=1&t[0];break;default:throw new rn("Invalid length ("+e+") of UTF8 buffer")}for(var s=1;s<t.length;s++)i<<=6,i|=63&t[s];return i},Jn.prototype.wu=function(t,e,i){if(e&&e.elements){var s=0;for(let n=i+t;n<screen.width;n++)e.elements[i+s]=e.elements[n],s++;for(let t=i+s+1;t<screen.width;t++)e.elements[t]=void 0;e.updated=!0}},Jn.prototype.Fu=function(t=!0,e,i){const s=e||this.rl;for(let e=0;e<=this.pi;e++)t&&s.elements[e]&&s.elements[e].pl||s.elements[e]&&(i?s.elements[e]=null:this.hu(s.elements[e]))},Jn.prototype.xu=function(t=!0,e,i,s,n){const l=i||this.rl,h=e?0:this.pi,r=s||this.width;for(let e=h;e<r;e++)t&&l.elements[e]&&l.elements[e].pl||(n?l.elements[e]=null:this.hu(l.elements[e]));l.updated=!0},Jn.prototype.Iu=function(t=!0){let e=this.Un;for(let i=0;i<=this.lineNumber&&e;i++)e.id===this.rl.id?this.Fu(t,this.rl,!0):this.xu(t,!0,e,this.width,!0),e.updated=!0,e=e.next},Jn.prototype.Nu=function(t=!0,e){let i=e?this.Un:this.rl;for(let s=e?0:this.Yn();s<this.height&&i;s++)e||i.id!==this.rl.id?this.xu(t,!0,i,this.width,!0):this.xu(t,!1,this.rl,this.width,!0),i.updated=!0,i=i.next},Jn.prototype.Lu=function(){this.Uu={rl:this.rl,lineNumber:this.lineNumber,pi:this.pi,Xe:this.Xe,Ye:this.Ye,Je:this.Je,Rl:[].concat(this.Rl),Yh:this.Yh,Al:this.Al,pl:this.pl}},Jn.prototype.Bu=function(){this.Uu?(this.rl=this.Uu.rl,this.lineNumber=this.Uu.lineNumber,this.pi=this.Uu.pi,this.Xe=this.Uu.Xe,this.Ye=this.Uu.Ye,this.Je=this.Uu.Je,this.Rl=this.Uu.Rl,this.Yh=this.Uu.Yh,this.Al=this.Uu.Al,this.pl=this.Uu.pl):(Ns.warn("Dont have saved attributes to restore from for escape 0x38"),this.el(0,0),this.Xe=0,this.Ye=Jn.$e,this.Je=0,this.Rl=Jn.Tl(),this.Yh=!1,this.Al=!1,this.pl=!1)},Jn.prototype.dr=function(t){var e=Jn.oh(t);e&&(Is.debug("Sending VT message, dump follows"),je(t,Is),null!=this.Fi&&this.Fi.send(JSON.stringify(e)))},Jn.prototype.Ou=function(){if(this.bh())if(this._l)this.kh(0);else for(var t=0;t<this.Vu;t++)this.Kr(32);else{var e=null!=this.Jn?this.Jn:this.height-1,i=this.Yn();if(this.Xh(i)){if(!this.Hu(i)){if(this.tr(),this._l)this.kh(0);else for(let t=0;t<this.pi;t++)this.Kr(32);this.yh&&this.yh.Sn(-1)}}else if(i==e&&null!=this.Jn){if(this.tr(),!this._l)for(let t=0;t<this.pi;t++)this.Kr(32);this._l&&this.kh(0)}else this.Ir(1,0),this._l&&this.kh(0)}},Jn.prototype.Hu=function(t){return!(!this.Jn||this.Jn===this.height-1)&&(t||this.Yn())>=this.height-1},Xn.prototype.Qu=function(){var t=this.screen,e=this._u();if(0==e.length)t.el(0,0);else if(1==e.length)t.el(e[0]-1,0);else{if(2!=e.length)throw new tl("wrong number of params to CSIxf/H -'"+this.Ku()+"'");t.el(e[0]-1,e[1]-1)}},Xn.prototype.Wu=function(t,e){if(t.bh())return void(e&&t.kh(0));const i=t.Yn(),s=t.pi,n=null!=t.Jn?t.Jn:t.height-1;i>=n&&!t.Hu(i)&&t.tr();const l=i===n?n:i+1,h=e?s:0;t.el(l,h)},Xn.prototype.zu=function(t){Ns.debug("-- type=(RI) Reverse Index");const e=null!=t.Zn?t.Zn:0,i=null!=t.Jn?t.Jn:t.height-1,s=t.Yn(),n=t.pi;s==e&&t.zh(1,t.Fh(e),e,i,!0);const l=s<=e?e:s-1;t.el(l,n)},Xn.prototype.Gu=function(){const t=this.Su;switch(this.vu){case 113:36===t[0]&&(Ns.debug("-- type=(DECRQSS) Request Selection or Setting"),this.qu(t));break;default:this.ju("unhandle des sequences: "+this.vu)}},Xn.prototype.qu=function(t){const e=this.screen;if(0===t.length)return;const i=this.Zu("DCS"),s=this.Zu("ST");let n=[],l=!0,h=[...i,49,36,114,...s];switch(t[1]){case 34:113===t[2]?(Ns.debug("-- type=(DECRQSS) -> DECSCA: Set Character Attribute"),n=[e.bl.toString().charCodeAt(0),34,113]):112===t[2]&&(h=Ge);break;case 36:124===t[2]?(Ns.debug("-- type=(DECRQSS) -> DECSCPP: Set Columns Per Page"),n=[...this.Jr(e.kl),36,124]):126===t[2]?(Ns.debug("-- type=(DECRQSS) -> DECSSDT: Select Status Display (Line) Type"),n=[...this.Jr(this.vl),36,126]):125===t[2]&&(n=[...this.Jr(e.Mu),36,125]);break;case 39:115===t[2]&&(h=[...i,...s],this.ju("need to do DECTLTC - Transmission line termination characte"));break;case 42:124===t[2]&&(Ns.debug("-- type=(DECRQSS) -> DECSNLS: Select number of lines per screen"),n=[...this.Jr(e.ml),42,124]);break;case 109:Ns.debug("-- type=(DECRQSS) -> SGR: Select Graphic Rendition");const r=il(e.Xe);let u=[];r.forEach(t=>{u.push(...this.Jr(t)),u.push(59)}),u.pop(),n=[...u,109];break;case 114:Ns.debug("-- type=(DECRQSS) -> DECSTBM: Set Top and Bottom Margins"),n=[...this.Jr(null==e.Zn?1:e.Zn+1),59,...this.Jr(null==e.Jn?e.height:e.Jn+1),114];break;case 116:Ns.debug("-- type=(DECRQSS) -> DECSLPP: Set Lines Per Page"),n=[...this.Jr(e.Cl),116];break;case 124:h=[...i,...s],this.ju("need to do DECTTC - Set transmit termination character");break;default:l=!1,this.ju("need to do DECRQSS Request Selection or Setting")}if(!l)return;const r=this.screen.Dl?4:5;h.splice(r,0,...n),e.dr(h)},Xn.prototype.Ju=function(){const t=this.screen;let e=[];switch(t.termTypeString){case"vt102":e=[...ve];break;case"vt220":e=[...Se,...ye];break;case"vt320":e=[...ge,...De];break;case"linux":case"xterm":case"vt420":e=[...Ee,...Re];break;default:e=[...ve],Ns.warn("Unknown term type specified:"+t.termTypeString+", sending VT102 string instead.")}return e},Xn.prototype.Zu=function(t){return this.screen.Dl?[...le[t]]:[...ne[t]]},Xn.prototype.Xu=function(t){const e=this.screen;let i;switch(t){case 1:i=52;break;case 2:i=e.Ol?49:50;break;case 3:i=48;break;case 4:i=1===e.Vl?49:50;break;case 5:case 7:case 10:case 11:i=52;break;case 12:i=e.Hl?50:49;break;case 13:case 14:case 15:case 16:case 17:case 18:case 19:i=52;break;case 20:i=e._l?49:50;break;default:i=50,Ns.warn("Unknown ANSI mode specified:"+t+", sending the setting of the mode with '2: reset'.")}let s=this.Jr(t);return[...this.Zu("CSI"),...s,59,i,36,121]},Xn.prototype.Yu=function(t){const e=this.screen;let i;const s={18:"DECPFF",19:"DECPEX",34:"DECRLM",35:"DECHEBM",36:"DECHEM",42:"DECNRCM",57:"DECNAKB",61:"DECVCCM",64:"DECPCCM",68:"DECKBUM",73:"DECXRLM",81:"DECKPM",95:"DECNCSM",96:"DECRLCM",97:"DECCRTSM",98:"DECARSM",99:"DECMCM",100:"DECAAM",101:"DECNULM",102:"DECNULM",103:"DECHDPXM",104:"DECESKM",106:"DECOSCNM"};switch(s[t]&&this.ju(`DEC mode ${t} -- ${s[t]} unimplemented, sending the setting of the mode with '2: reset'.`),t){case 1:i=1===e.yl?49:50;break;case 2:i=e.Or?50:49;break;case 3:i=132===e.width?49:50;break;case 4:i=e.Yl?49:50;break;case 5:i=e.$l?49:50;break;case 6:i=e.Yh?49:50;break;case 7:i=e.Al?49:50;break;case 8:i=e.Nl?49:50;break;case 18:case 19:i=50;break;case 25:i=e.Qt?49:50;break;case 34:case 35:case 36:case 42:case 57:i=50;break;case 60:i=52;break;case 61:case 64:i=50;break;case 66:i=e.Xl?49:50;break;case 67:i=e.Vr?50:49;break;case 68:i=50;break;case 69:i=e.$u?49:50;break;case 73:case 81:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 106:i=50;break;default:i=50,Ns.warn("Unknown DEC mode specified:"+t+", sending the setting of the mode with '2: reset'.")}const n=this.Jr(t);return[...this.Zu("CSI"),63,...n,59,i,36,121]},Xn.prototype.to=function(){const t=this.screen;let e,i=this.Zu("CSI");switch(t.termTypeString){case"vt102":e=ve;break;case"vt220":e=Se;break;case"vt320":e=ge;break;case"linux":case"xterm":case"vt420":e=Ee;break;default:e=ve,Ns.warn("Unknown term type specified:"+t.termTypeString+", sending VT102 string instead.")}i.push(...e),Ns.debug(`Sending response for device primary attributes for ${t.termTypeString}: ${i}`),t.dr(i)},Xn.prototype.eo=function(){let t,e=this.screen,i=this.Zu("CSI");switch(e.termTypeString){case"vt220":t=ye;break;case"vt320":t=De;break;case"linux":case"xterm":case"vt420":t=Re;break;default:t=ye,Ns.debug("Unknown term type="+e.termTypeString+", sending VT220 string")}t&&(i.push(...t),Ns.debug(`Sending response for device secondary attributes for ${e.termTypeString}: ${i}`),e.dr(i))},Xn.prototype.io=function(t,e){this.Ji.push(255),this.Ji.push(t),this.Ji.push(e)},Xn.prototype.so=function(){var t=this.screen,e=this.Yi[0];switch(Ls.debug("Handling telnet sub type b=0x"+qe(e)),e){case 31:Ls.debug("-- Telnet Sub=WINDOW_SIZE"),t.qh();break;case 24:Ls.debug("-- Telnet Sub=TERMINAL_TYPE");let i=[0];for(let e=0;e<t.termTypeString.length;e++)i.push(t.termTypeString.charCodeAt(e));t.jh(24,i);break;default:Ls.warn("Request for telnet sub of type 0x"+qe(e)+", but is unhandled")}},Xn.prototype.no=function(t){switch(Ls.debug("Handling telnet option"),Ls.debug("-- b=0x"+qe(t)),this.Xi){case 253:switch(Ls.debug("-- Verb=DO"),t){case 0:this.io(252,0);break;case 1:e.info("Server requested telnet echo"),this.screen.Hl=!0,this.io(251,1);break;case 5:this.io(254,5);break;case 31:this.io(251,31),this.lo=!0,this.screen.qh();break;case 32:this.io(252,32);break;case 24:this.io(251,24);break;case 3:this.io(251,3),this.Eu=!0;break;default:Ls.warn("Defaulted on DO, sending WONT for b=0x"+qe(t)),this.io(252,t)}break;case 254:switch(Ls.debug("-- Verb=DONT"),t){case 1:this.io(252,1),this.screen.Hl=!1,this.gu=!0;break;case 31:break;default:this.io(252,t),Ls.warn("Ignoring DONT for b=0x"+qe(t))}break;case 252:switch(Ls.debug("-- Verb=WONT"),t){case 1:Ls.warn("HOST WONT ECHO BUT WE DO NOT SUPPORT ECHO YET"),this.screen.Hl=!0,this.io(251,1);break;default:Ls.warn("Ignoring WONT for b=0x"+qe(t))}break;case 251:switch(Ls.debug("-- Verb=WILL"),t){case 0:this.io(254,0);break;case 1:this.yu&&this.io(253,1);break;case 5:this.io(254,5);break;case 38:this.io(254,38);break;default:Ls.warn("Ignoring WILL for b=0x"+qe(t))}}!1===this.Du&&(this.io(251,31),this.Du=!0)},Xn.prototype.clear=function(){this.mu=[],this.Su=[],this.ho=0,this.ro=0,this.Ru=[],this.Tu=[]},Xn.prototype.uo=function(t){if(this.screen){const e=this.screen.vr;e.gr=this.screen.Kr(t),e.Sr=0,Ns.log(Ns.FINER,"Insert to Screen: b=0x"+qe(t)+", char="+String.fromCharCode(t)+", newRow="+this.screen.Yn()+", newCol="+this.screen.pi)}};const Yn=function(t,e,i,s){let n=!1;if(0===t)return e;for(let l=e;l<i;l++)if(1===s[l]&&0==--t)return n=!0,l;return n?void 0:i-1};function $n(){return[48,48,48,48]}function tl(t){this.message=t,this.name="VTParseException",Bs.warn("Encountered exception:"+this.name+", msg:"+t)}function el(t){let e=0;return 16&t&&(e+=8),2&t&&(e+=1),4&t&&(e+=2),8&t&&(e+=4),e}function il(t){let e=[];return 0===t&&e.push(0),16&t&&e.push(1),4&t&&e.push(4),8&t&&e.push(5),2&t&&e.push(7),e}Xn.prototype.oo=function(t){var e=this.screen;Ns.debug("Execute b=0x"+qe(t));var i=!1;if(null!=e)switch(t){case 0:break;case 5:e.answerback&&Array.isArray(e.answerback)&&e.Gh(e.answerback);break;case 7:e.nh&&e.ts();break;case 8:e.du();break;case 9:const s=Yn(1,e.Ah()+1,e.qr(),e.ql);e.kh(s);break;case 10:case 11:case 12:e.Ou();break;case 13:e.kh(0);break;case 14:e.Ml=1;break;case 15:e.Ml=0;break;case 24:case 26:i=!0;break;case 127:0!=e.Kl&&e.Br();break;case 132:Ns.debug("-- type=(8bit --IND) Next line"),this.Wu(e,!0);break;case 133:Ns.debug("-- type=(8bit --NEL) Next line"),this.Wu(e);break;case 136:Ns.debug("-- type=(8bit --HTS) Horizontal tab set"),e.ql[e.Ah()]=1;break;case 141:if(e.bh())break;this.zu(e);break;case 142:Ns.debug("-- type=(8bit --SS2) Single shift 2"),e.Sl=!0;break;case 143:Ns.debug("-- type=(8bit --SS3) Next line"),e.gl=!0;break;default:Ns.warn("Unhandled execute b=0x"+qe(t))}return i},Xn.prototype.collect=function(t){if(t<48)this.Su.push(t);else{if(t<58)throw Bs.warn("Collect given low value byte, b=0x"+qe(t)),new tl("collect should not get digits");t<64&&(this.ho=t)}},Xn.prototype.ao=function(t){this.mu.push(t)},Xn.prototype.Ku=function(){try{var t=this.mu;return 0===t.length?"":(Bs.debug("Param string as hex="),je(t,Bs),String.fromCharCode.apply(null,t))}catch(t){return"<OOPS>"}},Xn.prototype.co=function(){try{var t=this.Su;return Bs.debug("Intermediate string as hex="),je(t,Bs),String.fromCharCode.apply(null,t)}catch(t){return"<OOPS>"}},Xn.prototype.ju=function(t){Ns.warn("Unimplemented: "+t)},Xn.prototype.fo=function(t,e){let i=`Unhandled intermediates: ${this.Su} and parameters: ${e} for CSI dispatch character: 0x${qe(t)}`;i+=this.ho?" with private char "+this.ho:"",Ns.warn(i)},Xn.prototype.do=function(t,e){if(!t||t.length<4)return;if(t[0]>t[2]||t[1]>t[3])return void Ns.warn("top-line/left-column border must be less than or equal to bottom-line/right-column border!");const i=this.screen,s=i.Yn(),n=i.pi;let l=0===t[0]?0:Math.min(Math.max(t[0]-1,0),i.height-1),h=0===t[1]?0:Math.min(Math.max(t[1]-1,0),i.width-1),r=0===t[2]?i.height-1:Math.min(Math.max(t[2]-1,0),i.height-1),u=0===t[3]?i.width-1:Math.min(Math.max(t[3]-1,0),i.width-1),o=i.Fh(l);const a={wo:!1,Ao:!1},c={po:l,bo:h,ko:r,Co:u};for(let i=l;i<=r&&o;i++)a.wo=i===l,a.Ao=i===r,e?this.mo(o,t,a,c):this.vo(o,t,a,c),o=o.next;i.el(s,n)},Xn.prototype.vo=function(t,e,i,s){let n=s.bo,l=s.Co;if(2!==this.bu&&(n=i.wo?n:0,l=i.Ao?l:this.screen.width-1),t){for(let i=n;i<=l;i++)if(t&&t.elements[i])for(let s=4;s<e.length;s++)switch(e[s]){case 0:t.elements[i].Xe=0;break;case 1:t.elements[i].Xe|=16;break;case 4:t.elements[i].Xe|=4;break;case 5:t.elements[i].Xe|=8,this.screen.Gr(t.elements[i],t);break;case 7:t.elements[i].Xe|=2;break;case 22:t.elements[i].Xe&=-17;break;case 24:t.elements[i].Xe&=-5;break;case 25:t.elements[i].Xe&=-9,this.screen.Gr(t.elements[i],t);break;case 27:t.elements[i].Xe&=-3}t.updated=!0}},Xn.prototype.mo=function(t,e,i,s){let n=s.bo,l=s.Co;if(2!==this.bu&&(n=i.wo?n:0,l=i.Ao?l:this.screen.width-1),t){for(let i=n;i<=l;i++)if(t.elements[i])for(let s=4;s<e.length;s++)switch(e[s]){case 0:t.elements[i].Xe&=~t.elements[i].Xe;break;case 1:16&t.elements[i].Xe?t.elements[i].Xe&=-17:t.elements[i].Xe|=16;break;case 4:4&t.elements[i].Xe?t.elements[i].Xe&=-5:t.elements[i].Xe|=4;break;case 5:8&t.elements[i].Xe?t.elements[i].Xe&=-9:t.elements[i].Xe|=8,this.screen.Gr(t.elements[i],t);break;case 7:2&t.elements[i].Xe?t.elements[i].Xe&=-3:t.elements[i].Xe|=2}t.updated=!0}},Xn.prototype._u=function(){var t,e=this.mu,i=[],s=0,n=!1;for(t=0;t<e.length;t++){var l=e[t];if(59==l)i.push(s),n=!1,s=0;else{if(!(l>=48&&l<=57))throw new tl("unexpected numerical parms "+this.Ku());s=10*s+(l-48),n=!0}}n&&i.push(s);var h=new Array(i.length);for(t=0;t<h.length;t++)h[t]=i[t];return Bs.debug("Numerical params=",h),h},Xn.prototype.So=function(t){this.ju("unhandled CSI dispatch character:0x"+qe(t))},Xn.prototype.Eo=function(){return!this.Su||0===this.Su.length},Xn.prototype.yo=function(t){return typeof this.Su==typeof t&&Array.isArray(t)&&t.join()===this.Su.join()},Xn.prototype.Do=function(t){var e=this.screen,i=this.Ku();Ns.debug("CSI Dispatch Start:"),Ns.debug("-- b=0x"+qe(t)+", parms="+i+", intermediate="+this.co());const s=this._u();switch(t){case 64:if(this.Eo()){Ns.debug("-- type=Insert characters"),Ns.debug("IC start, line elements=",e.rl.elements);for(var n=Gn(i,1),l=e.pi+n,h=e.rl,r=e.pi;r<l;){for(var u=new Hn(32),o=h.elements[r],a=r+1;a<e.width-1;a++){var c=h.elements[a];h.elements[a]=o,o=c}h.elements[r++]=u}h.updated=!0,Ns.debug("IC end, line elements=",e.rl.elements)}else if(!this.yo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.fo(t,s);else{Ns.debug("-- type=(SL) Scroll Left");const t=0===s.length?1:s[0];e.su(Jn.uh,0,e.Un,e.tl,t)}break;case 65:if(this.Eo()){if(Ns.debug("-- type=(CUU) Cursor Up"),e.bh())break;const t=Gn(i,1),s=e.Yn(),n=null!==e.Zn?e.Zn:0,l=s<n?Math.max(0,s-t):Math.max(n,s-t);e.el(l,e.pi)}else if(!this.yo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.fo(t,s);else{Ns.debug("-- type=(SR) Scroll Right");const t=0===s.length?1:s[0];e.su(Jn.rh,0,e.Un,e.tl,t)}break;case 66:{if(Ns.debug("-- type=(CUD) Cursor Down"),e.bh())break;const t=Gn(i,1),s=e.Yn(),n=null!==e.Jn?e.Jn:e.height-1,l=s>n?Math.min(e.height-1,s+t):Math.min(n,s+t);e.el(l,e.pi)}break;case 67:{Ns.debug("-- type=(CUF) Cursor Right");let t=Gn(i,1);e.Ir(0,t)}break;case 68:{Ns.debug("-- type=(CUB) Cursor Left");let t=Gn(i,1);e.Ir(0,-t)}break;case 69:if(Ns.debug("-- type=(CNL) Cursor Next Line"),e.bh()){e.kh(0);break}const T=Gn(i,1),M=e.Yn(),P=Zn(M,T,e.height);e.kh(0),e.el(P,e.pi);break;case 70:if(Ns.debug("-- type=(CPL) Cursor Previous Line"),e.bh()){e.kh(0);break}const F=Gn(i,1),x=e.Yn(),I=Zn(x,-F,e.height);e.kh(0),e.el(I,e.pi);break;case 71:{Ns.debug("-- type=(CHA) Cursor Character Absolute");let t=this._u(),i=e.Yn();0==t.length?e.el(i,0):e.el(i,t[0]-1)}break;case 72:Ns.debug("-- type=(CUP) Position Cursor"),this.Qu();break;case 73:Ns.debug("-- type=(CHT) Cursor Forward Tab");const N=this._u(),L=N.length?N[0]:1,U=Yn(L,e.Ah(),e.qr(),e.ql);e.kh(U);break;case 74:const B=s.length?s[0]:0;if(e.uu(i)){if(e.bh()){const t=63==this.ho;e.ou(i,t,!0)}else if(e.rl)if(63==this.ho)if(Ns.debug("-- type=(DECSED) Selective Erase in Display"),0===B){if(e.pi===e.Gl&&0===e.Yn()){e.rr();break}e.Nu()}else 1===B?e.Iu():e.Nu(!0,!0);else if(Ns.debug("-- type=(ED) Erase in display"),0===B){if(Ns.debug("-- subtype=Erase to End of screen"),e.pi===e.Gl&&0===e.Yn()){e.rr();break}e.Nu(!1)}else 1===B?(Ns.debug("-- subtype=Erase from beginning"),e.Iu(!1)):2==B?e.rr():3===B&&(Ns.debug("-- subtype=Erase saved lines"),this.ju("Erase saved lines (xterm)"))}else Ns.warn("Erase in Display had unexpected param string="+i);break;case 75:if(Ns.debug("-- type=(EL) Erase in line"),e.uu(i))if(e.bh()){const t=63==this.ho;e.ou(i,t)}else if(63==this.ho){const t=s.length?s[0]:0;0===t?e.xu():1===t?e.Fu():e.xu(!0,!0)}else{let t=e.Yn();Ns.debug("before eraseRange insertionLine="+t),""==i||"0"==i?(Ns.debug("-- subtype=Erase right"),e.ru(t,-1,t,e.width-1)):"1"==i?(Ns.debug("-- subtype=Erase left"),e.ru(t,0,t,-1)):"2"==i&&(Ns.debug("-- subtype=Erase all"),e.ru(t,0,t,e.width-1))}else Ns.warn("Erase in line had unexpected param string="+i);break;case 76:{if(Ns.debug("-- type=(IL) Insert lines"),e.bh())break;const t=s.length?s[0]:1;e.hr(e.lineNumber)?(e.Qh(t,e.rl),e.kh(0)):Ns.debug("IL has no effect since cursor is outside the page margins.")}break;case 77:{if(Ns.debug("-- type=(DL) Delete lines"),e.bh())break;const t=s.length?s[0]:1;e.hr(e.lineNumber)?(e.Vh(t,e.rl),e.kh(0)):Ns.debug("DL has no effect since cursor is outside the page margins.")}break;case 80:if(!this.Eo()||0!==s.length&&1!==s.length)if(!this.yo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.fo(t,s);else{if(Ns.debug("-- type=(PPA) Page memory function: Page Position Absolute"),e.bh())break;const t=s[0]?s[0]:1;e.Xn(t,!0)}else{Ns.debug("-- type=(DCH) Delete characters");var f=Gn(i,1);0===f&&(f=1);var d=e.Ah(),w=f+d<e.width?f:e.width-1-d,A=e.ph();e.wu(w,A,d)}break;case 81:if(!this.yo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.fo(t,s);else{if(Ns.debug("-- type=(PPA) Page memory function: Page Position Relative"),e.bh())break;const t=s[0]?s[0]:1,i=e.Nn+t;e.Xn(i,!0)}break;case 82:if(!this.yo([parseInt("0x20",16)])||0!==s.length&&1!==s.length)this.fo(t,s);else{if(Ns.debug("-- type=(PPA) Page memory function: Page Position Backward"),e.bh())break;const t=s[0]?s[0]:1,i=e.Nn-t;e.Xn(i,!0)}break;case 83:if(Ns.debug("-- type=(SU) Scroll up"),s.length>0){if(e.bh())break;e.ar(s[0])}else this.ju("0x53, unknown");break;case 84:if(Ns.debug("-- type=(SD) Scroll down"),s.length>0){if(e.bh())break;e.cr(s[0])}else this.ju("0x54, unknown");break;case 85:if(!this.Eo()||0!==s.length&&1!==s.length)this.fo(t,s);else{if(Ns.debug("-- type=(NP) Page memory function: Next Page"),e.bh())break;const t=s[0]?s[0]:1,i=e.Nn+t;e.Xn(i)}break;case 86:if(!this.Eo()||0!==s.length&&1!==s.length)this.fo(t,s);else{if(Ns.debug("-- type=(PP) Page memory function: Preceding Page"),e.bh())break;const t=s[0]?s[0]:1,i=e.Nn-t;e.Xn(i)}break;case 88:{Ns.debug("-- type=(ECH) Erase characters"),Ns.debug("Erase characters: WARNING, concern about if allowed to erase characters with erase lock attribute");const t=Math.max(s.length?s[0]:1,1),i=Math.min(e.pi+t,e.width);e.xu(!1,!1,e.ph(),i)}break;case 89:Ns.debug("-- type=(CVT) Character vertical tab"),this.So(t);break;case 90:{Ns.debug("-- type=(CBT) Character backward tab");const t=this._u(),i=t.length?t[0]:1,s=e.Ah(),n=qn(i,s,e.ql);e.kh(n)}break;case 96:Ns.debug("-- type=(HPA) Horizontal position absolute"),0!=e.Zl?(Ns.warn("Cannot handle HPA in decipoint mode"),this.So(t)):e.kh(Gn(i,1)-1);break;case 97:const O=this._u();if(1!==O.length)Ns.warn("Cannot handle HPR if there is not only one Pn");else{Ns.debug("-- type=(HPR) Horizontal position relative");const t=jn(e.Ah(),O[0],e.width);e.kh(t)}break;case 98:{Ns.debug("-- type=(REP) Repeat previous character in data stream");const t=s.length?s[0]:1,i=e.vr;if(1===i.Sr&&void 0!==i.gr){let s=e.ph();if(s){const n=i.gr;let l=s.elements,h=e.Ah();for(let i=0;i<t;i++)if(h<=e.width-1){if(l[h]=n,h===e.width-1)break;h++}e.bh()?e.ih=h:e.pi=h}else Ns.warn("No insertion line for REP")}else Ns.warn(`No previous element found for REP, current position r=${e.Yn()}, c=${e.pi}`)}break;case 99:Ns.debug("-- type=(DA) Device attributes"),63==this.ho?this.ju("Send Device Attributes Secondary DA"):this.ho&&0!=this.ho?62==this.ho?""==i||"0"==i?this.eo():Ns.warn("Unhandled device attribute command, privateChar = >, paramString="+i):this.ju("0x63 with privateChar="+qe(this.ho)):this.to();break;case 100:const V=this._u();if(0!=e.Zl)this.ju("VPA with decipoint");else if(1!==V.length)Ns.warn("when process: CSI Pn e, there is not only one pn");else{Ns.debug("-- type=(VPA) Line position absolute");const t=Math.max(V[0]-1,0);e.el(t,e.Ah())}break;case 101:const H=this._u(),Q=e.Yn();if(1!==H.length)Ns.warn("Cannot handle VPR if there is not only one Pn");else{Ns.debug("-- type=(VPR) Line position relative");const t=Zn(Q,H[0],e.height);e.el(t,e.Ah())}break;case 102:Ns.debug("-- type=(HVP) Horizontal vertical position"),this.Qu();break;case 103:Ns.debug("-- type=(TBC) Tab clear");const _=s.length?s[0]:0;0===_?e.ql[e.Ah()]=0:3===_?e.ql=new Array(e.ql.length).fill(0):Ns.warn("Unexpected parameter for tab clear -'"+i+"'");break;case 104:{Ns.debug("-- type=(SET) mode set");let t=this._u();if(63==this.ho)for(let i=0;i<t.length;i++){let s=t[i];switch(s){case 1:e.yl=1;break;case 2:e.Or=!1;break;case 3:e.xr(),e.Bn=e.Pn(),e.Nn=1,2===e.th&&(e.bi=e.er(),e.ih=0),e.kh(0),e.zn(24),e.resize(132,24),e.width=132,e.height=24;break;case 4:e.Yl=!0;break;case 5:e.$l=!0,e.re.li();break;case 6:e.Yh=!0,e.el(0,0);break;case 7:e.Al=!0;break;case 8:e.Nl=!0;break;case 12:e.re.Oe();break;case 25:e.Qt=!0,e.re.Ue();break;case 42:this.ju("unhandled DECNRCM: National Replacement Character Set Mode.");break;case 11:Ns.warn("Not implemented: decipoints instead of row/column");case 64:break;case 66:e.Xl=!0;break;case 67:e.Vr=!1;break;case 69:e.$u=!0;break;case 81:this.ju("unhandled DECKPM-Key Position Mode");break;default:this.ju("mode setting case=?"+s)}}else{if(0===t.length){this.ju("Mode setting default case");break}for(let e=0;e<t.length;e++){let i=t[e];switch(i){case 2:Ns.debug("Mode setting: lock keyboard"),this.screen.Ol=!0;break;case 4:Ns.debug("Mode setting: insert mode"),this.screen.Vl=1;break;case 12:Ns.debug("Mode setting: send/receive mode (SRM), local echo off"),this.screen.Hl=!1;break;case 20:Ns.debug("Setting LNM true"),this.screen._l=!0;default:this.ju("Mode setting case="+i)}}}}break;case 105:Ns.debug("-- type=(MC) media copy"),this.ju("various printing options");break;case 108:{Ns.debug("-- type=(RM) mode reset");let t=this._u();if(63==this.ho)for(let i=0;i<t.length;i++){let s=t[i];switch(s){case 1:e.yl=0;break;case 2:e.Or=!0;break;case 3:e.xr(),e.Bn=e.Pn(),e.Nn=1,2===e.th&&(e.bi=e.er(),e.ih=0),e.kh(0),e.zn(24),e.resize(80,24),e.width=80,e.height=24;break;case 4:e.Yl=!1;break;case 5:e.$l=!1,e.re.ri();break;case 6:e.Yh=!1,e.el(0,0);break;case 7:e.Al=!1;break;case 8:e.Nl=!1;break;case 12:e.re.Be();break;case 25:e.Qt=!1,e.re.Ne();break;case 34:break;case 42:this.ju("unhandled DECNRCM: National Replacement Character Set Mode.");break;case 64:break;case 66:e.Xl=!1;break;case 67:e.Vr=!0;break;case 69:e.$u=!1;break;case 1e3:this.ju("Xterm mode resetting: dont send mouse x&y on button press & release");break;case 1001:this.ju("Xterm mode resetting: dont use hilite mouse tracking");break;case 1002:this.ju("Xterm mode resetting: dont use cell motion mouse tracking");break;case 1003:this.ju("Xterm mode resetting: dont use all motion mouse tracking");break;case 1004:this.ju("Xterm mode resetting: dont send focusin/focusout events");break;case 1005:this.ju("Xterm mode resetting: disable utf-8 mouse mode");break;case 1006:this.ju("Xterm mode resetting: disable sgr mouse mode");break;case 1007:this.ju("Xterm mode resetting: disable alternate scroll mode");break;case 1010:this.ju("Xterm mode resetting: dont scroll to bottom on tty output (rxvt)");break;case 1011:this.ju("Xterm mode resetting: dont scroll to bottom on key press (rxvt)");break;case 1015:this.ju("Xterm mode resetting: disable urxvt mouse mode");break;case 1034:this.ju("Xterm mode resetting: dont interpret meta key");break;case 11:Ns.warn("Not implemented: decipoints instead of row/column");default:this.ju("Suspected Xterm mode resetting, b="+s)}}else{if(0===t.length){this.ju("Mode resetting default case");break}for(let e=0;e<t.length;e++){let i=t[e];switch(i){case 2:Ns.debug("Mode resetting: lock keyboard"),this.screen.Ol=!1,Ns.debug("Mode resetting warning: not supposed to unlock if locked by DC3");break;case 4:Ns.debug("Mode resetting: replace mode"),this.screen.Vl=2;break;case 12:Ns.debug("Mode setting: send/receive mode (SRM), local echo on"),this.screen.Hl=!0;break;case 20:Ns.debug("Resetting LNM false"),this.screen._l=!1;default:this.ju("Mode resetting case="+i)}}}}break;case 109:{Ns.debug("-- type=(SGR) set graphics rendition");let t=this._u();0==t.length&&(t=[0]);let s=0;for(;s<t.length;){let n=t[s];switch(n){case 0:e.Xe=0,e.Ye=Jn.$e,e.Je=0,e.ni=Jn.$e,e.si=0,s++;break;case 1:e.Xe|=16,e.Xe&=-33,s++;break;case 2:e.Xe&=-17,e.Xe|=32,s++;break;case 4:e.Xe|=4,s++;break;case 5:e.Xe|=8,s++;break;case 7:e.Xe|=2,s++;break;case 8:e.Xe|=64,s++;break;case 21:e.Xe&=-17;break;case 22:e.Xe&=-17,e.Xe&=-33,s++;break;case 24:e.Xe&=-5,s++;break;case 25:e.Xe&=-9,s++;break;case 27:e.Xe&=-3,s++;break;case 28:e.Xe&=-65,s++;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:e.Ye=Jn.ti,e.Je=n-30,Ns.debug("Set color mode=STANDARD, value=0x"+qe(e.Je)),s++;break;case 38:if(s+1<t.length&&5==t[s+1])s+2<t.length?(e.Ye=Jn.ei,e.Je=t[s+2],Ns.debug("Set color mode=TABLE, value=0x"+qe(e.Je)),s+=2):(Ns.warn("Could not set color mode, bad TABLE color parameter="+i),s++);else if(s+1<t.length&&2==t[s+1])if(s+4<t.length){let i=Math.max(0,Math.min(255,t[2])),n=Math.max(0,Math.min(255,t[3])),l=Math.max(0,Math.min(255,t[4]));e.Ye=Jn.ii,e.Je=i<<16|n<<8|l,Ns.debug("Set color mode=RGB, value=0x"+qe(e.Je)),s+=4}else Ns.warn("Could not set color mode, bad RGB color parameter="+i),s++;else Ns.warn("Unexpected parameter for SGM="+i),s++;break;case 39:e.Ye=Jn.$e,e.Je=0,e.Xe&=-17,e.Xe&=-33,Ns.debug("Set color mode=DEFAULT"),s++;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:e.ni=Jn.ti,e.si=n-40,Ns.debug("Set bg color mode=STANDARD, value=0x"+qe(e.Je)),s++;break;case 48:if(s+1<t.length&&5==t[s+1])s+2<t.length?(e.ni=Jn.ei,e.si=t[s+2],Ns.debug("Set bg color mode=TABLE, value=0x"+qe(e.si)),s+=2):(Ns.warn("Could not set bg color mode, bad TABLE color parameter="+i),s++);else if(s+1<t.length&&2==t[s+1])if(s+4<t.length){let i=Math.max(0,Math.min(255,t[2])),n=Math.max(0,Math.min(255,t[3])),l=Math.max(0,Math.min(255,t[4]));e.ni=Jn.ii,e.si=i<<16|n<<8|l,Ns.debug("Set bg color mode=RGB, value=0x"+qe(e.si)),s+=4}else Ns.warn("Could not set bg color mode, bad RGB color parameter="+i),s++;else Ns.warn("Unexpected parameter for bg SGM="+i),s++;break;case 49:e.ni=Jn.$e,e.si=0,Ns.debug("Set bg color mode=DEFAULT"),s++;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:e.Ye=Jn.ti,e.Je=n-90,e.Xe|=16,e.Xe&=-33,Ns.debug("Set color mode=STANDARD BOLD, value=0x"+qe(e.Je)),s++;break;default:Ns.warn("Unexpected graphic rendering value="+t[s]+" in parameters="+i),s++}}}break;case 110:{Ns.debug("-- type=(DSR) device status report");let t=this._u(),i=this.Zu("CSI");if(63===this.ho&&s.length)switch(s[0]){case 6:Ns.debug("-- type=(DECXCPR) Extended Cursor Position"),i.push(63,...this.wi(e),82),Ns.debug("Sending response for Device Status Report: "+i),e.dr(i);break;case 15:Ns.debug("Printer Status"),i.push(63,49,51,110),e.dr(i);break;case 25:Ns.debug("UDK Status"),i.push(63,50,48,110),e.dr(i);break;case 26:Ns.debug("DSR Test; Keyboard Status"),i.push(63,50,55,59,49,110),e.dr(i);break;case 53:Ns.debug("Test Locator Status"),e.dr(i);break;case 62:Ns.debug("DSR Test; Macro Space"),i.push(48,42,123),e.dr(i);break;case 63:Ns.debug("-- type=(DECCKSR) Memory Checksum Report");const t=$n(),n=this.Zu("DCS"),l=this.Zu("ST"),h=s[1].toString().charCodeAt(0);Ns.debug("Sending response for Memory Checksum Report: "+i),e.dr([...n,h,33,126,...t,...l]);break;case 75:Ns.debug("Test Data Integrity"),i.push(63,55,48,110),e.dr(i);break;case 85:Ns.debug("Test Multiple Session Status"),i.push(63,56,55,110),e.dr(i);break;default:this.ju("DSR with ? mark")}else if(t&&void 0!==t[0])switch(t[0]){case 5:i.push(48,110),Ns.debug("Sending response for Device Status Report: "+i),e.dr(i);break;case 6:var p=String(e.Yn()+1),b=String(e.pi+1);for(let t=0;t<p.length;t++)i.push(p.charCodeAt(t));i.push(59);for(let t=0;t<p.length;t++)i.push(b.charCodeAt(t));i.push(82),Ns.debug("Sending response for Device Status Report: "+i),e.dr(i);break;default:this.ju("Device Status Report (DSR) case"+t)}}break;case 112:{let i=this._u();if(this.Su&&34==this.Su[0]){if(Ns.debug("-- type=(STR) Soft terminal reset"),i.length>0){switch(i[0]){case 61:this.Ro=!0;break;case 62:if(i.length>1)switch(i[1]){case 0:this.Ro=!1;break;case 1:case 2:this.Ro=!1}else this.Ro=!1}e.eu(0)}}else if(this.Su&&33==this.Su[0])Ns.debug("-- type=(DECSTR) Soft terminal reset"),e.eu(0),e.re.Ue(),e.Vl=2,e.Yh=!1,e.el(0,0),e.Al=!1,this.ju("unhandled DECNRCM: National Replacement Character Set Mode."),e.Ol=!1,e.Xl=!1,e.yl=0,e.Zn=0,e.Jn=e.height-1,e._h(e.height-1),e.el(0,0),Jn.Tl(),e.Ml=0,e.Pl=1,e.Xe=0,e.pl=!1,e.bl=0,e.Lu(),this.ju("unhandled DECAUPSS:\tSet selected in Set-Up."),e.eh=0,this.ju("unhandled DECKPM: Key Position Mode"),this.ju("unhandled DECRLM: Reset (Left-to-right), regardless of NVR setting"),this.ju("unhandled DECPCTERM: Enter/Exit PCTerm or Scancode Mode"),e.eu(0);else if(this.yo([parseInt("0x24",16)])&&1===s.length){Ns.debug("-- type=(DECRQM) Request Mode - Host To Terminal");const i=s[0];if(this.ho)if(63===this.ho){Ns.debug("Requesting DEC Modes: CSI ? Pd $ p");const t=this.Yu(i);Ns.debug(`Sending response for Requesting DEC Mode ${i}: ${t}`),e.dr(t)}else this.fo(t,s);else{Ns.debug("Requesting ANSI Modes: CSI Pa $ p");const t=this.Xu(i);Ns.debug(`Sending response for Requesting ANSI Mode ${i}: ${t}`),e.dr(t)}}else this.fo(t,s)}break;case 113:if(this.Su&&34==this.Su[0]){Ns.debug("-- type=(DECSCA) Select Character Protection Attribute"),e.pl=!!s.length&&1===s[0],e.bl=s.length?s[0]:0;break}break;case 114:{let t=this._u();if(this.Su&&36==this.Su[0])return Ns.debug("-- type=(DECCARA) change attributes of rect area"),void(t.length>4?this.do(t):Ns.warn("wrong params for change attributes of rect area "+t));if(Ns.debug("-- type=(STBM) set top and bottom margins"),e.bh())return;t=this._u(),2!=t.length||t[0]>=t[1]?(e.Zn=0,e.Jn=e.height-1):(e.Zn=null,e.Jn=null,e.Zn=t[0]>0?t[0]-1:0,e.Jn=t[1]>0?t[1]-1:0,e.jn(),e._h(e.height-1)),e.el(0,0)}break;case 115:if(Ns.debug("-- type=(DECSLRM) set left & right margins (if enabled) ELSE (SCP) save cursor position"),e.$u){let t=this._u();0==t.length?e.el(0,0):2==t.length&&t[0]<t[1]&&Ns.warn("set left and right margin is not supported yet.")}else Ns.debug("-- type=(SCOSC) Save Current Cursor Position"),e.Lu();break;case 116:{let i=this._u();if(this.Su&&36==this.Su[0])return Ns.debug("-- type=(RARA) Reverse attributes in rectangle"),i.length>4?this.do(i,!0):Ns.warn("wrong params for change attributes of rect area "+i),void e.re.Dt();if(this.Eo()&&0===s.length||1===s.length){Ns.debug("-- type=(DECSLPP) Set Lines Per Page");const t=!s||s[0]<24?24:s[0]>144?144:s[0];t!==e.height&&(e.Cl=t,e.Xn(e.Nn,!1,t),e.bh()&&(e.rl=e.Un,e.rl.Ur=!1,e.lineNumber=0,e.pi=0))}else this.fo(t,s)}break;case 117:if(this.Su&&1===this.Su.length&&36===this.Su[0]){if(Ns.debug("-- type=(DECRQTSR) Request Terminal State Report"),0===s.length||0===s[0])break;if(1===s[0]){const t=[...this.Zu("DCS"),49,36,115,...this.Ju(),...this.Zu("ST")];Ns.debug("Sending response for Request Terminal State Report: "+t),e.dr(t)}}else if(this.yo([parseInt("0x26",16)])&&0===s.length){Ns.debug("-- type=(DECRQUPSS) User-Preferred Supplemental Set");const t=[49,33,117,65],i=[...this.Zu("DCS"),...t,...this.Zu("ST")];Ns.debug("Sending response for User-Preferred Supplemental Set: "+i),e.dr(i)}else this.Eo()&&0===s.length?(Ns.debug("-- type=(SCORC) Restore Saved Cursor Position"),e.Bu()):this.fo(t,s);break;case 118:{let t=this._u();if(this.Su&&34==this.Su[0]){Ns.debug("-- type=(DECRQDE) Request Displayed Extent");const t=[...this.Zu("CSI"),...this.Jr(e.height),59,...this.Jr(e.width),59,49,59,...this.Jr(e._r()),59,...this.Jr(e.Nn),34,119];Ns.debug("Sending response for Request Displayed Extent: "+t),e.dr(t);break}if(Ns.debug("-- type=(CRA) Copy rectangle"),8==t.length){if(0==t[2]&&(t[2]=e.height),0==t[3]&&(t[3]=e.width),t[1]>t[3])break;if(t[0]>t[2])break;var k=t[7]-t[4],C=t[6]-t[1],m=t[2]-t[0];let i=e.xe;for(let e=0;e<t[0]-1&&i;e++)i=i.next;if(k>0)for(let t=0;t<k*e.height;t++)e.tr();var v=e.xe;if(k>=0)for(let e=0;e<t[5]-1&&v;e++)v=v.next;else Ns.warn("copy to previous page, not handled");var S=v,g=new Kn(e.width,!0);g.id=v.id;for(var E=g;m>=0;m--){for(var y=0;y<e.width;y++)v.elements[y]&&(g.elements[y]=v.elements[y]);if(!i)break;let s=0;if(C>0)for(s=t[1]-1;s<t[3];s++)i&&i.elements[s]&&s+C<i.elements.length&&(g.elements[s+C]=i.elements[s]);else for(s=-C,s=t[1]-1;s<t[3];s++)i&&i.elements[s+C]&&s<i.elements.length&&(g.elements[s]=i.elements[s+C]);if(g.next||(g.next=new Kn(e.width,!0),g.next.id=g.id+1),g.next.Qn=g,!v.next||!i.next)break;g=g.next,v=v.next,i=i.next}for(m=t[2]-t[0];m>=0;m--){for(a=0;a<e.width;a++)E.elements[a]&&(S.elements[a]=E.elements[a]);if(!S.next||!E.next)break;S=S.next,E=E.next}e.re.Dt()}}break;case 119:if(this.Su&&36===this.Su[0]&&s.length>0){Ns.debug("-- type=(DECRQPSR) Request Presentation State Report");const t=s[0],i=this.Zu("DCS"),n=this.Zu("ST");if(0===t)return void Ns.debug("Error Request ignored: ps = 0, DECRQPSR Request Presentation State Report");if(1===t){Ns.debug("-- type=(DECCIR) Cursor information report");const t=this.wi(e),s=64,l=e.Ml.toString().charCodeAt(0),h=e.Pl.toString().charCodeAt(0),r=64+el(e.Xe),u=e.pl?1000001:1e6,o=e.Rl,a=t=>t?"1":"0",c="01000"+a(e.gl)+a(e.Sl)+a(e.Yh),f=[...i,49,36,117,...t,59,r,59,u,59,parseInt(c,2),59,l,59,h,59,s,59,...o,...n];Ns.debug("Sending response for Cursor information report: "+f),e.dr(f)}else if(2===t){Ns.debug("-- type=(DECRQPSR) Request Presentation State Report");const t=e.ql.slice(0,e.width-1);let s=[...i,50,36,117];t.forEach((t,e)=>{1===t&&(s.push(...this.Jr(e+1)),s.push(47))}),s.pop();const l=[...s,...n];Ns.debug("Sending response for Request Presentation State Report: "+l),e.dr(l)}}Ns.debug("-- type=(EFR) Enable filter rectangle"),this.So(t);break;case 120:{Ns.debug("-- type=(REQTPARM) Request terminal parameters OR (FRA) Fill rectangular");let t=this._u();if(5==t.length){t[3]>e.height&&(t[3]=e.height),t[4]>e.width&&(t[4]=e.width);let i=t[4]-t[2]+1;if(m=t[3]-t[1]+1,i||(i=t[4]),m||(m=t[3]),e.tl<t[3])for(var D=0;D<t[3];D++)e.tr();if(i>0&&m>0){let i=e.xe;for(let e=0;e<t[1]-1&&i;e++)i=i.next;for(let s=0;s<m;s++)if(i){for(let s=t[2]-1;s<t[4];s++)i.elements[s]?i.elements[s].ze=t[0]:i.elements[s]=new Hn(t[0]),i.elements[s].pl=e.pl;if(!i||!i.next)break;i=i.next}}else Ns.warn("wrong params of fill the rectangle area "+t);e.re.Dt()}this.Su&&42==this.Su[0]&&(Ns.debug("-- type=(DECSACE) Select Attribute Change Extent"),this.bu=t.length?t[0]:0)}break;case 121:Ns.debug("-- type=(SACE) Select attribute change extent");const K=this._u();if(this.Su&&42==this.Su[0]){if(K.length>0){Ns.debug("--type=(DECRQCRA) Request Checksum of Rectangular Area");const t=K[0].toString().charCodeAt(0),i=$n(),s=[...this.Zu("DCS"),t,33,126,...i,...this.Zu("ST")];Ns.debug(`Sending response for Request Checksum of Rectangular Area: ${s} `),e.dr(s);break}Ns.warn("wrong params of Request Checksum of Rectangular Area");break}this.So(t);break;case 122:case 123:{Ns.debug("-- type=(DECERA)  (ERA) Erase rectangular");let i=this._u();if(4==i.length){i[2]>e.height&&(i[2]=e.height),i[3]>e.width&&(i[3]=e.width);let s=i[3]-i[1]+1;if(m=i[2]-i[0]+1,s||(s=i[3]),m||(m=i[2]),s>0&&m>0){var R=e.xe;for(let t=0;t<i[0]-1&&R;t++)R=R.next;for(let e=0;e<m;e++)if(R){for(let e=i[1]-1;e<i[3];e++)123==t?R.elements[e]&&R.elements[e].pl||(R.elements[e].ze=32):R.elements[e]&&(R.elements[e].ze=32);if(!R||!R.next)break;R=R.next}}else Ns.warn("wrong params of erasing the rectangle area "+i);e.re.Dt()}}break;case 124:if(this.Su&&36===this.Su[0]){Ns.debug("-- type=(DECSCPP)  Select Columns per Page");const t=s.length>0?s[0]:80;[0,132,80].indexOf(t)>-1?(e.kl=t||80,e.resize(e.kl,e.height,!0),e.kh(Math.min(e.pi,e.kl))):Ns.debug("-- type=(DECSCPP) The value is error when select Columns per Page")}else if(this.Su&&42===this.Su[0]&&s.length>0){Ns.debug("-- type=(DECSNLS)  Set Lines Per Screen");let t=Math.max(24,Math.min(s[0],144));e.ml=t;const i=e.Yn(),n=e.height;let l=e.nu(),h=l-t;if(h>0){for(;h>0;)e.Un=e.Un.next,e.xe=e.Un,h--;e.ol-=n-l}if(e.$n=e.tl>t,e.zn(t),e.resize(e.width,t,!0),e.jn(),n<t){let i=t-Math.min(n,e.tl);for(;i>0;)e.Ph(!0),i--}e.Kn=e.Fh(t-1),e.el(Math.min(t,i),e.pi),e.Lh()}break;case 125:const W=this.Su;if(W&&1===W.length&&39==W[0])if(Ns.debug("-- type=(DECIC) Insert Column"),0===s.length||1===s.length){let t=0===s.length?1:s[0];e.su(Jn.rh,e.pi,e.Un,e.tl,t)}else Ns.warn("wrong params of inserting columns(DECIC): "+s);else if(W&&1===W.length&&36==W[0]){Ns.debug("-- type=(DECSASD) Select active status display");const t=1===s[0]&&2===e.th?1:0;e.eh!==t&&(1===t?(e.Qt=!1,e.re.Ne()):(e.Qt=!0,e.re.Ue()),e.eh=t)}else this.fo(t,s);break;case 126:if(this.Su&&1===this.Su.length&&39==this.Su[0])if(Ns.debug("-- type=(DECDC) Delete Column"),0===s.length||1===s.length){let t=0===s.length?1:s[0];e.su(Jn.uh,e.pi,e.Un,e.tl,t)}else Ns.warn("wrong params of deleting columns(DECDC): "+s);else if(this.Su&&1===this.Su.length&&36===this.Su[0]){Ns.debug("-- type=(DECSSDT) Select Status Display (Line) Type");let i=s.length?s[0]:0;e.jr(i)?e.eu(i):this.fo(t,s)}else this.fo(t,s);break;default:this.ju("unhandled CSI dispatch character:0x"+qe(t))}},Xn.prototype.To=function(t){const e=this.screen.ph();if(e&&e.elements){for(let i=0;i<e.elements.length;i++)e.elements[i]||(e.elements[i]=new Hn(32)),e.elements[i].Xe=t;e.updated=!0}},Xn.prototype.Mo=function(){let t=this.screen,e=this.Tu,i=Number(String.fromCharCode.apply(null,this.Ru));switch(Ns.debug("OSC dispatch: type="+i+", params="+e),i){case 0:let s=String.fromCharCode.apply(null,e);t.callbacks.titleCallback&&t.callbacks.titleCallback(s);break;case 4:this.ju("OSC change color");break;case 5:this.ju("OSC change special color");break;case 10:this.ju("Change text color w/ OSC4 spec");break;case 11:this.ju("Change backkground color w/ OSC4 spec");break;case 15:this.ju("Change TEK text color w/ OSC4 spec");break;case 16:this.ju("Change TEK background color w/ OSC4 spec");break;case 52:this.ju("OSC clipboard access");break;case 104:this.ju("Reset color number");break;case 105:this.ju("Reset special color number");break;case 110:this.ju("Reset window text color");break;case 111:this.ju("Reset window background color");break;case 115:this.ju("Reset TEK window text color");break;case 116:this.ju("Reset TEK window background color");break;default:Ns.warn("Unknown OSC type "+i+" encountered with params="+e)}},Xn.prototype.Po=function(t){let e=this.screen;Ns.debug("Escape Dispatch Start:"),Ns.debug("-- b=0x"+qe(t)),this.ku[this.Cu++]=t,je(this.ku,Ns,0,this.Cu);var i=255&this.ku[1];switch(i){case 32:var s=255&this.ku[2];if(e.Ro||e.Or)e.Dl=!1;else switch(s){case 70:e.Dl=!1;break;case 71:e.Dl=!0}break;case 35:if(this.ku.length<2)throw new rn("Encountered escape # without following byte to determine action");{let t=255&this.ku[2],i=e.Xe;switch(t){case 51:i|=256,i&=-129,i&=-513,this.To(i);break;case 52:i|=512,i&=-257,i&=-129,this.To(i);break;case 53:i&=-129,i&=-257,i&=-513,this.To(i);break;case 54:i|=128,i&=-257,i&=-513,this.To(i);break;case 56:Ns.debug("-- type=(DECALN) Screen Alignment Pattern"),e.Zn=0,e.Jn=e.height-1;var n=e.Un;n||(e.tr(),n=e.Un);for(let t=0;t<e.height;t++){for(let t=0;t<e.width;t++)n.elements[t]=new Hn(69);n.updated=!0,t!==e.height-1&&(n.next||e.tr(),n=n.next)}e.Nr(0,0);break;default:this.ju("escape dispatch byte 0x23, modifier "+t)}}break;case 37:if(this.ku.length<2)this.Fo("Escape % seen with no following char");else{let t=255&this.ku[2];switch(t){case 64:e.Ze=!1;break;case 71:e.Ze=!0;break;default:Ns.warn("Unhandled ESC % byte=0x"+qe(t)+" assumed to be used for UTF8")}}break;case 40:case 41:case 42:case 43:if(3==this.Cu){var l=255&this.ku[2];Ns.debug("should set Gx x=0x"+qe(i-40)+" to 0x"+l),e.Rl[i-40]=t}else Ns.warn("unhandled set G0-G3 case");break;case 54:Ns.debug("-- type=(DECBI) Back Index"),e.Ar();break;case 55:e.Lu();break;case 56:if(e.bh())break;e.Bu();break;case 60:e.Or=!1;break;case 61:e.Xl=!0;break;case 62:e.Xl=!1;break;case 57:Ns.debug("-- type=(DECFI) - Forward Index"),e.wh();break;case 65:Ns.debug("-- type=VT52 Cursor Up"),e.Ir(-1,0);break;case 66:Ns.debug("-- type=VT52 Cursor Down"),e.Ir(1,0);break;case 67:Ns.debug("-- type=VT52 Cursor Right"),e.Ir(0,1);break;case 68:e.Or?(Ns.debug("-- type=VT52 Cursor Left"),e.Ir(0,-1)):(Ns.debug("-- type=(IND) Index down"),this.Wu(e,!0));break;case 69:Ns.debug("-- type=(NEL) Next line"),this.Wu(e);break;case 72:if(e.Or){Ns.debug("-- type=Move cursor home");var h=e.Yn();e.el(h,0)}else Ns.debug("-- type=(HTS) Horizontal Tab set"),e.ql[e.Ah()]=1;break;case 73:break;case 77:if(e.bh())break;this.zu(e);break;case 78:e.Sl=!0;break;case 79:e.gl=!0;break;case 80:this.ju("P!");break;case 90:break;case 92:Ns.debug("escapeDispatch 0x5C string terminator ");break;case 95:Ns.debug("unimplemented escape code 0x5F");break;case 99:Ns.debug("-- type=(RIS) --Hard Terminal Reset"),Ns.warn("(RIS --Hard Terminal Reset) is not recommended. Please use (DECSTR -- Soft Terminal Reset) instead "),e.dr([19]),e.eu(0),e.Bn=e.Pn(),e.Nn=1,e.Xe=0,e.Rl=Jn.Tl(),e.Ml=0,e.Pl=1,e.rr(),this.ju("DECUDK -- User defined keys"),this.ju("DECDLD -- Soft character set"),this.ju("DECDMAC -- Macro definitions"),e.dr([17]);break;case 125:Ns.warn("need to set G2 ");break;default:this.ju("unhandled ESCAPE dispatch character=0x"+qe(i))}this.ho=0},Xn.prototype.xo=function(t){return t<=23||25==t||t>=28&&t<32},Xn.prototype.Io=function(t){return t<=23||25==t||t>=28&&t<32||127==t||132==t||133==t||136==t||141==t||142==t||143==t},Xn.prototype.No=function(t){if(t<192)throw new rn("UTF8 cannot have first byte below C0");var e=255&~t;if(e>=32)this.Lo=1;else if(e>=16)this.Lo=2;else if(e>=8)this.Lo=3;else if(e>=4)this.Lo=4;else{if(!(e>=2))throw new rn("Unexpectedly high first byte value for UTF8");this.Lo=5}},Xn.prototype.Jr=function(t){let e=[];t=(t||0).toString();for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e},Xn.prototype.wi=function(t){return[...this.Jr(t.Yn()+1),59,...this.Jr(t.pi+1),59,...this.Jr(t.Nn)]},Xn.prototype.process=function(t){Bs.debug("Parser Loop Top: b=0x"+qe(t)+" state="+Xn.Uo[this.state]);var e=0;const i=this.screen.vr;switch(this.state){case 1:i.Sr++,this.Io(t)?(this.oo(t),e=1):t<32||(255===t?e=12:!0===this.screen.Ze&&t>=192&&t<=253?(this.Bo=[],this.Bo.push(t),this.No(t),e=17):94==t?e=18:t>127||this.uo(t)),12!=e&&(this.screen.Wi=!0);break;case 18:if(this.Io(t))this.uo(94),this.oo(t),e=1;else if(t<32)this.uo(94),this.state=1;else if(255===t)this.uo(94),e=12;else if(t>=192&&t<=253)this.uo(94),this.Bo=[],this.Bo.push(t),this.No(t),e=17;else{switch(t){case 72:case 63:2===this.screen.Kl?this.screen.Br():1===this.screen.Kl?this.screen.du():0==this.screen.Kl&&(this.uo(94),this.uo(t));break;default:this.uo(94),this.uo(t)}e=1}break;case 17:if(this.Bo.push(t),this.Lo--,0===this.Lo){var s=Xn.Pu(this.Bo);this.uo(s),e=1}break;case 12:switch(this.Xi=t,this.Xi){case 255:e=1,this.uo(t);break;case 250:e=14;break;case 251:case 252:case 253:case 254:e=13;break;case 247:this.oo(127);break;case 240:case 242:case 241:case 249:default:e=1}break;case 13:this.no(t),e=1;break;case 14:if(255===t){this.so(),e=12;break}this.Yi.push(t),e=14;break;case 10:t>=32&&t<48?(this.collect(t),e=19):t>=48&&t<64||59==t?(this.ao(t),e=20):t>=60&&t<64?(this.collect(t),e=20):58==t?e=22:t>=64&&t<127&&(this.vu=t,e=21);break;case 19:t>=32&&t<48?(this.collect(t),e=19):t>=48&&t<64?e=22:t>=64&&t<127&&(this.vu=t,e=21);break;case 20:t>=48&&t<64||59==t?(this.ao(t),e=20):58==t||t>=60&&t<64?e=22:t>=32&&t<48?(this.collect(t),e=19):t>=64&&t<127&&(this.vu=t,e=21);break;case 22:this.Oo?(92==t&&(e=1),this.Oo=!1):156==t?e=1:27==t&&(this.Oo=!0,e=22);break;case 21:this.Oo?(92!=t&&156!=t||(this.Gu(),e=1),this.Oo=!1):27==t?(this.Oo=!0,e=21):(this.Su.push(t),Ns.debug("DCS Passthrough partially implemented"),e=21);break;case 7:if(this.xo(t))e=this.oo(t)?1:7;else{if(this.Cu=0,this.ku[this.Cu++]=27,this.ku[this.Cu++]=t,t<32)throw new tl("VT_ESCAPE_START sees b<0x20");if(t>=32&&t<48)e=8;else switch(Bs.debug("escape dispatch main switch"),t){case 80:e=10;break;case 91:e=2;break;case 93:e=6;break;default:t<127?(this.Po(t),e=1):Ns.warn("VT_ESCAPE_START sees b>=0x7f")}}break;case 8:if(this.xo(t))e=this.oo(t)?1:8;else{if(t<32)throw new tl("unhandled byte=0x"+qe(t)+" in VT_ESCAPE_INTERMEDIATE");t<48?(this.collect(t),e=8):t<127?(this.Po(t),e=1):127==t&&(e=8)}break;case 6:t>=32&&t<=127&&(this.Ru.push(t),e=15);break;case 15:59===t?e=16:this.Ru.push(t);break;case 16:7===t||156===t?(this.Mo(),e=1):this.Tu.push(t);break;case 2:this.xo(t)?e=this.oo(t)?1:2:t>=32&&t<48?(this.collect(t),e=3):t<58?(this.ao(t),e=5):t<60?58==t?e=4:(e=5,this.ao(t)):t<64?(this.collect(t),e=5):t<127?(this.Do(t),e=1):t<2&&(e=2);break;case 5:if(this.xo(t))e=this.oo(t)?1:5;else if(t>=32&&t<48)this.collect(t),e=3;else if(t>=48&&t<58||59==t)this.ao(t),e=5;else if(58==t||t>=60&&t<64)e=4;else{if(!(t<127))throw new tl("unhandled byte "+t+" in VT_CSI_PARAM");this.Do(t),e=1}break;case 4:if(this.xo(t))e=this.oo(t)?1:4;else{if(t<32)throw new tl("unhandled byte "+t+" in VT_CSI_IGNORE");if(t<64||127==t)e=4;else{if(!(t<127))throw new tl("unhandled byte "+t+" in VT_CSI_IGNORE");e=1}}break;case 3:if(this.xo(t))e=this.oo(t)?1:3;else{if(t<32)throw new tl("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");if(t<48)this.collect(t),e=3;else if(t<64)e=4;else if(t<127)this.Do(t),e=1;else{if(127!=t)throw new tl("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");e=3}}}if(12!==e&&14!==e&&13!==e&&(this.screen.zi=2),0==e)switch(t){case 27:this.state=7;break;case 144:this.state=10;break;case 155:this.state=2,this.clear(),this.Cu=0,this.ku[this.Cu++]=27,this.ku[this.Cu++]=91;break;case 157:this.state=6}else{if(this.state!=e)switch(e){case 6:case 2:case 7:case 10:this.clear()}this.state=e}},Xn.Uo=["NO_STATE","VT_BASE","VT_CSI_START","VT_CSI_INTERMEDIATE","VT_CSI_IGNORE","VT_CSI_PARAM","VT_OSC_STRING","VT_ESCAPE_START","VT_ESCAPE_INTERMEDIATE","VT_SOS_PM_APC","VT_DCS_START","VTF","VT_TELNET_VERB","VT_TELNET_OPTION","VT_TELNET_SUB","VT_OSC_INTERMEDIATE","VT_OSC_PARAM","VT_UTF8","VT_CONTROL_CHAR","VT_DSC_INTERMEDIATE","VT_DCS_PARAM","VT_DCS_PASSTHROUGH","VT_DCS_IGNORE"];exports.startVT=startVT;return exports;}("undefined"==typeof org_zowe_terminal_vt?org_zowe_terminal_vt={}:org_zowe_terminal_vt);