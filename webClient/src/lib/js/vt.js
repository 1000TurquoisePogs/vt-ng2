/*
 This program and the accompanying materials are
 made available under the terms of the Eclipse Public License v2.0 which accompanies
 this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html

 SPDX-License-Identifier: EPL-2.0

 Copyright Contributors to the Zowe Project.
*/
if(!window.COM_RS_COMMON_LOGGER){window.COM_RS_COMMON_LOGGER=function(){console.log("Fallback logger loaded because common logger not found.")};var t=function(t){arguments.length>1&&(t=arguments[1]),console.log(t)};window.COM_RS_COMMON_LOGGER.makeComponentLogger=function(){return{info:t,warn:t,log:t,debug:t,severe:t}}}var e=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore");const l=1011,n=1001,i=4999,s=4001,r="Lucida Console, Monaco, monospace",h=240,u=241,o=242,a=247,c=249,f=250,w=251,d=252,p=253,b=254,v=255,m=0,k=1,A=3,g=5,C=6,S=24,T=25,y=29,E=31,F=32,x=33,M=34,P=35,N=36,R=38,D=39,I=40,L=46,_=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],O=3,U=[11,1,0],V=2,H=[4,5],B=1,z=2,J=3,j=4,W=5,G=6,$=7,X=8,K=273,q={Copy:273,Paste:273},Q=1,Y=0,Z=0,tt=1,et=2,lt=80,nt=77,it=66,st=65,rt=42,ht=112,ut=63,ot=43,at=9,ct=88,ft=[88,32,91,93],wt=1,dt=[88,32,60,45,111,45,62],pt=2,bt=94,vt=53,mt=[43,67,82],kt=74,At=47,gt=1,Ct=2,St=4,Tt=8,yt=16,Et=32,Ft=64,xt=128,Mt=256,Pt=0,Nt=1,Rt=2,Dt=16,It=64,Lt=1,_t=0,Ot=1,Ut=2,Vt=3,Ht=0,Bt=1,zt=2,Jt=3,jt=[49],Wt=[50],Gt=[54],$t=[55],Xt=[56],Kt=[57],qt=[49,53],Qt=[49,56],Yt=[50,49],Zt=[27,91,63,54,99],te=[27,91,63,54,50,59,jt,59,Wt,59,Gt,59,$t,59,Xt,99],ee=[27,91,63,54,51,59,jt,59,Wt,59,Gt,59,$t,59,Xt,99],le=[27,91,63,54,52,59,jt,59,Wt,59,Gt,59,$t,59,Xt,99],ne=[27,91,62,49,59,50,48,59,48,99],ie=[27,91,62,50,52,59,50,48,59,48,99],se=[27,91,62,52,49,59,50,48,59,48,99],re=[[27,91,91,65],[27,91,91,66],[27,91,91,67],[27,91,91,68],[27,91,91,69],[27,91,91,70],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],he=[[27,91,49,49,126],[27,91,49,50,126],[27,91,49,51,126],[27,91,49,52,126],[27,91,49,53,126],[27,91,49,55,126],[27,91,49,56,126],[27,91,49,57,126],[27,91,50,48,126],[27,91,50,49,126],[27,91,50,51,126],[27,91,50,52,126],[27,91,50,53,126],[27,91,50,54,126],[27,91,50,56,126],[27,91,50,57,126],[27,91,51,49,126],[27,91,51,50,126],[27,91,51,51,126],[27,91,50,52,126]],ue={"Cursor Up":[[27,91,65],[27,79,65],[27,65]],"Cursor Down":[[27,91,66],[27,79,66],[27,66]],"Cursor Right":[[27,91,67],[27,79,67],[27,67]],"Cursor Left":[[27,91,68],[27,79,68],[27,68]]},oe={0:[[48],[27,79,112]],1:[[49],[27,79,113]],2:[[50],[27,79,114]],3:[[51],[27,79,115]],4:[[52],[27,79,116]],5:[[53],[27,79,117]],6:[[54],[27,79,118]],7:[[55],[27,79,119]],8:[[56],[27,79,120]],9:[[57],[27,79,121]],".":[[46],[27,79,110]],"+":[[43],[27,79,108]],"-":[[45],[27,79,83]],"*":[[42],[27,79,82]],"/":[[47],[27,79,81]],Enter:[[13],[27,79,77]]},ae={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],KP_PF01:[27,79,80],KP_PF02:[27,79,81],KP_PF03:[27,79,82],KP_PF04:[27,79,83],PF1:[27,79,80],F1:he[0],PF01:he[0],PF2:[27,79,81],F2:he[1],PF02:he[1],PF3:[27,79,82],F3:he[2],PF03:he[2],PF4:[27,79,83],F4:he[3],PF04:he[3],F5:he[4],PF05:he[4],F6:he[5],PF06:he[5],F7:he[6],PF07:he[6],F8:he[7],PF08:he[7],F9:he[8],PF09:he[8],F10:he[9],PF10:he[9],F11:he[10],PF11:he[10],F12:he[11],PF12:he[11],F13:he[12],PF13:he[12],F14:he[13],PF14:he[13],F15:he[14],PF15:he[14],F16:he[15],PF16:he[15],F17:he[16],PF17:he[16],F18:he[17],PF18:he[17],F19:he[18],PF19:he[18],F20:he[19],PF20:he[19],"Page Up":[21],"Page Down":[22],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[1],End:[5],Insert:[27,91,50,126]},ce={"Alt+ ":[27,32],"Alt+!":[27,33],'Alt+"':[27,34],"Alt+#":[27,35],"Alt+$":[27,36],"Alt+%":[27,37],"Alt+&":[27,38],"Alt+'":[27,39],"Alt+(":[27,40],"Alt+)":[27,41],"Alt+*":[27,42],"Alt++":[27,43],"Alt+,":[27,44],"Alt+-":[27,45],"Alt+.":[27,46],"Alt+/":[27,47],"Alt+0":[27,48],"Alt+1":[27,49],"Alt+2":[27,50],"Alt+3":[27,51],"Alt+4":[27,52],"Alt+5":[27,53],"Alt+6":[27,54],"Alt+7":[27,55],"Alt+8":[27,56],"Alt+9":[27,57],"Alt+:":[27,58],"Alt+;":[27,59],"Alt+<":[27,60],"Alt+=":[27,61],"Alt+>":[27,62],"Alt+?":[27,63],"Alt+@":[27,64],"Alt+A":[27,65],"Alt+B":[27,66],"Alt+C":[27,67],"Alt+D":[27,68],"Alt+E":[27,69],"Alt+F":[27,70],"Alt+G":[27,71],"Alt+H":[27,72],"Alt+I":[27,73],"Alt+J":[27,74],"Alt+K":[27,75],"Alt+L":[27,76],"Alt+M":[27,77],"Alt+N":[27,78],"Alt+O":[27,79],"Alt+P":[27,80],"Alt+Q":[27,81],"Alt+R":[27,82],"Alt+S":[27,83],"Alt+T":[27,84],"Alt+U":[27,85],"Alt+V":[27,86],"Alt+W":[27,87],"Alt+X":[27,88],"Alt+Y":[27,89],"Alt+Z":[27,90],"Alt+`":[27,96],"Alt+a":[27,97],"Alt+b":[27,98],"Alt+c":[27,99],"Alt+d":[27,100],"Alt+e":[27,101],"Alt+f":[27,102],"Alt+g":[27,103],"Alt+h":[27,104],"Alt+i":[27,105],"Alt+j":[27,106],"Alt+k":[27,107],"Alt+l":[27,108],"Alt+m":[27,109],"Alt+n":[27,110],"Alt+o":[27,111],"Alt+p":[27,112],"Alt+q":[27,113],"Alt+r":[27,114],"Alt+s":[27,115],"Alt+t":[27,116],"Alt+u":[27,117],"Alt+v":[27,118],"Alt+w":[27,119],"Alt+x":[27,120],"Alt+y":[27,121],"Alt+z":[27,122],"Alt+{":[27,123],"Alt+|":[27,124],"Alt+}":[27,125],"Alt+~":[27,126],"Control+a":[1],"Control+b":[2],"Control+c":[3],"Control+d":[4],"Control+e":[5],"Control+f":[6],"Control+g":[7],"Control+h":[8],"Control+i":[9],"Control+j":[10],"Control+k":[11],"Control+l":[12],"Control+m":[13],"Control+n":[14],"Control+o":[15],"Control+p":[16],"Control+q":[17],"Control+r":[18],"Control+s":[19],"Control+t":[20],"Control+u":[21],"Control+v":[22],"Control+w":[23],"Control+x":[24],"Control+y":[25],"Control+z":[26],"Control+@":[0],"Control+3":[27],"Control+[":[27],"Control+\\":[28],"Control+]":[29],"Control+^":[30],"Control+_":[31],PF1:[27,79,80],F1:re[0],PF01:re[0],PF2:[27,79,81],F2:re[1],PF02:re[1],PF3:[27,79,82],F3:re[2],PF03:re[2],PF4:[27,79,83],F4:re[3],PF04:re[3],F05:re[4],PF05:re[4],F06:re[5],PF06:re[5],F07:re[6],PF07:re[6],F08:re[7],PF08:re[7],F09:re[8],PF09:re[8],F10:re[9],PF10:re[9],F11:re[10],PF11:re[10],F12:re[11],PF12:re[11],F13:re[12],PF13:re[12],F14:re[13],PF14:re[13],F15:re[14],PF15:re[14],F16:re[15],PF16:re[15],F17:re[16],PF17:re[16],F18:re[17],PF18:re[17],F19:re[18],PF19:re[18],F20:re[19],PF20:re[19],"Page Up":[27,91,53,126],"Page Down":[27,91,54,126],Backspace:[8],Tab:[9],Escape:[27],Enter:[13],"Cursor Next Line":[27,91,69],"Cursor Previous Line":[27,91,70],"Horizontal Pos Abs":[27,91,71],"Cursor Back Tab":[27,91,90],"Print Screen":[27,91,48,105],"Reset Mode":[27,91,108],Delete:[127],"Delete (Linux)":[27,91,51,126],Home:[27,91,49,126],End:[27,91,52,126],Insert:[27,91,50,126]},fe={"Set Mode 7800":[27,91,49,113],"Set Mode 7700":[27,91,50,113],"Set Mode 7300":[27,91,51,113],"Set Mode 8300":[27,91,52,113],"Set Mode Ansi":[27,91,53,113],"Save Cursor":[27,91,115],"Restore Cursor":[27,91,117],"Device Status":[27,91,110],"Scrolling Region":[27,91,114],"Set Graphic Rendition":[27,91,109],"End Host Print":[27,91,52,105],"Start Host Print":[27,91,53,105],"Cursor Position":[27,91,72],"Erase Data":[27,91,74],"Erase Line":[27,91,75],"Insert Line":[27,91,76],"Delete Line":[27,91,77],"Erase Area":[27,91,79],"Scroll Up":[27,91,83],"Scroll Down":[27,91,84],"Insert Character":[27,91,64],"Device Attributes":[27,91,99],"Hor/Vertical Position":[27,91,102],"Tab Clear":[27,91,103],"Set Mode":[27,91,104]},we=0,de=1,pe=0,be=1,ve=2,me=3,ke=20,Ae="innerScrolling",ge="scrollingDiv",Ce="Inner";var Se=function(t){return t||0===t?t.toString(16):"<FAIL: Not A Number>"},Te=function(t,l,n,i){var s,r=n||0,h=i||t.length,u="";for(s=0;s<h;s++)u+=Se(t[r+s])+" ",s%16==15&&(l&&l.debug?l.debug(u):e.debug(u),u="");u.length>0&&(l&&l.debug?l.debug(u):e.debug(u))},ye=function(t,e,l){return t<<16|e<<8|l};const Ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Fe=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];var xe=function(t){for(var e=[],l=(t.length,t.length),n=Math.floor(l/3),i=l-3*n,s=0,r=0;r<n;r++){let l=255&t[s++],n=255&t[s++],i=255&t[s++];e.push(Pe[l>>2]),e.push(Pe[l<<4&63|n>>4]),e.push(Pe[n<<2&63|i>>6]),e.push(Pe[63&i])}if(0!=i){let l=255&t[s++];if(e.push(Pe[l>>2]),1==i)e.push(Pe[l<<4&63]),e.push(61),e.push(61);else{let n=255&t[s++];e.push(Pe[l<<4&63|n>>4]),e.push(Pe[n<<2&63]),e.push(61)}}return String.fromCharCode.apply(null,e)},Me=function(t){var l=t.length,n=l/4,i=0,s=n,r=0,h=0;if(4*n!=l)return e.warn("Base64 decode failed, encountered 4-mult"),null;0!=l&&"="==t[l-1]&&(i++,s--,"="==t[l-2]&&i++);var u=3*s;0!=i&&(1==i?u+=2:u++);var o=new Uint8Array(u);let a=4*s;for(;r<a;){let e=Ee[t.charCodeAt(r++)],l=Ee[t.charCodeAt(r++)],n=Ee[t.charCodeAt(r++)],i=Ee[t.charCodeAt(r++)];o[h++]=e<<2|l>>4,o[h++]=l<<4|n>>2,o[h++]=n<<6|i}if(0!=i){let e=Ee[t.charCodeAt(r++)],l=Ee[t.charCodeAt(r++)];if(o[h++]=e<<2|l>>4,1==i){let e=Ee[t.charCodeAt(r++)];o[h++]=l<<4|e>>2}}return o};const Pe=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47];var Ne=function(t){},Re=function(t,e){switch(192&t){case 0:return(63&t)<<8|e;case 64:case 192:return(63&t)<<6|63&e;default:return Yl.warn("Bad SBA position, b1=0x"+Se(t)+", b2=0x"+Se(e)),0}},De=function(t,e){var l=(255&t[e])<<8;return 255&t[e+1]|l},Ie=function(t,e){var l=(255&t[e])<<16,n=(255&t[e+1])<<8;return 255&t[e+2]|n|l},Le=function(t,e){var l=(255&t[e])<<8|255&t[e+1];return l>=32768?l-65536:l},_e=function(t,e){var l=(255&t[e])<<24|(255&t[e+1])<<16|(255&t[e+2])<<8|255&t[e+3];return l>=2147483648?l-4294967296:l},Oe=function(t,e,l,n,i){var s;for(s=0;s<l;s++)n[s]=Le(t,e),i[s]=Le(t,e+2),e+=4;return e},Ue=function(t,e,l,n,i){var s;for(s=0;s<l;s++)n[s]=t[e+0],i[s]=t[e+1],e+=2;return e},Ve=function(t,e,l,n,i){var s;for(s=0;s<i;s++)l[n+s]=t[e+s]},He=function(t,e){var l;for(l=0;l<t.length;l++)if(t[l]==e)return!0;return!1},Be=function(t,e,l){function n(){}for(var i in n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.A=e,t.C=e.prototype,l)t[i]=l[i]},ze=function(){this.size=0,this.S=null,this.T=null};ze.prototype={clear:function(){let t=this.size,e=this.S;for(let l=0;l<t-1;l++){e.M.F=void 0;let t=e.M;e.M=void 0,e=t}this.S=null,this.T=null,this.size=0},P:function(){let t=[],e=this.size;if(0==e)return t;let l=this.S;for(let n=0;n<e&&(t.push(l.data),l.M);n++){l.M.F=void 0;let t=l.M;l.M=void 0,l=t}return this.S=null,this.T=null,this.size=0,t},N:function(){return this.S},R:function(){return this.T},D:function(){return this.size},I:function(t){let e=new Je(t);0==this.size?this.S=e:(e.F=this.T,this.T.M=e),this.T=e,this.size++},L:function(t){let e=new Je(t);0==this.size?this.T=e:(e.M=this.S,this.S.F=e),this.S=e,this.size++},O:function(){if(0==this.size)return null;if(1==this.size){let t=this.T;return this.S=null,this.T=null,this.size=0,t.F=void 0,t.M=void 0,t}{this.size--;let t=this.T;return t.F.M=null,this.T=t.F,t.F=void 0,t.M=void 0,t}},U:function(){if(0==this.size)return null;if(1==this.size){let t=this.S;return this.S=null,this.T=null,this.size=0,t.F=void 0,t.M=void 0,t}{this.size--;let t=this.S;return t.M.F=null,this.S=t.M,t.F=void 0,t.M=void 0,t}},add:function(t,e){if(t<0||t>this.size)return-1;if(t==this.size)this.I(e);else if(0==t)this.L(e);else{let l=new Je(e),n=this.size-1,i=this.S;for(let e=1;e<n;e++){if(e==t)return l.F=i,l.M=i.M,i.M.F=l,i.M=l,++this.size;i=i.M}}},V:function(t){if(t<0||t>=this.size)return null;if(t==this.size-1)return this.O();if(0==t)return this.U();{let e=this.size-1,l=this.S;for(let n=1;n<e;n++){if(n==t)return l.M.F=l.F,l.F.M=l.M,this.size--,l.F=void 0,l.M=void 0,l;l=l.M}}},get:function(t){if(t>=this.size||t<0)return null;if(0==t)return this.N();if(t==this.size-1)return this.R();{let e=this.size-1,l=this.S;for(let n=1;n<e;n++){if(n==t)return l;l=l.M}}}};var Je=function(t){this.data=t,this.F,this.M};const je={Esc:"Escape",Nonconvert:"NonConvert",Spacebar:" ",ArrowLeft:"Left",ArrowRight:"Right",ArrowDown:"Down",ArrowUp:"Up",Del:"Delete","U+001B":"Escape","U+007F":"Delete","U+0008":"Backspace","U+0009":"Tab",OS:"Win",Meta:"Win",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MediaTrackNext:"MediaNextTrack",MediaTrackPrevious:"MediaPreviousTrack",AudioVolumeMute:"VolumeMute",AudioVolumeDown:"VolumeDown",AudioVolumeUp:"VolumeUp",Caps:"CapsLock",Ctrl:"Control",Ins:"Insert",Space:" ",Ent:"Enter"},We=0,Ge=1,$e=2,Xe=4,Ke=3,qe=5,Qe=6,Ye=7,Ze=1,tl=2,el=4,ll=8;function nl(t,e){this.type=t,this.value=e}function il(t,e,l,n,i,s,r,h){var u=[];return u[We]=t,u[Ge]=e,u[$e]=l,u[Xe]=n,u[Qe]=i,u[Ke]=s,u[qe]=r,u[Ye]=h,u}const sl={Accept:null,Again:null,AllCandidates:null,Alphanumeric:null,ContextMenu:null,Attn:null,BrowserBack:null,BrowserFavorites:null,BrowserForward:null,BrowserHome:null,BrowserRefresh:null,BrowserSearch:null,BrowserStop:null,CapsLock:null,Clear:null,CodeInput:null,Compose:null,Crsel:null,Convert:null,Copy:null,Cut:null,Down:new il(new nl(64,"Cursor Down"),null,null,null,null,null,null,null),End:new il(new nl(64,"End"),null,null,null,null,null,null,null),Enter:new il(new nl(64,"Enter"),null,null,null,null,null,null,null),EraseEof:null,Execute:null,Exsel:null,F1:new il(new nl(64,"F1"),new nl(64,"F13"),null,null,null,null,null,null),F2:new il(new nl(64,"F2"),new nl(64,"F14"),null,null,null,null,null,null),F3:new il(new nl(64,"F3"),new nl(64,"F15"),null,null,null,null,null,null),F4:new il(new nl(64,"F4"),new nl(64,"F16"),null,null,null,null,null,null),F5:new il(new nl(64,"F5"),new nl(64,"F17"),null,null,null,null,null,null),F6:new il(new nl(64,"F6"),new nl(64,"F18"),null,null,null,null,null,null),F7:new il(new nl(64,"F7"),new nl(64,"F19"),null,null,null,null,null,null),F8:new il(new nl(64,"F8"),new nl(64,"F20"),null,null,null,null,null,null),F9:new il(new nl(64,"F9"),new nl(64,"F21"),null,null,null,null,null,null),F10:new il(new nl(64,"F10"),new nl(64,"F22"),null,null,null,null,null,null),F11:new il(new nl(64,"F11"),new nl(64,"F23"),null,null,null,null,null,null),F12:new il(new nl(64,"F12"),new nl(64,"F24"),null,null,null,null,null,null),F13:new il(new nl(64,"F13"),null,null,null,null,null,null,null),F14:new il(new nl(64,"F14"),null,null,null,null,null,null,null),F15:new il(new nl(64,"F15"),null,null,null,null,null,null,null),F16:new il(new nl(64,"F16"),null,null,null,null,null,null,null),F17:new il(new nl(64,"F17"),null,null,null,null,null,null,null),F18:new il(new nl(64,"F18"),null,null,null,null,null,null,null),F19:new il(new nl(64,"F19"),null,null,null,null,null,null,null),F20:new il(new nl(64,"F20"),null,null,null,null,null,null,null),F21:new il(new nl(64,"F21"),null,null,null,null,null,null,null),F22:new il(new nl(64,"F22"),null,null,null,null,null,null,null),F23:new il(new nl(64,"F23"),null,null,null,null,null,null,null),F24:new il(new nl(64,"F24"),null,null,null,null,null,null,null),FinalMode:null,Find:null,FullWidth:null,HalfWidth:null,HangulMode:null,HanjaMode:null,Help:null,Hiragana:null,Home:new il(new nl(64,"Home"),null,null,null,null,null,null,null),Insert:new il(new nl(64,"Insert"),null,null,null,null,null,null,null),JapaneseHiragana:null,JapaneseKatakana:null,JapaneseRomaji:null,JunjaMode:null,KanaMode:null,KanjiMode:null,Katakana:null,LaunchApplication1:null,LaunchApplication2:null,LaunchMail:null,Left:new il(new nl(64,"Cursor Left"),null,null,null,null,null,null,null),MediaNextTrack:null,MediaPlayPause:null,MediaPreviousTrack:null,MediaStop:null,ModeChange:null,Nonconvert:null,NumLock:null,PageDown:new il(new nl(64,"Page Down"),null,null,null,null,null,null,null),PageUp:new il(new nl(64,"Page Up"),null,null,null,null,null,null,null),Paste:null,Pause:null,Play:null,PreviousCandidate:null,PrintScreen:null,Process:null,Props:null,Right:new il(new nl(64,"Cursor Right"),null,null,null,null,null,null,null),RomanCharacters:null,ScrollLock:null,Select:null,SelectMedia:null,Stop:null,Up:new il(new nl(64,"Cursor Up"),null,null,null,null,null,null,null),Undo:null,VolumeDown:null,VolumeMute:null,VolumeUp:null,Win:null,Zoom:null," ":new il(new nl(2," "),new nl(2," "),new nl(64,"Control+@"),null,null,null,null,null),"!":new il(null,new nl(2,"!"),null,null,null,null,null,null,null),'"':new il(null,new nl(2,'"'),null,null,null,null,null,null),"#":new il(null,new nl(2,"#"),null,null,null,null,null,null),$:new il(null,new nl(2,"$"),null,null,null,null,null,null),"%":new il(null,new nl(2,"%"),null,null,null,null,null,null),"&":new il(null,new nl(2,"&"),null,null,null,null,null,null),"'":new il(new nl(2,"'"),null,null,null,null,null,null,null),"(":new il(null,new nl(2,"("),null,null,null,null,null,null),")":new il(null,new nl(2,")"),null,null,null,null,null,null),"*":new il(null,new nl(2,"*"),null,null,null,null,null,null),"+":new il(null,new nl(2,"+"),null,null,null,null,null,null),",":new il(new nl(2,","),null,null,null,null,null,null,null),"-":new il(new nl(2,"-"),null,new nl(64,"Control+_"),null,null,null,null,null),".":new il(new nl(2,"."),null,null,null,null,null,null,null),"/":new il(new nl(2,"/"),null,null,null,null,null,null,null),0:new il(new nl(2,"0"),null,null,null,null,null,null,null),1:new il(new nl(2,"1"),null,null,null,null,null,null,null),2:new il(new nl(2,"2"),null,new nl(64,"Control+@"),null,null,null,null,null),3:new il(new nl(2,"3"),null,new nl(64,"Control+3"),null,null,null,null,null),4:new il(new nl(2,"4"),null,null,null,null,null,null,null),5:new il(new nl(2,"5"),null,null,null,null,null,null,null),6:new il(new nl(2,"6"),null,new nl(2,String.fromCharCode.apply(null,[172])),null,null,null,null,null),7:new il(new nl(2,"7"),null,null,null,null,null,null,null),8:new il(new nl(2,"8"),null,null,null,null,null,null,null),9:new il(new nl(2,"9"),null,null,null,null,null,null,null),Numpad0:new il(new nl(2,"0"),null,null,null,null,null,null,null),Numpad1:new il(new nl(2,"1"),null,null,null,null,null,null,null),Numpad2:new il(new nl(2,"2"),null,null,null,null,null,null,null),Numpad3:new il(new nl(2,"3"),null,null,null,null,null,null,null),Numpad4:new il(new nl(2,"4"),null,null,null,null,null,null,null),Numpad5:new il(new nl(2,"5"),null,null,null,null,null,null,null),Numpad6:new il(new nl(2,"6"),null,null,null,null,null,null,null),Numpad7:new il(new nl(2,"7"),null,null,null,null,null,null,null),Numpad8:new il(new nl(2,"8"),null,null,null,null,null,null,null),Numpad9:new il(new nl(2,"9"),null,null,null,null,null,null,null),"Numpad/":new il(new nl(2,"/"),null,null,null,null,null,null,null),"Numpad*":new il(new nl(2,"*"),null,null,null,null,null,null,null),"Numpad-":new il(new nl(2,"-"),null,null,null,null,null,null,null),"Numpad+":new il(new nl(2,"+"),null,null,null,null,null,null,null),NumpadEnter:new il(new nl(2,"Enter"),null,new nl(64,"New Line"),null,null,null,null,null),"Numpad.":new il(new nl(2,"."),null,null,null,null,null,null,null),NumpadUp:new il(new nl(64,"Cursor Up"),null,null,null,null,null,null,null),NumpadDown:new il(new nl(64,"Cursor Down"),null,null,null,null,null,null,null),NumpadLeft:new il(new nl(64,"Cursor Left"),null,null,null,null,null,null,null),NumpadRight:new il(new nl(64,"Cursor Right"),null,null,null,null,null,null,null),NumpadHome:new il(new nl(64,"Home"),null,null,null,null,null,null,null),NumpadPageUp:new il(new nl(64,"PageUp"),null,null,null,null,null,null,null),NumpadPageDown:new il(new nl(64,"PageDown"),null,null,null,null,null,null,null),NumpadEnd:new il(new nl(64,"End"),null,null,null,null,null,null,null),NumpadInsert:new il(new nl(64,"Insert"),null,null,null,null,null,null,null),NumpadDelete:new il(new nl(64,"Delete"),null,null,null,null,null,null,null),":":new il(null,new nl(2,":"),null,null,null,null,null,null),";":new il(new nl(2,";"),null,null,null,null,null,null,null),"<":new il(null,new nl(2,"<"),null,null,null,null,null,null),"=":new il(new nl(2,"="),null,null,null,null,null,null,null),">":new il(null,new nl(2,">"),null,null,null,null,null,null),"?":new il(null,new nl(2,"?"),null,null,null,null,null,null),"@":new il(null,new nl(2,"@"),null,null,null,new nl(64,"Control+@"),null,null),"[":new il(new nl(2,"["),null,new nl(64,"Control+["),null,null,null,null,null),"\\":new il(new nl(2,"\\"),null,new nl(64,"Control+\\"),null,null,null,null,null),"]":new il(new nl(2,"]"),null,new nl(64,"Control+]"),null,null,null,null,null),"^":new il(null,new nl(2,"^"),null,new nl(64,"Control+^"),null,new nl(64,"Record Separator"),null,null),_:new il(null,new nl(2,"_"),null,new nl(64,"Control+_"),null,new nl(64,"Unit Separator"),null,null),"`":new il(new nl(2,"`"),null,null,null,null,null,null,null),a:new il(new nl(2,"a"),new nl(2,"A"),new nl(64,"Control+a"),null,null,null,null,null),b:new il(new nl(2,"b"),new nl(2,"B"),new nl(64,"Control+b"),null,null,null,null,null),c:new il(new nl(2,"c"),new nl(2,"C"),new nl(64,"Control+c"),null,null,null,null,null),d:new il(new nl(2,"d"),new nl(2,"D"),new nl(64,"Control+d"),null,null,null,null,null),e:new il(new nl(2,"e"),new nl(2,"E"),new nl(64,"Control+e"),null,null,null,null,null),f:new il(new nl(2,"f"),new nl(2,"F"),new nl(64,"Control+f"),null,null,null,null,null),g:new il(new nl(2,"g"),new nl(2,"G"),new nl(64,"Control+g"),null,null,null,null,null),h:new il(new nl(2,"h"),new nl(2,"H"),new nl(64,"Control+h"),null,null,null,null,null),i:new il(new nl(2,"i"),new nl(2,"I"),new nl(64,"Control+i"),null,null,null,null,null),j:new il(new nl(2,"j"),new nl(2,"J"),new nl(64,"Control+j"),null,null,null,null,null),k:new il(new nl(2,"k"),new nl(2,"K"),new nl(64,"Control+k"),null,null,null,null,null),l:new il(new nl(2,"l"),new nl(2,"L"),new nl(64,"Control+l"),null,null,null,null,null),m:new il(new nl(2,"m"),new nl(2,"M"),new nl(64,"Control+m"),null,null,null,null,null),n:new il(new nl(2,"n"),new nl(2,"N"),new nl(64,"Control+n"),null,null,null,null,null),o:new il(new nl(2,"o"),new nl(2,"O"),new nl(64,"Control+o"),null,null,null,null,null),p:new il(new nl(2,"p"),new nl(2,"P"),new nl(64,"Control+p"),null,null,null,null,null),q:new il(new nl(2,"q"),new nl(2,"Q"),new nl(64,"Control+q"),null,null,null,null,null),r:new il(new nl(2,"r"),new nl(2,"R"),new nl(64,"Control+r"),null,null,null,null,null),s:new il(new nl(2,"s"),new nl(2,"S"),new nl(64,"Control+s"),null,null,null,null,null),t:new il(new nl(2,"t"),new nl(2,"T"),new nl(64,"Control+t"),null,null,null,null,null),u:new il(new nl(2,"u"),new nl(2,"U"),new nl(64,"Control+u"),null,null,null,null,null),v:new il(new nl(2,"v"),new nl(2,"V"),null,null,null,null,null,null),w:new il(new nl(2,"w"),new nl(2,"W"),new nl(64,"Control+w"),null,null,null,null,null),x:new il(new nl(2,"x"),new nl(2,"X"),new nl(64,"Control+x"),null,null,null,null,null),y:new il(new nl(2,"y"),new nl(2,"Y"),new nl(64,"Control+y"),null,null,null,null,null),z:new il(new nl(2,"z"),new nl(2,"Z"),new nl(64,"Control+z"),null,null,null,null,null),"{":new il(null,new nl(2,"{"),null,null,null,null,null,null),"|":new il(null,new nl(2,"|"),null,null,null,null,null,null),"}":new il(null,new nl(2,"}"),null,null,null,null,null,null),"~":new il(null,new nl(2,"~"),null,null,null,null,null,null),Backspace:new il(new nl(64,"Delete"),new nl(64,"Erase Character"),new nl(64,"Delete Character"),null,null,null,null,null),Tab:new il(new nl(64,"Tab"),null,null,null,null,null,null,null),"U+0018":null,Escape:new il(new nl(64,"Escape"),null,null,null,null,null,null,null),Delete:new il(new nl(64,"Delete"),null,null,null,null,null,null,null),"U+00A1":null,"U+0300":null,"U+0301":null,"U+0302":null,"U+0303":null,"U+0304":null,"U+0306":null,"U+0307":null,"U+0308":null,"U+030A":null,"U+030B":null,"U+030C":null,"U+0327":null,"U+0328":null,"U+0345":null,"U+20AC":null,"U+3099":null,"U+309A":null};var rl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.render"),hl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.scaling"),ul=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.color");const ol=1,al=2,cl=3,fl=100,wl=-1.5,dl=-.25,pl=5,bl=1,vl=2,ml=4,kl=8,Al=16,gl=32,Cl=64,Sl=128,Tl=256,yl=512,El=4096,Fl=16777215,xl=2281766656,Ml=1,Pl=2;var Nl=0;const Rl=0,Dl=4210752,Il=61440,Ll=16777215;var _l=function(t){if(t.match(/^#([a-fA-F0-9]){6}/)){var e=parseInt(t.substring(1,7),16);return"rgb("+(e>>16)+","+(e>>8&255)+","+(255&e)+")"}if(t.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)/))return t;rl.warn("Webcolor: bad color value, "+t)},Ol=function(t,e,l,n,i){ul.log(ul.FINEST,"Setting fill color. Previous color="+t.fillStyle+". Args length="+arguments.length),5==arguments.length?t.fillStyle="rgba("+e+","+l+","+n+","+i+")":4==arguments.length?t.fillStyle="rgb("+e+","+l+","+n+")":2==arguments.length?t.fillStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.fillStyle=_l(e),ul.log(ul.FINEST,"Set fill color. New color="+t.fillStyle)},Ul=function(t,e,l,n,i){ul.log(ul.FINEST,"Setting stroke color. Previous color="+t.strokeStyle+". Args length="+arguments.length),5==arguments.length?t.strokeStyle="rgba("+e+","+l+","+n+","+i+")":4==arguments.length?t.strokeStyle="rgb("+e+","+l+","+n+")":2==arguments.length?t.strokeStyle="rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")":t.strokeStyle=_l(e),ul.log(ul.FINEST,"Set stroke color. New color="+t.strokeStyle)},Vl=function(t,e){t.globalAlpha=e},Hl=function(t,e,l,n){t.beginPath(),t.arc(e,l,n,0,6.29,!1),t.closePath(),t.fill()},Bl=function(t,e,l,n,i,s){t.beginPath(),t.moveTo(e,l),t.arc(e,l,n,i,s,!1),t.closePath(),t.fill()},zl=function(t,e,l,n,i,s){for(var r=new Array(n),h=0;h<n;h++)r[h]=e[l+h];var u=String.fromCharCode.apply(null,r);rl.log(rl.FINEST,"Draw chars at canvas px("+i+","+s+") runLength="+n+" lineBuffer start="+l+" text="+u),t.fillText(u,i,s)};function Jl(t,e,l,n,i){rl.debug("Draw line (2) from ("+e+","+l+") to ("+n+","+i+")"),t.beginPath();var s=t.fillStyle;t.fillStyle=t.strokeStyle;for(var r=Math.sqrt((n-e)*(n-e)+(i-l)*(i-l)),h=n-e,u=i-l,o=Math.atan(u/(0==h?.01:h))+(h<0?Math.PI:0),a=0;a<r;a++)t.fillRect(Math.round(e+Math.cos(o)*a),Math.round(l+Math.sin(o)*a),1,1);t.stroke(),t.fillStyle=s}var jl=function(t,e,l,n,i){rl.debug("Draw line from ("+e+","+l+") to ("+n+","+i+")"),t.beginPath(),t.moveTo(e,l),t.lineTo(n,i),t.stroke()};function Wl(t,l){this.H=t.H,this.B=t,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=Number(Wl.K),this.Q=t.Y&&t.Y.Q?t.Y.Q:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=l,this.ct=0,this.ft=cl,this.wt=500,this.dt=!0,this.pt=t.bt(),this.vt=0,this.mt=Rl,this.kt=Fl,this.At=Ll,this.scaleMethod=1,this.gt=null,this.Ct=null,this.ft==cl&&this.wt>=fl&&0!=fl&&this.St()}function Gl(t,l,n){this.B=t,t.Tt=this,this.J=-1,this.W=-1,this.G=-1,this.X=-1,this.font=null,this.K=Wl.K,this.Q=t.Y&&t.Y.Q?t.Y.Q:r,e.debug("virtualScreen = "+t),e.debug("cInfo="+t.Z),this.tt=!0,this.et=1,this.lt=1,this.nt=-1,this.it=-1,this.st=1,this.rt=1,this.ht=1,this.ut=0,this.ot=0,this.at=l,this.ct=0,this.ft=cl,this.yt=cl,this.wt=500,this.Et=500,this.pt=t.bt(),this.scaleMethod=n||1,this.Ft=16711680,this.xt=65280,this.Mt=Rl,this.Pt=16777215,this.Nt=65280,this.Rt=this.Nt,this.Dt=this.Nt,this.It=this.Mt,this.Lt=[0,12255232,47872,12303104,187,12255419,48059,12303291],this._t=[this.Lt[0],this.Lt[1],this.Lt[2],this.Lt[3],this.Lt[4],this.Lt[5],this.Lt[6],this.Lt[7],8421504,33023,65408,8454143,16744576,16744703,16777088,12632256],this.Ot=[5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],this.Ut=[this.Ot[0],this.Ot[1],this.Ot[2],this.Ot[3],this.Ot[4],this.Ot[5],this.Ot[6],this.Ot[7],8421504,33023,65408,8454143,16744576,16744703,16777088,16777215],this.At=Ll,this.kt=Fl,this.Vt=!1,this.Ht=!0,this.gt=null,this.Ct=null,this.ft==cl&&this.wt>=fl&&0!=fl&&this.St(),this.Et>=fl&&0!=fl&&this.Bt(),this.zt()}Wl.Jt=2,Wl.jt="normal",Wl.Wt="normal",Wl.K=10,Wl.Q=r,Wl.prototype.Gt=function(t){if(t){if(rl.debug("Setting font properties="+JSON.stringify(t)),t.size&&null!==t.size){let e=Number(t.size);this.K=e,Wl.K=e}t.scaleMethod&&null!==t.scaleMethod&&(this.scaleMethod=t.scaleMethod,1==this.scaleMethod&&(Wl.K=10)),this.$t(),this.zt()}},Wl.prototype.Xt=function(t,e,l,n){t.font=Wl.Wt+" "+Wl.jt+" "+e+"px "+l;var i=t.measureText(n);this.ut=Nl,this.ht=.85*e,this.Kt=e-(this.ut+this.ht),this.ot=this.ht+this.ut;var s=e;return{width:i.width,height:s}},Wl.prototype.qt=function(){return this.B.oiaEnabled?this.B.height+Wl.Jt:this.B.height},Wl.prototype.Qt=function(t,e){var l,n=t.width,i=t.height,s=this.B;let r;if(this.tt=!0,this.it=0,this.nt=0,hl.debug("Calculate font for canvas w="+n+",h="+i),0==this.scaleMethod)for(hl.debug("Calculating for scaleMethod=ratio"),r=50;r>4;r--){var h=(l=this.Xt(e,r,this.Q,"M")).width*s.width,u=l.height*this.qt();if(hl.debug("At font size="+r+", need w="+h+",h="+u),h<=n&&u<=i){hl.debug("Found size match. Chose font size ="+r+" for canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Wl.Wt+" "+Wl.jt+" "+r+"px "+this.Q,this.it=h,this.nt=u;break}}else if(1==this.scaleMethod){hl.debug("Calculating for scaleMethod=fit"),r=10,l=this.Xt(e,r,this.Q,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Wl.Wt+" "+Wl.jt+" "+r+"px "+this.Q;var o=t.width/(s.width*l.width),a=t.height/(this.qt()*l.height);o=(parseInt(10*o)/10).toFixed(1),a=(parseInt(10*a)/10).toFixed(1),this.et=1/o,this.lt=1/a,this.it=t.width*this.et,this.nt=t.height*this.lt,e.scale(o,a),this.Yt.setTransform(1,0,0,1,0,0),this.Yt.scale(o,a),hl.debug("Scaled for font size="+r+", canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut),hl.debug("Scale factors are: sfX="+this.et+", sfY="+this.lt+", aH="+this.nt+", aW="+this.it+", sW="+o+", sH="+a)}else hl.debug("Calculating for scaleMethod=no scale"),r=Wl.K,l=this.Xt(e,r,this.Q,"M"),this.tt=!1,this.st=l.width,this.rt=l.height,this.font=Wl.Wt+" "+Wl.jt+" "+r+"px "+this.Q,this.et=1,this.lt=1,this.it=t.width,this.nt=t.height,e.scale("1","1"),this.Yt.setTransform(1,0,0,1,0,0),this.Yt.scale("1","1"),hl.debug("Scaled for font size="+r+", canvas w="+n+",h="+i+" ascent="+this.ht+", descent="+this.Kt+" leading="+this.ut);if(this.Q!=this.Zt){hl.debug("Determining font size for DBCS="+this.Zt);var c=this.Xt(e,r,this.Zt,"M"),f=this.Xt(e,r,this.Zt,"䭺");hl.debug("SBCS box="+JSON.stringify(l)+" dbcsBox="+JSON.stringify(c)+" testSymbolBox="+JSON.stringify(f))}},Wl.prototype.te=function(t,e,l,n){var i;for(i=0;i<n;i++)t[i]=32,e[i]=0,l[i]=0},Wl.prototype.ee=function(t,e,l){for(var n=e;n<l;n++)if(t[n]>32)return n;return-1},Wl.prototype.le=function(t,e,l,n,i,s){for(var r=n+1,h=t[n],u=s?s[n]:null,o=e[n];r<i&&(h==xl?t[r]==xl:h==t[r])&&o==e[r]&&(!s||u==s[r]);)r++;return r-n},Wl.prototype.clear=function(){let t=this.B;var e=t.H.getContext("2d"),l=t.H.width,n=t.H.height;rl.debug("Renderer.clear pxWidth="+l+" pxHeight="+n+" inactive=4210752"),Ol(e,this.mt),e.fillRect(0,0,this.it,this.nt)},Wl.prototype.$t=function(){this.B.H.getContext("2d").setTransform(1,0,0,1,0,0),this.et=1,this.lt=1,this.J=-1},Wl.prototype.ne=function(t,e){return this.B.H,this.B,1==this.scaleMethod&&(t*=this.et,e*=this.lt),t>=this.it||e>=this.nt?null:{ie:Math.floor(e/this.rt),se:Math.floor(t/this.st)}},Wl.prototype.re=function(){var t=this.B;let e=t.H;var l=this.Yt;l.font=this.font,Ol(l,255,255,255,0),l.clearRect(0,0,e.width,e.height),l.clearRect(0,0,this.it,this.nt),!0===this.pt&&(this.ft!=cl||0==this.wt||1==this.dt)&&this.ft>0&&this.he(l,t.ue),null!=t.oe&&null!=t.ae&&null!=t.ce&&null!=t.fe&&this.we(t.oe,t.ae,t.fe,t.ce),1==t.oiaEnabled&&this.de(l,t)},Wl.prototype.de=function(t,e){let l=e.H;var n=t.lineWidth;t.beginPath(),Ul(t,this.kt),t.lineWidth=5*this.lt;var i=l.height*this.lt+-1.5*this.rt;t.moveTo(0,i),t.lineTo(this.it,i);var s=e.pe();Ol(t,this.kt);var r=l.height*this.lt+-.25*this.rt;zl(t,s,0,e.width,0,r),t.closePath(),t.stroke(),t.lineWidth=n},Wl.prototype.we=function(t,e,l,n){if(t!=l&&e!=n){var i=Math.min(t,l),s=Math.max(t,l),r=Math.min(e,n),h=Math.max(e,n),u=this.B,o=u.be.getContext("2d");o.beginPath(),this.ve(i,r,s,h,o,u.H.getContext("2d")),o.closePath()}},Wl.prototype.me=function(){clearTimeout(this.gt),1!=this.dt&&(this.dt=!0,this.re()),this.ft==cl&&this.wt>=fl&&0!=fl&&this.St()},Wl.prototype.St=function(){var t=this;this.gt=setInterval(function(){t.dt=!t.dt,!0===t.pt&&t.re()},this.wt)},Wl.prototype.ke=function(){clearTimeout(this.Ct),1!=this.Ae&&(this.Ae=!0,this.zt()),this.Et>=fl&&0!=fl&&this.Bt()},Wl.prototype.Bt=function(){var t=this;this.Ct=setInterval(function(){t.Ht&&(t.Ae=!t.Ae,t.zt())},this.Et)},Wl.prototype.he=function(t,l){if(-1!==l){var n=this.B,i=this.rt,s=this.st,r=this.B.ge?.2:1;if(0!=n.width){var h=Math.floor(l/n.width)+1,u=l%n.width;rl.debug("show cursor pos="+l+" at row="+h+" column="+u),t.beginPath(),Ol(t,this.At),1==this.ft?(Ul(t,this.At),t.moveTo(u*s,(h-r)*i),t.lineTo((1+u)*s,(h-r)*i),t.lineTo((1+u)*s,h*i),t.lineTo(u*s,h*i),t.lineTo(u*s,(h-r)*i),t.closePath(),t.stroke()):(this.ve(u,h-r,1+u,h,t,n.H.getContext("2d")),t.closePath())}else e.info("CANNOT SHOW CURSOR screen.width==0\n")}},Wl.prototype.ve=function(t,e,l,n,i,s){for(var r=this.rt,h=this.st,u=t*h,o=e*r,a=l*h,c=n*r,f=1==this.scaleMethod?u/this.et:u,w=1==this.scaleMethod?o/this.lt:o,d=1==this.scaleMethod?a/this.et:a,p=1==this.scaleMethod?c/this.lt:c,b=Math.abs(f-d),v=Math.abs(w-p),m=s.getImageData(f,w,b,v),k=0;k<m.data.length;k+=4)m.data[k]=255-m.data[k],m.data[k+1]=255-m.data[k+1],m.data[k+2]=255-m.data[k+2],m.data[k+3]=255;i.putImageData(m,f,w)},Wl.prototype.zt=function(){pn("fullPaint")},Wl.prototype.Ce=function(){e.debug("Renderer resize completed")},Be(Gl,Wl,[Gl.zt]),Gl.Se=32,Gl.Te=32,Gl.prototype.ye=function(t,e,l,n){var i=this.B,s=!1;rl.debug("Determining which rows to redraw. Include neighbors="+n);var r=i.Ee;if(null==r)rl.debug("Viewport top is null, not redrawing any rows"),e.fill(!0);else{for(let t=0;t<i.height;t++){if(!r){e.fill(!0,t);break}r.Fe&&(s=!0),l[t]==r.id&&!0!==r.xe||(e[t]=!0,n&&(t>0&&(e[t-1]=!0),t<i.height-1&&(e[t+1]=!0))),r.xe=!1,l[t]=r.id,r=r.M}r=i.Ee,rl.debug("Row redraw calculation result="+JSON.stringify(e))}this.Ht!=s&&(this.Ae=!0,this.Ht=s,e.fill(!0))},Gl.prototype.Me=function(){void 0!=this.Pe&&null!=this.Pe||(this.yt=this.ft),this.ft=0},Gl.prototype.Ne=function(){this.ft=this.yt},Gl.prototype.Re=function(){void 0!=this.Pe&&null!=this.Pe||(this.Pe=this.wt),this.wt=0},Gl.prototype.De=function(){this.wt=this.Pe,this.Pe=null},Gl.prototype.Ie=function(t,e){var l=this.B.height,n=null;let i=this.rt,s=this.it;Ol(t,this.Mt),rl.debug("Clearing updated rows by drawing with color="+this.Mt);var r=e.entries();for(let e of r)!0===e[1]?null==n&&(n=e[0]):null!=n&&(t.fillRect(0,i*n,s,i*(e[0]-n)),n=null);null!=n&&t.fillRect(0,i*n,s,i*(l+1-n))},Gl.Le=function(t,e,l){var n=t-l+33,i=t-l+161;switch(e){case ri._e:return n;case ri.Oe:switch(rl.log(rl.FINER,"Getting symbol in charset. code=0x"+Se(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+Se(n)+", iso8859-like=0x"+Se(i)),i){case 164:case 166:return Gl.Se;case 168:return 164;case 172:case 173:case 174:case 175:return Gl.Se;case 180:case 184:case 190:case 208:return Gl.Se;case 215:return 338;case 221:return 376;case 222:case 240:return Gl.Se;case 247:return 339;case 253:return 255;case 254:case 255:return Gl.Se;default:return i}case ri.Ue:if(rl.log(rl.FINER,"Getting symbol in charset. code=0x"+Se(t)+", charset=0x"+e+", codeShift=0x"+l+". shifted=0x"+Se(n)+", iso8859-like=0x"+Se(i)),n<95)return n;switch(n){case 95:return" ";case 96:return 9670;case 97:return 9618;case 98:return 9225;case 99:return 9228;case 100:return 9229;case 101:return 9226;case 102:return 176;case 103:return 177;case 104:return 9252;case 105:return 9227;case 106:return 9496;case 107:return 9488;case 108:return 9484;case 109:return 9492;case 110:return 9532;case 111:case 112:return 8254;case 113:return 9472;case 114:case 115:return 95;case 116:return 9500;case 117:return 9508;case 118:return 9524;case 119:return 9516;case 120:return 9474;case 121:return 8804;case 122:return 8805;case 123:return 960;case 124:return 8800;case 125:return 163;case 126:return 183;default:return rl.warn("No DEC graphic char for shifted code=0x"+Se(n))," "}default:return rl.warn("No lookup for gl.charset=0x"+Se(e))," "}},Gl.Ve=function(t,e){var l=t.He;return l<=32?32:l<127?Gl.Le(l,t.Be,33):l<=161?32:l<255?Gl.Le(l,t.ze,161):!0===e?l:(null!=l&&rl.warn("Failed to get glyph for code=0x"+Se(l)),32)};var $l=new Zn(32);Gl.prototype.Je=function(t,e,l,n,i,s,r,h){null==h&&(h=$l,n[s]=this.Pt,i[s]=this.Mt),e[s]=Gl.Ve(h,this.B.je);var u=h.We;if(0==(64&h.Ge)){switch(h.$e){case ri.Xe:0!=(16&h.Ge)?n[s]=this.Rt:n[s]=this.Pt;break;case ri.Ke:0!=(16&h.Ge)?n[s]=this.Ot[u]:n[s]=this.Lt[u];break;case ri.qe:0!=(16&h.Ge)?n[s]=this.Ut[u]:n[s]=this._t[u];break;case ri.Qe:n[s]=u}var o=h.Ye;switch(h.Ze){case ri.Xe:i[s]=this.Mt;break;case ri.Ke:i[s]=this.Lt[o];break;case ri.qe:i[s]=this._t[o];break;case ri.Qe:i[s]=o}}else ul.debug("Element is hidden, setting null color"),n[s]=null,i[s]=null;l[s]=h.Ge},Gl.prototype.tl=function(){if(!this.el){this.el=!0;var t=this.Mt;this.Mt=this.Pt,this.Pt=t,this.zt()}},Gl.prototype.ll=function(){if(this.el){this.el=!1;var t=this.Mt;this.Mt=this.Pt,this.Pt=t,this.zt()}},Gl.prototype.zt=function(){rl.debug("Full paint called, will clear entire screen");let t=this.B.H;this.B.parentDiv;var e=t.getContext("2d");Ol(e,this.Mt),e.fillRect(0,0,t.width,t.height),this.B.nl.fill(null),this.il()};var Xl=!0,Kl=!0;Gl.prototype.il=function(t){let e=this.B.H;var l=e.width,n=e.height,i=e.getContext("2d",{alpha:!1});if(this.Yt=this.B.be.getContext("2d"),-1!=this.J&&this.J==l&&this.W==n||(this.Qt(e,i),this.Qt(this.B.be,this.Yt),this.J=l,this.W=n),this.tt)return;i.font=this.font,i.textBaseline="top",Ol(i,this.Pt);var s=this.B,r=Number(s.width),h=new Array(r),u=new Array(r),o=new Array(r),a=new Array(r);let c=0;var f=0,w=s.nl,d=new Array(Number(t>0?t:s.height));Kl?this.ye(i,d,w,Xl):d.fill(!0),window.requestAnimationFrame(()=>{this.Ie(i,d);for(var t=s.Ee,l=0,n=e.height/s.height,w=0;w<s.height;w++)if(d[w]){var p;for(l++,null!==t&&void 0!==t&&"function"==typeof this.sl&&this.sl(t,w,n),w<3&&rl.debug("startLine, baseline = "+c+" screenOffset="+f+" size="+s.size),this.te(h,a,u,r),p=0;p<r;p++)this.Je(w,h,a,u,o,p,r,null!=t?t.rl[p]:null);var b=0;for(p=0;p<r;){var v=this.le(u,a,w,p,r,o);if(null!=u[p]){var m=a[p];if(Ol(i,u[p]),Ul(i,u[p]),i.lineWidth=1.5,rl.debug("Run starts at ("+p+","+w+"). Length="+v+", Attr=0x"+Se(m)+", FG="+u[p]+", BG="+o[p]),0!=(128&m)?(rl.debug("Transforming canvas for double width"),i.save(),i.hl(2,0,0,1,0,0)):0!=(256&m)&&(rl.debug("Transforming canvas for double height (top)"),i.save(),i.hl(2,0,0,2,0,-Math.round(this.nt/this.B.height)*w)),0==(512&m)){var k=0!=(2&m);if(k?(1==this.Vt&&(0!=(16&m)?(Ol(i,this.Dt),Ul(i,this.Dt)):(Ol(i,this.Ft),Ul(i,this.Ft))),i.fillRect(b,c,v*this.st,this.rt),1==this.Vt?Ol(i,0!=(16&m)?this.It:this.xt):Ol(i,o[p])):o[p]!=this.Mt&&(Ol(i,o[p]),i.fillRect(b,c,v*this.st,this.rt),Ol(i,u[p])),0!=(1&m)?this.ul(i,h,p,v,b,c,k):(0==(8&m)||this.Ae)&&zl(i,h,p,v,b,c),0!=(4&m)){var A=c+(this.rt-1);Jl(i,b,A,b+v*this.st,A)}k&&Ol(i,u[p])}0==(128&m)&&0==(256&m)&&0==(512&m)||i.restore()}else-1!=this.ee(h,p,v)&&rl.debug("Skipping render for null/invisible color at ("+p+","+w+")");p+=v,b+=v*this.st}f+=s.width,c+=this.rt,null!=t&&(t=t.M)}else{if(rl.debug("Skipping unmodified row="+w),f+=s.width,c+=this.rt,null==t)break;t=t.M}rl.debug("Drew "+l+" rows");let g=s.ol();s.ue=-1==g?g:s.width*g+s.al,this.re()})},Gl.prototype.cl=function(t){let e=this.B;if(e.fl<1||e.wl===e.height)return;let l=this.rt,n=e.fl*l,i=(e.height,1==this.scaleMethod?n/this.lt:n),s=t.getImageData(0,i,this.it,this.nt-i);t.putImageData(s,0,0),e.fl=0},Gl.prototype.dl=function(t){for(var e=0,l=0;l<t.length;l++)e=e<<4|parseInt(t[l],16);return e};var ql=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.keyboard"),Ql=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.message"),Yl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.protocol"),Zl=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.telnet"),tn=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.event"),en=window.COM_RS_COMMON_LOGGER.makeComponentLogger("com.rs.tecore.parse");const ln=0,nn=1,sn=2,rn=3,hn=80,un=24,on={pl:0,bl:1},an="Input",cn="Hotspots",fn="hotspotButton",wn=200,dn=200;function pn(t){alert(t+": You are in the superclass!")}function bn(){}var vn,mn=function(t){return new RegExp("[a-zA-Z]").test(t.charAt(0))};function kn(t,e){this.vl=new Array(e||lt),this.vl.fill(32)}function An(t,e){this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=1,this.width=t,this.height=e,this.ml=on.pl,this.kl=new kn(this),this.Al=new Array(this.height*this.width),this.Tt=null,this.gl=hn,this.Cl=un,this.Sl=[],this.Tl=null,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.Ml,this.Pl=null,this.Nl=null,this.Rl=new Array,this.Dl=!1,this.Il=!1,this.Ll=!1,this._l=Pt,this.Ol=0}function gn(t,e){this.Ul,this.Vl=t,this.Hl,this.Bl,this.zl,this.Jl=e}function Cn(t){this.message=t,this.name="RuntimeException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function Sn(t){this.message=t,this.name="Exception",e.warn("Encountered exception:"+this.name+", msg:"+t)}function Tn(t){this.message=t,this.name="TerminalInputException",e.warn("Encountered exception:"+this.name+", msg:"+t)}function yn(t){this.message=t,this.name="UnsupportedOperationException",e.warn("Encountered exception:"+this.name+", msg:"+t)}An.jl=function(t,parentDiv,l,n,i){e.debug(`make canvas w/ id=${t}, parentDiv=${parentDiv}, w,h=${l},${n}`);var s=document.createElement("canvas");s.id=t,s.style.zIndex=i,s.style.position="absolute",s.style.left="0px",s.style.top="0px";var r=l,h=n;return s.width=r,s.height=h,s.innerHTML="If you see this message, rather than a real drawing canvas, please upgrade to FireFox 1.5, Safari, or some other modern browser",parentDiv.appendChild(s),s},An.Wl=new Array(_.length),An.Wl.fill(!1),An.prototype.Gl=function(){let t=An.Wl.length;for(var e=0;e<t;e++)if(!An.Wl[e]){An.Wl[e]=!0,this.$l=_[e];break}this.$l||(this.$l=" "),this.Xl=this.$l},An.prototype.Kl=function(t){this.ql(4999,t.data,"Connection to host closed due to error.\nHost: "+this.Ql.host+"\nPort: "+this.Ql.port+"\nError:"+t.data)},An.prototype.Yl=function(t){this.ql(t.code,t.reason,"Connection to host closed.\nHost: "+this.Ql.host+"\nPort: "+this.Ql.port+"\nCode: "+t.code+"\nReason: "+t.reason)},An.prototype.ql=function(t,e,l){t!=this.Zl&&(tn.warn(l),alert(l)),this.closeConnection(t,e),this.Tl=null,this.tn=!1},An.prototype.isConnected=function(){return 2===this._l},An.prototype.disconnect=function(){e.info("Disconnected terminal with ID="+this.id),this.tn=!0,this.Dl=!0,this.closeConnection(4e3,"Terminal Closed"),this.Tt.zt()},An.prototype.closeConnection=function(t,e){this.Zl=t;var l=this.Tl;if(l)try{l.close(t,e)}catch(t){}if(this.clear(),!this.tn){var parentDiv=this.parentDiv?this.parentDiv:document.getElementById(this.H.id).parentNode;try{this.en(parentDiv);var n=parentDiv.id;this.callbacks&&this.callbacks.closeCallback&&this.callbacks.closeCallback(n)}catch(t){}this.$l&&" "!=this.$l&&(An.Wl[this.$l.charCodeAt(0)-65]=!1,this.$l=null)}},An.prototype.pe=function(){pn("getOIAArray")},An.prototype.ln=function(){pn("initScreen")},An.prototype.connect=function(t,e){pn("connect")},An.prototype.nn=function(t){pn("paste")},An.prototype.in=function(t){pn("copy")},An.prototype.sn=function(t,e,l,n,i,s){pn("getScreenContents")},An.prototype.rn=function(t){pn("setCursorPos")},An.prototype.hn=function(t){pn("modifyCursorPos")},An.prototype.un=function(t){pn("enterCharacterAtCursor")},An.prototype.clear=function(){pn("clear")},An.prototype.handleContainerResizeFromUI=function(parentDiv,t,e,l){null!==t&&void 0!==t&&(this.Ml=t.Ml,this.Rl=t.Rl),this.handleContainerResize(parentDiv,e,l)},An.prototype.bt=function(){var t=document.activeElement;return document.getElementById(this.H.id)==t||document.getElementById(this.be.id)==t||document.getElementById(this.on.id)==t},An.prototype.en=function(parentDiv){parentDiv.removeChild(this.on),parentDiv.removeChild(this.H),parentDiv.removeChild(this.be)},An.an=function(t){let e=document.createElement("textarea");e.id=t+"Input";let l=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),n=navigator.userAgent;return(l||-1!==n.indexOf("Android")||-1!==n.indexOf("iOS"))&&(e.readOnly=!0),e.style.position="relative",e.style.zIndex="3",e.style.bottom="0px",e.style.left="0px",e.style.opacity=0,e.style.width="100%",e.style.height="100%",e.style.cursor="default",e},An.prototype.handleContainerResize=function(parentDiv,t,l){e.info("handling resize"),clearTimeout(vn);var n=t||parentDiv.clientWidth,i=l||parentDiv.clientHeight;parentDiv.id,this.parentDiv=parentDiv,0!==i&&null!==i&&void 0!==i||(i=this.Ml.height),this.en(parentDiv),this.Tt&&this.Tt.clear(),e.info("resize w="+n+" h="+i),this.cn(parentDiv,{width:n,height:i}),this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Ml),this.Tt.zt(),this.Tt.Ce());var s=this;vn=setTimeout(function(){s.dn()},200)},An.prototype.pn=function(t,l,n){this.width=t,this.height=l,this.size=t*this.height,this.kl.vl=new Array(t||lt),this.kl.vl.fill(32),e.info("Resized canvas grid to r="+this.height+", c="+this.width+", size="+this.size),n||this.clear(),this.Tt&&(this.Tt.$t(),null!==this.Ml&&void 0!==this.Ml&&this.wn(this.Ml),this.Tt.zt())},An.prototype.bn=function(t){var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(ql.debug("keyup "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+Se(e)),ql.debug("keyup, modifier state starts at "+this.yl.toString(2)),"AltLeft"==l?this.yl^=1:"AltRight"==l&&(this.yl^=2),"Alt"==l)this.yl^=1;else if("ControlLeft"==l)this.yl^=4;else if("ControlRight"==l)this.yl^=8;else if("Control"==l)this.yl^=4;else if("OSLeft"==l||"Win"==l)this.yl^=16;else if("OSRight"==l)this.yl^=32;else if("ShiftLeft"==l)this.yl^=64;else if("ShiftRight"==l)this.yl^=128;else{if("Shift"!=l)return;this.yl^=64}t.stopPropagation(),t.preventDefault(),ql.debug("keyup, modifier state is now "+this.yl.toString(2))},An.prototype.vn=function(t,e){pn("handleKeyDown")},An.prototype.mn=function(t){-1===navigator.appName.indexOf("Safari")&&t.getModifierState&&(t.getModifierState("CapsLock")?this.yl|=256:this.yl&=-257)},An.prototype.kn=function(t,e){if(e.getModifierState)return this.yl=0,e.getModifierState("Control")&&(this.yl|=4),e.getModifierState("Alt")&&(this.yl|=1),e.getModifierState("Shift")&&(this.yl|=64),e.getModifierState("CapsLock")&&(this.yl|=256),(e.getModifierState("Meta")||e.getModifierState("OS")||e.getModifierState("Win"))&&(this.yl|=16),!0;if(2===t.type||8===t.type&&t.value.length>1){var l=t.value;if("CapsLock"==l)this.yl^=256;else if("AltLeft"==l)this.yl|=1;else if("AltRight"==l)this.yl|=2;else if("Alt"==l)this.yl|=1;else if("ControlLeft"==l)this.yl|=4;else if("ControlRight"==l)this.yl|=8;else if("Control"==l)this.yl|=4;else if("OSLeft"==l||"Win"==l)this.yl|=16;else if("OSRight"==l)this.yl|=32;else if("ShiftLeft"==l)this.yl|=64;else if("ShiftRight"==l)this.yl|=128;else{if("Shift"!=l)return!1;this.yl|=64}return!0}return!1},An.prototype.An=function(t){this.mn(t);var e=t.keyCode,l=t.key?t.key:t.keyIdentifier;if(this.kn(new nl(8,l),t),ql.debug("keydown "+t+" target="+t.target+" keyName='"+l+"' keyCode=0x"+Se(e)),ql.debug("keydown, modifier state starts at "+this.yl.toString(2)),l.startsWith("U+")&&6==l.length){if("U+0000"===l&&(this.Cn.gn||this.Cn.Sn))return;var n=parseInt(l.substring(2),16);n>=32&&n<127&&(l=String.fromCharCode(n))}var i=1==l.length&&mn(l);i&&(l=l.toLowerCase());var s=je[l];s&&(l=s),3!==t.location||"NumLock"==l||l.startsWith("Numpad")||(l="Numpad"+l);var r,h=this.Pl[l];if(h&&null!=h){var u=0;12&this.yl&&(u|=$e),3&this.yl&&(u|=Xe),192&this.yl&&(u|=Ge),256==this.yl&&i?u=Ge:u==Ge&&256&this.yl&&i&&(u=0),ql.debug("keydown modifier="+u),0===u&&(u=We);var o=h[u];o&&(r=o)}r?4===r.type&&(r=new nl(1,String.fromCharCode.apply(null,r.value))):r=new nl(8,l),this.Il&&"Reset"!==r.value||(ql.debug("keydown mapping result: type="+r.type+" value="+r.value),this.vn(r,t),ql.debug("keydown, modifier state is now "+this.yl.toString(2)))},An.prototype.Tn=function(t){if(t&&"string"==typeof t){var e=t.toLowerCase();document.execCommand(e)}},An.prototype.yn=function(t){pn("handleKeyCode")},An.prototype.En=function(t){t.keyCode,t.key?t.key:t.keyIdentifier;var e=t.charCode;this.Fn(e)},An.prototype.xn=function(t){var e=t.charCodeAt(0);this.Fn(e)},An.prototype.Fn=function(t){pn("handleCharCodeInput")},An.prototype.Mn=function(t,e){pn("autoType")},An.prototype.Pn=function(t){if(this.El){var e=this.Tt.ne(t.offsetX,t.offsetY);e.se+1<=this.width&&(this.fe=e.se+1),e.ie+1<=this.height&&(this.ce=e.ie+1),this.Tt.re()}},An.prototype.Nn=function(t){this.El=!1},An.prototype.Rn=function(t){if(!0===this.Fl)this.Fl=!1,clearTimeout(this.Dn);else{var e=this;this.Dn=setTimeout(function(){!0===e.El&&(e.Fl=!0)},200),this.El=!0;var l=this.Tt.ne(t.offsetX,t.offsetY);this.oe=l.se,this.ae=l.ie}},An.prototype.In=function(t,e,l,n){pn("handleClick")},An.prototype.Ln=function(t){var e=t.offsetX,l=t.offsetY;if(tn.debug("click "+t+", pos=("+e+","+l+")"),!1===this.Fl&&(this.oe=null,this.ae=null,this.fe=null,this.ce=null,this._n&&(this._n.style.display="none"),this.Tt)){var n=this.Tt.ne(e,l);if(tn.debug("click row,col = "+JSON.stringify(n)),null!=n){var i=n.ie*this.width+n.se;if("dblclick"==t.type){var s,r=this.Pl.On;if(r&&null!=r){var h=0;12&this.yl&&(h|=$e),3&this.yl&&(h|=Xe),192&this.yl&&(h|=Ge),256==this.yl?h=Ge:h==Ge&&256&this.yl&&(h=0),ql.debug("keydown modifier="+h),0===h&&(h=We);var u=r[h];u&&(s=u)}this.Un(e,l,n,i,s)}else this.In(e,l,n,i)}else tn.warn("rejecting mouse event, type="+t.type+" because rowColumn == null")}},An.prototype.Un=function(t){pn("handleDoubleClick"),tn.debug("dblclick "+t)},An.prototype.Vn=function(t){e.debug("Received connected message from server"),this._l=2},An.prototype.Hn=function(t){this.Tl.close(4001,"server sent close/error/exception message"),this.Il=!0},An.prototype.dn=function(){pn("handleResizeComplete")},An.prototype.Bn=function(t,e){return this.width*t+e},An.prototype.fn=function(){var t=this.be,e=this.on,l=this.zn,n=this;t.Jn=0,t.jn=!0;let i=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion),s=navigator.userAgent;var r=!1,h=!1;i&&(-1!==s.indexOf("Android")?r=!0:-1!==s.indexOf("iOS")&&(h=!0)),this.Cn={gn:r,Sn:h};var u,o=!1;n.Al.fill(null),document.addEventListener("copy",function(t){if((document.activeElement==e||document.activeElement==l)&&!n.Dl){tn.debug("Copy, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation();var i=n.in(!1,!0);null!=i&&t.clipboardData.setData("text/plain",i),t.preventDefault(),c()}}),document.addEventListener("paste",function(t){if((document.activeElement==e||document.activeElement==l)&&!n.Dl){tn.debug("Paste, box region start=("+this.oe+","+this.ae+"), end=("+this.fe+","+this.ce+")"),t.stopPropagation(),tn.debug("PASTE: Found types: "+JSON.stringify(t.clipboardData.types));let e=t.clipboardData.getData("text/plain");e&&1==n.nn(e)&&t.preventDefault(),c()}});var a=this;"Firefox"==navigator.appName&&parseInt(navigator.appVersion,10)<52?(e.addEventListener("blur",function(t){a.yl&=256,a.Tt&&(a.Tt.pt=!1,tn.info("Terminal focus lost"),a.Tt.re())}),e.addEventListener("focus",function(t){a.Tt&&(a.Tt.pt=!0,tn.info("Terminal gained focus"),a.Tt.re())})):(e.addEventListener("focusout",function(t){a.yl&=256,a.Tt&&(a.Tt.pt=!1,tn.info("Terminal focus lost"),a.Tt.re())}),e.addEventListener("focusin",function(t){a.Tt&&(a.Tt.pt=!0,tn.info("Terminal gained focus"),a.Tt.re())})),e.addEventListener("compositionstart",function(t){if(tn.debug("Compositionstart: "+JSON.stringify(t)),o=!0,!n.Dl){c();var l=Math.floor(n.ue/this.width),i=Math.floor(n.ue%this.width);e.style.top=l*(n.Tt.rt/n.Tt.lt)+"px",e.style.left=i*(n.Tt.st/n.Tt.et)+"px"}}),e.addEventListener("compositionupdate",function(t){tn.debug("Compositionupdate: data="+t.data),o=!0,n.Dl||(u=t.data,n.Al.fill(null),n.Wn(u))}),e.addEventListener("compositionend",function(t){tn.debug("Compositionend seen"),tn.debug("Compositionend: "+JSON.stringify(t)+", data="+t.data),o=!1,n.Dl||(n.Al.fill(null),u&&(n.Mn(u),e.value="",e.style.top="0px",e.style.left="0px"))}),e.addEventListener("unload",function(t){n.closeConnection()});var c=function(){n.Fl=!1;let t=n.on;t.value="",t.selectionEnd=0,t.selectionStart=0,n.oe=null,n.ae=null,n.fe=null,n.ce=null,n.Tt&&n.Tt.re()};e.addEventListener("wheel",function(t){n.Dl?(tn.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):n.Gn(t)}),e.addEventListener("keydown",function(t){n.Dl?(tn.debug("Script in progress: rejecting keydown"),t.stopPropagation(),t.preventDefault()):o||(e.value="",tn.debug("Keydown: "+JSON.stringify(t)),n.An(t))}),e.addEventListener("keyup",function(t){n.Dl?(tn.debug("Script in progress: rejecting keyup"),t.stopPropagation(),t.preventDefault()):n.Il?(tn.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):(c(),o||n.bn(t))}),e.addEventListener("keypress",function(t){n.Dl?(tn.debug("Script in progress: rejecting keypress"),t.stopPropagation(),t.preventDefault()):n.Il?(tn.debug("Screen locked by error occurrence"),t.stopPropagation(),t.preventDefault()):o||(e.value="",tn.debug("Keypress: "+JSON.stringify(t)),n.An(t),t.stopPropagation(),t.preventDefault())}),(r||h)&&e.addEventListener("input",function(){if(tn.debug("Input event seen. value="+e.value+", textContent="+e.textContent),n.Dl)tn.debug("Script in progress: rejecting input");else if(n.Il)tn.debug("Screen locked by error occurrence: rejecting input");else{c();var t=e.value;if(t){e.value="",tn.debug("Input was "+t),tn.debug("Textcontent is now "+e.value);for(var l=0;l<t.length;l++)n.xn(t.charAt(l))}tn.debug("Empty input event ignored.")}}),e.addEventListener("mouseup",function(t){n.Dl?tn.debug("Script in progress: rejecting mouseup"):(tn.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.Nn(t))}),e.addEventListener("mousedown",function(t){n.Dl?tn.debug("Script in progress: rejecting mousedown"):(tn.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.Rn(t))}),e.addEventListener("mouseenter",function(t){tn.log(tn.FINER,"mouse event "+t+" target="+t.target);let e=n.on;!o&&e&&e.value.length>0&&(e.value="",e.selectionEnd=0,e.selectionStart=0)}),e.addEventListener("mousemove",function(t){n.Dl?tn.log(tn.FINER,"Script in progress: rejecting mousemove"):(tn.log(tn.FINER,"mouse event "+t+" target="+t.target),t.target.focus(),n.Pn(t))}),t.addEventListener("click",function(t){n.Dl?(tn.debug("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),tn.debug("click event "+t+" target="+t.target),t.target.focus(),n.Ln(t))}),e.addEventListener("click",function(t){n.Dl?(tn.warn("Script in progress: rejecting click"),t.stopPropagation()):(t.stopPropagation(),tn.debug("click event "+t+" target="+t.target),t.target.focus(),n.Ln(t))}),e.addEventListener("dblclick",function(t){n.Dl?(tn.warn("Script in progress: rejecting dblclick"),t.stopPropagation()):n.Il?(tn.warn("Screen locked by error occurrence: rejecting dblclick"),t.stopPropagation()):(t.stopPropagation(),tn.debug("dblclick event "+t+" target="+t.target),!0===n.Fl&&(tn.debug("dblclick set drag to false"),n.Fl=!1,clearTimeout(n.Dn)),t.target.focus(),n.Ln(t))}),e.addEventListener("contextmenu",function(t){if(n.Fl=!1,n.El=!1,t.shiftKey){if(null!=n.oe&&null!=n.fe){let t=n.on;t&&(0==t.value.length&&(t.value="c"),t.select())}}else n.Dl?(tn.debug("Script in progress: rejecting contextmenu"),t.stopPropagation()):(t.stopPropagation(),tn.debug("mouse event "+t+" target="+t.target),t.target.focus(),n.$n(t))})},An.prototype.toString=function(){return"<VirtualScreen size="+this.size+">"},An.prototype.Xn=function(t){pn("processMessage")},An.prototype.Kn=function(){pn("getPos")},An.prototype.qn=function(){this.callbacks||(this.callbacks={}),this.callbacks.passwordPrompt||(this.callbacks.passwordPrompt=function(t){setTimeout(function(){let e=prompt("Script paused for password input. Enter password.");t(e)},100)})},An.prototype.cn=function(parentDiv,t){this.parentDiv=parentDiv;let e=parentDiv.id;var l=e+"Canvas";this.H=An.jl(l,parentDiv,t.width,t.height,1);var n=e+"SelectionCanvas";return this.be=An.jl(n,parentDiv,t.width,t.height,2),this.be.innerHTMLMessageLength=this.be.innerHTML.length,this.on=An.an(e),parentDiv.appendChild(this.on),{H:this.H,be:this.be,Qn:this.on}},gn.prototype.Yn=function(){if(this.Jl&&this.Hl.length>0){var t=xe(this.Hl),e={t:this.Jl,data:t};Ql.debug("sending telnet options, dump follows"),Te(this.Hl,Ql),null!=this.Vl.Tl&&this.Vl.Tl.send(JSON.stringify(e)),this.Hl=[]}},Be(ri,An,[ri.vn,ri.Fn,ri.yn,ri.In,ri.Un,ri.dn,ri.Mn,ri.pe,ri.ln,ri.Kn,ri.connect,ri.in,ri.nn,ri.en,ri.handleContainerResize]);var En=!1;const Fn=1,xn=2,Mn=-1,Pn=0,Nn=1,Rn=2,Dn=3,In=4,Ln=5,_n=6,On=7,Un=8,Vn=9,Hn=10,Bn=11,zn=12,Jn=13,jn=14,Wn=15,Gn=16,$n=17,Xn=18,Kn=19,qn=20,Qn=21,Yn=22;function Zn(t){this.Zn=65533,this.$e=ri.Xe,this.We=0,this.Ze=ri.Xe,this.Ye=0,this.Be=ri._e,this.ze=ri.Oe,this.He=t}function ti(parentDiv,t,e){this.scrollPos=0,this.ti(parentDiv,t,e)}Zn.prototype.ei=function(){return 65533!=this.Zn?65533:this.He},ti.prototype.li=function(t){let e=this.ni.scrollHeight-this.ni.clientHeight;-1==t||t>e?(this.scrollPos=e,this.ni.scrollTop=e):(this.scrollPos=t,this.ni.scrollTop=t)},ti.prototype.ii=function(){return this.ni},ti.prototype.si=function(parentDiv){if(this.ri||this.ni)try{this.ni.removeChild(this.ri),parentDiv.removeChild(this.ni),this.ri=null,this.ni=null}catch(t){e.severe("Could not remove scrolling div from parent="+parentDiv)}},ti.prototype.ti=function(parentDiv,t,e){this.ni=document.createElement("div"),this.ni.id=parentDiv.id+"scrollingDiv",this.ni.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   overflow-y: scroll;\n                                   width: ${t}; height: ${e};`,this.ni.style.zIndex=1,this.hi=e,this.ui=e,this.ri=document.createElement("div"),this.ri.id=this.ni.id+"Inner",this.ri.style.cssText="position: absolute; top: 0px; left: 0px; opacity: 0; cursor: default;\n                                   width: 90%;",this.ri.style.height=e+"px",this.ri.style.zIndex=1,this.ni.appendChild(this.ri)},ti.prototype.pn=function(t,e){this.ni.style.width=t,this.ni.style.height=e,this.ni.style["overflow-y"]="scroll",this.ri.style.width="90%";let l=this.ui/this.hi*e;this.ri.style.height=l,this.hi=e,this.ui=l},ti.prototype.oi=function(){return this.scrollPos},ti.prototype.Kn=function(){return this.ni.scrollTop},ti.prototype.ai=function(){this.scrollPos=this.ni.scrollTop},ti.prototype.ci=function(t){return t/this.fi},ti.prototype.wi=function(t,e){let l=t*e;this.fi=t,this.ri.style.height=l+"px",this.ui=l,this.ai()};var ei=0;function li(t,e){this.rl=new Array(t),this.xe=!0,void 0==e&&(this.id=ei++)}var ni=function(t,e){t||(t={fontProperties:{scaleMethod:2}});var l=t.fontProperties.size?t.fontProperties.size:Wl.K,n=t.fontProperties.di?t.fontProperties.di:Wl.jt,i=t.fontProperties.style?t.fontProperties.style:Wl.Wt,s=t.fontProperties.name?t.fontProperties.name:Wl.Q,r=e.getContext("2d");r.font=i+" "+n+" "+l+"px "+s;var h=l,u=r.measureText("M").width,o=Math.floor(e.width/u);return{ie:Math.floor(e.height/h),se:o}},ii=function(t){var l="--------------------------------------------------------------------------------";t&&t.debug?t.debug(l):e.debug(l)},si=function(t,e){var l=e;return t.length>0&&(l=Number(t)),l<e&&(l=e),l};function ri(t,l,n,i){this._l=Pt,this.H=null,this.be=null,this.parentDiv=null,this.oiaEnabled=0,this.width=t,this.height=l,this.ml=on.pl,this.kl=new kn(this,this.width),this.Al=new Array(this.height*t),this.Tt=null,this.gl=t,this.Cl=l,this.Sl=[],this.Tl=null,this.ri=i,this.yl=0,this.ae=null,this.oe=null,this.ce=null,this.fe=null,this.El=!1,this.Fl=!1,this.xl="rgb(255,255,255)",this.size=t*l,this.pi=new Array(this.size),this.clear(),this.ue=0,this.bi=0,this.Z=ri.Y,e.debug("charsetInfo = "+this.Z),this.vi=n-l,this.wl=n,this.mi=0,this.al=0,this.ki=[],this.Ee=null,this.Ai=null,this.gi=null,this.Ci=0,this.Si=0,this.Ti=null,this.yi=null,this.Ei=null,this.Fi=!0,this.xi=!1,this.Mi=!1,this.Pl=sl,this.Ge=0,this.$e=ri.Xe,this.We=0,this.Ze=ri.Xe,this.Ye=0,this.Pi=!1,this.Ni=!1,this.Ri=0,this.Di=0,this.Ii=!1,this.Li=[ri._e,ri.Oe,ri.Ue,ri._i],this.Oi=0,this.Ui=1,this.Vi=0,this.termType=Bt,this.Hi=!1,this.Bi=null,this.zi=null,this.Gl(),this.nl=new Array(this.height),this.fl=0,this.Ji=!1,this.ji=xn,this.Wi=!1,this.Gi=!1,this.$i=!1,this.Xi=0,this.je=!0,this.Ki=_t,this.qi=pe,this.Qi=0,this.Yi=0,this.Zi=ri.ts(),this.es=we,this.Il=!1,this.Ol=0,this.ls=!1}ri.ts=function(){return[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]},ri.Xe=0,ri.Ke=1,ri.qe=2,ri.Qe=3,ri._e=66,ri.Oe=60,ri.Ue=48,ri._i=65,ri.ns=function(t){if(t)return{t:"VT_INPUT",data:xe(t)}},ri.ss=function(t,e,l){for(var n,i=t,s=e;s<l.rl.length;s++)n=l.rl[s],l.rl[s]=i,i=n},ri.rs=function(t){return t.push(27),t.push(91),t.push(56),t.push(109),t},ri.hs=function(t){return t.push(27),t.push(91),t.push(48),t.push(109),t},ri.us=function(t){switch(t.termType){case Bt:t.os=ce;break;default:t.os=ae}},ri.as=function(t){switch(t.termType){case Bt:t.termTypeString="linux";break;case 2:t.termTypeString="vt220";break;case 0:t.termTypeString="vt320";break;case 3:t.termTypeString="vt420"}},ri.cs=function(t,e,l,n){var i=t.fontProperties.size?t.fontProperties.size:Wl.K,s=t.fontProperties.di?t.fontProperties.di:Wl.jt,r=t.fontProperties.style?t.fontProperties.style:Wl.Wt,h=t.fontProperties.name?t.fontProperties.name:Wl.Q;let u=An.jl(e.id+"tempSizeCalc",e,l,n,0);var o=u.getContext("2d");o.font=r+" "+s+" "+i+"px "+h;var a=i,c=o.measureText("M").width;let f=Math.floor(u.width/c),w=Math.floor(u.height/a);return e.removeChild(u),{width:f,height:w}},ri.fs=function(parentDiv,t,e){let l=document.createElement("div");return l.id=parentDiv.id+"innerScrolling",l.style.cssText=`position: absolute; top: 0px; left: 0px; opacity: 255; cursor: default;\n                             width: ${t}; height: ${e};`,l.style.zIndex=2,l},ri.prototype.en=function(parentDiv){this.ws?(this.ws.si(parentDiv),this.ri.removeChild(this.on),this.ri.removeChild(this.H),this.ri.removeChild(this.be),parentDiv.removeChild(this.ri)):(parentDiv.removeChild(this.on),parentDiv.removeChild(this.H),parentDiv.removeChild(this.be))},ri.prototype.ds=function(){var t=0,l=!1;this.ws.ii().addEventListener("wheel",t=>{this.Gn(t)}),this.ws.ii().addEventListener("scroll",n=>{if(this.Tt)if(l)n.preventDefault();else{this.ps=-1,l=!0;try{let i=n.target,s=this.ws,r=i.scrollHeight,h=i.scrollTop,u=s.oi(),o=u-h;if(o>0&&this.Ee.id===this.Ti.id)return e.warn("Could not scroll; already at top."),void(i.scrollTop=u);let a=s.ci(o),c=a%1;t*c<0&&(t=0);let f=(t+=c)>0?Math.floor(t):Math.ceil(t),w=(a>0?Math.floor(a):Math.ceil(a))+f;t-=f,tn.debug(`Scroll Info: scrollDivHeight=${r}, topOfScrollViewport=${h}, lastPos=${u}, rawDiff=${o}, lineDiff=${a}, remainder =${c}, scrollLeftover= ${t}, scrollRollover =${f}, scrollTotal= ${w}`),w&&(w>0?(h<s.fi&&(w=-1),this.bs(w)):(r-i.clientHeight-h<2*s.fi&&(w=1),this.vs(w)),s.ai())}catch(n){console.log(n.stack?n.stack:n.message)}finally{l=!1}}})},ri.prototype.handleContainerResize=function(parentDiv,t,l){e.info("handling resize"),clearTimeout(vn);var n=t||parentDiv.clientWidth,i=l||parentDiv.clientHeight;if(0!==i&&null!==i&&void 0!==i||(i=this.Ml.height),null==this.ms&&(this.ms=this.ws?this.ws.Kn():0),this.en(parentDiv),this.Tt&&this.Tt.clear(),e.info("resize w="+n+" h="+i),this.ks){let t=this.ws;t.ti(parentDiv,n,i),n-=20;let e=ri.fs(parentDiv,n,i);this.ri=e,parentDiv.appendChild(t.ii()),parentDiv.appendChild(e),this.cn(e,{width:n,height:i}),this.parentDiv=parentDiv,e.style.position="absolute",this.ds()}else this.cn(parentDiv,{width:n,height:i});this.fn(),this.Tt&&(this.Tt.H=this.H,this.Tt.$t(),this.wn(this.Ml),this.Tt.zt(),this.Tt.Ce()),this.ks&&(this.ws.ii().style.opacity="255"),this.ws&&(this.ws.wi(this.As(),this.wl),this.ws.li(this.ms),this.ms=null);var s=this;vn=setTimeout(function(){s.dn()},200)},ri.prototype.$n=function(t){t.preventDefault()},ri.prototype.ol=function(){if(!this.Ee||!this.gi)return-1;let t=this.height,e=this.Ee,l=this.gi.id;for(let n=0;n<t;n++){if(!e)return-1;if(e.id===l)return n;e=e.M}return-1},ri.prototype.gs=function(){return 1},ri.prototype.connect=function(t,e){if(this._l===Pt){this._l=1;let i=this;var l=new WebSocket(t);i.Tl=l,l.onopen=function(){if(e.host&&e.port){var t={t:"CONFIG",host:e.host,port:Number(e.port)};1===e.security?t.security={t:"ssh",termt:i.termTypeString,termr:i.height,termc:i.width,badCert:e.Cs}:2===e.security?(Ql.warn("We dont support TLS yet. Try SSH!"),l.close()):0!=e.security&&(Ql.info("Unknown security type requested!"),l.close()),l.send(JSON.stringify(t)),Ql.debug("Sent "+JSON.stringify(t))}};var n=!1;l.onmessage=function(t){var e=JSON.parse(t.data);if(Ql.log(Ql.FINER,"ws.onMessage "+JSON.stringify(e)),null!=i.Tt){var l=9;i.kl.vl[l++]=88,i.kl.vl[l++]=ft[0],i.kl.vl[l++]=ft[1],i.kl.vl[l++]=ft[2],i.Tt.re()}i.Xn(e),n||(n=!0,i.callbacks&&i.callbacks.readyCallback&&i.callbacks.readyCallback.apply(this,null))},l.onerror=function(t){i.Kl(t),l=null},l.onclose=function(t){i.callbacks&&i.callbacks.unexpectedCloseConnectionHook?i.callbacks.unexpectedCloseConnectionHook(i,t):(i.Yl(t),l=null)}}},ri.prototype.pe=function(){var t,e=this.kl.vl,l=this.al+1,n=(this.Ss()+1).toString(),i=l.toString(),s=76;e[s--]=47;for(let l=2;l>-1;l--)n.length<l?e[s--]=32:(t=n.charAt(l))&&(e[s--]=t.charCodeAt(0));s=79;for(let l=2;l>-1;l--)i.length<l+1?e[s--]=32:(t=i.charAt(l))&&(e[s--]=t.charCodeAt(0));return this.ml==on.pl&&0!=this.Ql.security&&(e[3]=43),e},ri.prototype.Gn=function(t){if(t.deltaY&&this.ws){let l=this.ws,n=l.ii().scrollHeight,i=l.ii().scrollTop,s=l.oi(),r=-t.deltaY;if(r>0&&this.Ee.id===this.Ti.id||0==i)return e.warn("Could not scroll; already at top."),void(l.ii().scrollTop=s);let h=l.ci(r);tn.debug(`Wheel Info: scrollDivHeight=${n}, topOfScrollViewport=${i}, lastPos=${s}, rawDiff=${r}, lineDiff=${h}`),h&&(h>0?this.bs(h):this.vs(h)),l.li(l.Kn()-r)}},ri.prototype.Un=function(t,e,l,n){tn.debug("VT double click")},ri.prototype.Ts=function(t){let e=t.ys;e&&(e.M=t.M),t.M.ys=e,t.id==this.Ti.id&&(this.Ti=this.Ti.M),t.id==this.Ai.id&&(this.Ai=this.Ai.M)},ri.prototype.Es=function(t,e,l,n,i){let s=null!=this.Bi?this.Fs(this.Bi):null;for(var r=t+l>this.height?this.height-1-l:t,h=this.Fs(n),u=0;u<r;u++){if(null!=h){var o=new li(this.width);h.M?h.M.ys=o:h.id===this.yi.id&&(this.yi=o),o.ys=h,o.M=h.M,h.M=o,h=o}var a;e.M?a=e.M:(a=new li(this.width),e.M=a,a.ys=e,this.xs(!0)),e.id!=this.Ai.id||e.id==this.Ai.id&&s.id==this.Ai.id?this.Ts(e):e.id==this.Ai.id&&(this.wl<=this.height||this.Si>=this.wl?this.Ai.id==this.Ti.id?this.Ts(this.Ai):(this.Ts(this.Ti),this.Ai=this.Ai.M):(this.Ai=this.Ai.M,this.xs(!1))),e=a,i&&(this.gi=e)}},ri.prototype.Ms=function(t){this.Si--,t&&this.Ci--},ri.prototype.xs=function(t){this.Si++,t&&this.Ci++},ri.prototype.Ps=function(t,e,l,n,i){for(var s=t+l>this.height?this.height-1-l:t,r=this.Fs(n),h=0;h<s;h++){r.id===this.yi.id&&(this.yi=r.ys),r.ys.M=r.M,r=r.ys;var u=new li(this.width);e.ys?e.ys.M=u:this.Ti=u,this.Ai.id==e.id&&(this.Ai=u,this.Ee=this.Ai),u.ys=e.ys,u.M=e,e.ys=u,e=u,i&&(this.gi=u)}},ri.prototype.sn=function(t,e,l,n,i,s,r,h){var u=[],o=this.Ee;let a=-1!==navigator.userAgent.indexOf("Windows");for(var c=0;c<l;c++){if(!o)return"";o=o.M}for(var f=l;f<n;f++){r||f==l||(a&&u.push(13),u.push(10));var w=e,d=t;h&&f!=n-1&&(w=this.width),h&&f!=l&&(d=0);for(var p=d;p<w;p++)if(null!=o){var b=o.rl[p];if(b&&0!=(64&b.Ge))u.push(32);else if(b||!0!==s){var v=b.He;(!v||v<32)&&!0===s?u.push(32):u.push(v)}else u.push(32)}else u.push(32);o&&(o=o.M)}return String.fromCharCode.apply(null,u)},ri.prototype.in=function(t,e,l){if(null!=this.oe&&null!=this.fe){var n=Math.min(this.oe,this.fe),i=Math.max(this.oe,this.fe),s=Math.min(this.ae,this.ce),r=Math.max(this.ae,this.ce);return this.sn(n,i,s,r,t,e,l)}return null},ri.prototype.nn=function(t){if(this.gi&&t){for(var e=[],l=0;l<t.length;l++)e.push(t.charCodeAt(l));return this.Ns(e),!0}return!1},ri.prototype.Rs=function(){var t=(65280&this.width)>>8,e=255&this.width,l=(65280&this.height)>>8,n=255&this.height;this.Ds(31,[t,e,l,n])},ri.prototype.Is=function(){var t={t:"SSH_CH_REQ",reqt:"window-change",reply:!1,data:[this.width,this.height,this.H.width,this.H.height]};1===this.Tl.readyState&&this.Tl.send(JSON.stringify(t))},ri.prototype.dn=function(){if(tn.debug("Resize completed"),this.Hi){var t=ni(this.Ml,this.be),e=!1;t.ie<this.height&&(tn.debug("Resizing, old height was "+this.height+", new height will be "+t.ie),e=!0),this.ks?this.wl=this.vi+t.ie:this.wl=t.ie,this.pn(t.se,t.ie,!0),this.Ai&&tn.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ai.id),this.vs(1),this.Ee=this.Ai,this.Ai&&tn.debug("Scroll complete. Top ID="+this.Ai.id),this.ks&&(this.ws.ii().scrollTop=this.ws.ii().scrollHeight,this.ws.scrollPos=this.ws.ii().scrollTop),1!=this.Ql.security?this.Rs():this.Is(),e&&this.Ee&&(tn.debug("After resize, scrolling viewport to bottom. Top ID="+this.Ee.id),this.vs(1),tn.debug("Scroll complete. Top ID="+this.Ee.id))}},ri.prototype.In=function(t,e,l,n){tn.debug("VT click encountered")},ri.prototype.wn=function(t){null!==t&&void 0!==t&&this.Tt.Gt(this.Ml.fontProperties),this.Tt.zt()},ri.prototype.Ls=function(t){return!this.Ti||(null==t&&(t=this.Ss()),this.gi.id==this.yi.id||this._s&&t==this.zi)},ri.prototype.Os=function(){return!this.Ti||this.gi.id==this.Ti.id},ri.prototype.Us=function(t){Yl.log(Yl.FINEST,"Addline entry. IL ID="+(null==this.gi?null:this.gi.id)+", TT ID="+(null==this.Ai?null:this.Ai.id)+", Buff lines="+this.Si);var e=new li(this.width);return null==this.Ti?(this.Ti=e,this.yi=e,this.Ai=e,this.Ee=e,this.gi=null,this.Xi=0,this.xs(!0)):(this.Si>=this.wl&&!t?1===this.wl?(this.Ti=e,this.yi=e,this.Ai=e,this.Ee=this.Ai):2===this.wl?(this.Ti=this.Ti.M,this.Ti.ys=null,this.Ti.M=e,e.ys=this.Ti,this.Ai=this.Ti,this.Ee=this.Ai,this.yi=e):this.wl<=this.height?(this.Ti=this.Ti.M,this.Ai=this.Ti,this.Ee=this.Ai,this.Ti.ys=null,this.yi.M=e,e.ys=this.yi,this.yi=e):(this.Ti=this.Ti.M,this.Ti.ys=null,this.yi.M=e,e.ys=this.yi,this.yi=e,this.Ai=this.Ai.M,this.Ee=this.Ee.M):(e.ys=this.yi,this.yi.M=e,this.yi=e,this.Ci>=this.height?(this.Ai=this.Ai.M,this.Ee=this.Ai,this.xs(!1)):this.xs(!0)),this.Xi++,this.Xi++),this.gi=e,this.al=0,Yl.log(Yl.FINEST,"-- Addline exit. IL ID="+this.gi.id+", TT ID="+this.Ai.id+", Buff lines="+this.Si),e},ri.prototype.Vs=function(t){var e="";if(void 0!==t.rl)for(var l=0;l<t.rl.length;l++)if(null!==t.rl[l]&&void 0!==t.rl[l]){var n=String.fromCharCode(t.rl[l].He);e+=null===n||" "===n?" ":n}else e+=" ";return e},ri.prototype.ln=function(t){this.al=0,t?(this.Ai=null,this.Ee=null,this.gi=null,this.Ci=0,this.Si=0,this.Ti=null,this.yi=null,this.fl=0):(this.gi=this.yi,this.Ai=this.gi,this.Ee=this.Ai,this.Ci=1)},ri.prototype.yn=function(t){tn.debug("Handlekeycode hit")},ri.prototype.Fn=function(t){ql.debug("keypress, charCode="+t),160==t&&(t=32),t>=32&&t<127?(ql.debug("normal press code=0x"+Se(t)),this.Ns([t])):(ql.debug("Unhandled key press 0x"+Se(t)),bn())},ri.prototype.clear=function(){this.ln(!0),Yl.debug("Clear: should have cleared screen")},ri.prototype.Ns=function(t){if(this.Wi&&t){var e={t:"TELNET_DATA",B64:xe(t)};Ql.debug("Sending local echo message"),this.Xn(e)}this.qi===pe&&this.Hs(t)},ri.prototype.Mn=function(t,l){var n=l?t.substring(0,l):t,i=[];for(let t=0;t<n.length;t++){var s=n.charCodeAt(t);if(!(s>=32&&s<127))return e.info("Invaid ASCII input="+n.charAt(t)),!1;i.push(s)}return i.length>0?(this.Ns(i),!0):(e.info("0 length bufer found for autotype"),!0)},ri.prototype.Bs=function(t){ql.debug("keypress, name="+t);var e=oe[t][!0===this.ls?1:0];e?this.Ns(e):(ql.debug("Unhandled key press for "+t),bn())},ri.prototype.vn=function(t,e){if(this.Ji)ql.warn("Keyboard Locked: Cannot accept input at this time");else{if(e.keyCode,8===t.type&&3&this.yl&&1===t.value.length){var l=t.value.charCodeAt(0);ql.debug("Executing alt keypress for keycode="+l);var n=[27,l];this.Ns(n)}else if(2===t.type||8===t.type){let l=t.value;if(3===e.location)this.Bs(l);else{if(1!=l.length)return;this.Fn(l.charCodeAt(0))}}else{if(64!==t.type)return;this.zs(t.value)}e.stopPropagation(),e.preventDefault()}},ri.prototype.Js=function(t){return{js:Math.floor(t/this.width),Ws:Math.floor(t%this.width)}},ri.prototype.Gs=function(t){Ql.debug("---------------TELNET_DATA hex dump----------------"),Te(t,Ql),Ql.debug("---------------TELNET_DATA ascii dump--------------"),Ql.debug(String.fromCharCode.apply(null,t)),Ql.debug("---------------TELNET_DATA dump end----------------"),this.Ei||(this.Ei=new hi(this,"VT_INPUT"));var e=this.Ei,l=t.entries();this.Ee&&this.Ai&&this.Ee.id!=this.Ai.id&&(this.ks&&(this.ws.ii().scrollTop=this.ws.ii().scrollHeight),this.vs(1),this.Ee=this.Ai);for(let t of l){let l=t[1];e.$s(l)}e.Yn();let n=Date.now(),i=0;this.Xs&&n-this.Xs<5&&(i=5,this.Xs&&this.Xs-n<3&&(i=3),clearTimeout(this.Ks)),this.Xs=n,this.Ks=setTimeout(()=>{this.qs()},i)},ri.prototype.Xn=function(t){Ql.debug("Processing websocket message. Type="+t.t);let l=this;switch(t.t){case"CONNECTED":this.Vn(t);break;case"IP_RES":l.clientIP=t.data;break;case"TELNET_DATA":var n=Me(t.B64);this.Gs(n);break;case"CERT_PROMPT":this.callbacks&&this.callbacks.Qs?this.callbacks.Qs(this.Ql.host,t.fp,(t,l)=>{this.Tl.send(JSON.stringify({t:"CERT_RES",a:t})),t||e.info("Rejecting TLS certificate and closing connection. Reason="+l)}):this.Tl.send(JSON.stringify({t:"CERT_RES",a:!0}));break;case"SSH_USER_AUTH_INFO_REQ":this.qi=3,this.Gi=this.Wi,this.Wi=!0,this.Ys=t.prompts,this.Zs=0;var i=[];for(let e=0;e<t.name.length;e++)i.push(t.name.charCodeAt(e));i.push(13);for(let e=0;e<t.inst.length;e++)i.push(t.inst.charCodeAt(e));if(i.push(13),t.prompts.length>0){var s=t.prompts[0];s.e&&ri.rs(i);var r=s.s;for(let t=0;t<r.length;t++)i.push(r.charCodeAt(t));s.e&&ri.hs(i),this.Zs=1,this.tr=[]}var h=xe(i);this.Xn({t:"TELNET_DATA",B64:h});break;case"SSH_USER_AUTH_REQ":this.gi||this.Us(),this.al=0,this.Gi=this.Wi,this.Wi=!0,void 0===this.er||null===this.er?(this.qi=1,this.Mn("login as: "),this.Yi=this.al):(this.Mn("Password rejected by host"),this.lr());break;case"CERT_REJECT":this.Tl.close(4001,"server sent close/error/exception message");break;case"ERR":this.Hn(t);default:Ql.warn("Unhandled websocket message. Type="+t.t)}},ri.prototype.Ds=function(t,e){for(var l=[255,250,t],n=0;n<e.length;n++)l.push(e[n]);l.push(255),l.push(240);var i={t:"VT_INPUT",data:xe(l)};Ql.debug("Sending telnet sub, dump follows"),Te(l,Ql),null!=this.Tl&&this.Tl.send(JSON.stringify(i))},ri.prototype.qs=function(){let t=!1;null==this.Tt&&(t=!0,e.debug("showScreen"),this.Tt=new Gl(this,null,this.Hi?2:1),null!==this.Ml&&void 0!==this.Ml&&this.wn(this.Ml));for(var l=9;l<18;l++)this.kl.vl[l]=32;this.Tt.il(),t&&this.ws&&(this.ws.ii().style.opacity="255")},ri.prototype.nr=function(t,e){var l=this.Ss()+t,n=this.al+e;this.ir(l,n)},ri.prototype.sr=function(t){var e=this.Js(t);this.ir(e.js,e.Ws)},ri.prototype.rr=function(t){var e=Math.max(this.Yi,Math.min(t,this.width));t!=e&&Yl.warn("Column for setcursor abnormal. column="+t+". Set to "+e),this.al=e,this.Tt&&this.Tt.gt&&this.Tt.me()},ri.prototype.ir=function(t,e){this._s&&this.Bi&&(t=this.Bi+t);var l=null!=this.zi&&this._s?this.zi:this.height-1,n=Math.max(0,Math.min(t,l)),i=Math.max(this.Yi,Math.min(e,this.width-1));t==n&&e==i||Yl.warn("Column and row given for setcursor abnormal. column="+e+", row="+t+". Set to column="+i+", row="+n),this.gi=this.hr(n),this.Xi=n,this.al=i,this.Tt&&this.Tt.gt&&this.Tt.me()},ri.prototype.lr=function(){if(this.er){for(var t=this.er+"@"+this.Ql.host+"'s password: ",e=[13,10],l=0;l<t.length;l++)e.push(t.charCodeAt(l));ri.rs(e);var n=xe(e);this.Qi=t.length,this.Yi=t.length,this.qi=2,this.Xn({t:"TELNET_DATA",B64:n})}},ri.prototype.zs=function(t){var e,l;if(("Delete"===t||"Backspace"===t)&&this.qi!=pe)return this.ur(),this.Tt.il(),!0;if("Enter"===t){if(Yl.debug("Handling enter, input state=0x"+Se(this.qi)),1===this.qi){var n=[];for(let t=10;t<this.al;t++){let e=this.gi.rl[t];if(!e||!e.He)break;n.push(e.He)}return this.er=String.fromCharCode.apply(null,n),this.lr(),!0}if(2===this.qi){var i=[];for(let t=this.Qi;t<this.width;t++){let e=this.gi.rl[t];if(!e||!e.He)break;i.push(e.He)}var s=String.fromCharCode.apply(null,i),r=xe([13,10,27,91,48,109]);return this.Xn({t:"TELNET_DATA",B64:r}),this.Wi=this.Gi,this.qi=pe,this.Yi=0,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_RES",m:"password",u:this.er,p:s})),!0}if(3===this.qi){var h=this.Ys[this.Zs-1].length,u=[],o=this.gi;let t;for(let e=h;e<this.width&&(t=o.rl[e])&&t.He;e++)u.push(t.He);if(this.tr.push(String.fromCharCode.apply(null,u)),this.Zs>=this.Ys.length)this.qi=pe,this.Wi=this.Gi,this.Tl.send(JSON.stringify({t:"SSH_USER_AUTH_INFO_RES",res:this.tr}));else{var a=this.Ys[this.Zs++],c=[13];a.e&&ri.rs(c);var f=a.s;for(let t=0;t<f.length;t++)c.push(f.charCodeAt(t));a.e&&ri.hs(c)}return!0}if(this.qi===pe)return this.$i?this.Ns([13,10]):this.Ns([13]),!0}else{var w;if(e=ue[t])return!!(w=this.or?e[2]:this.Di?e[1]:e[0])&&(this.Ns(w),!0);if(null!=(l=q[t])&&16&l)return this.Tn(t),!0;if(this.os){var d=this.os[t];if(null!=d)return this.Ns(d),!0}}return ql.warn("Unhandled VT function="+t),!1},ri.prototype.bs=function(t){if(this.Ee){let e,l=0;-1==t?(e=0,t=1):e=1;for(let n=0;n<t&&this.Ee.ys;n+=e)this.Ee=this.Ee.ys,l++;this.Tt.il(l)}},ri.prototype.vs=function(t){let e,l=this.Ee;for(let t=0;t<this.height+1;t++){if(!l)return;l=l.M}1==t?(e=0,t=-1):e=1,t=0-t;let n=0;for(let i=0;i<t&&(this.Ee=this.Ee.M,n--,l&&l.M);i+=e)l=l.M;this.Tt.il(n)},ri.prototype.ar=function(){for(var t=this.Ee,e=0,l=0;l<this.height&&t.M;l++)t=t.M,e++;if(e<this.height-1)return this.Ci=e,!0;for(;t;)this.Ee=this.Ee.M,t.xe=!0,this.yi=t,t=t.M;return this.Ci=this.height,!0},ri.prototype.cr=function(t){if(Yl.log(Yl.FINEST,"insertChar: "+t+" - posInLine="+this.al+"  width="+this.width+"glidx=0x"+Se(this.Oi)+" gridx=0x"+Se(this.Ui)),null==this.gi)this.ln(!0),this.Us();else if(this.al>=this.width){if(!this.Mi)return void Yl.debug("No implicit wrap, maybe overwrite if not in INSERT mode");if(this.Us(),this.$i)this.rr(0);else for(var e=0;e<this.al;e++)this.cr(32)}var l=new Zn(t);return this.Pi?(l.Be=this.Li[2],this.Pi=!1):this.Ni?(l.Be=this.Li[3],this.Ni=!1):(l.Be=this.Li[this.Oi],l.ze=this.Li[this.Ui]),l.Ge=this.Ge,0!=(8&l.Ge)&&(this.gi.Fe=!0),l.$e=this.$e,l.We=this.We,l.Ze=this.Ze,l.Ye=this.Ye,this.ji===xn?this.gi.rl[this.al++]=l:ri.ss(l,this.al,this.gi),this.gi.xe=!0,l},ri.prototype.Fs=function(t){this.hr(t);for(var e=0,l=this.Ai;e!=t;)l=l.M,e++;return l},ri.prototype.Kn=function(){return this.Bn(this.Ss(),this.al)},ri.prototype.Ss=function(){if(!0===En)return this.Xi;{if(null==this.gi||null==this.Ai)return 0;let l=this.gi.id;for(var t=this.Ai,e=0;t.id!=l;)t=t.M,e++;return this.Xi=e,e}},ri.prototype.hr=function(t){let e=this.Ai;var l=e;t>=this.height&&(Yl.warn("ensureLine requested to check row "+t+" greater than height:"+this.height),t=this.height-1);for(var n=0;n<t&&null!=l;)e=l,l=l.M,n++;if(Yl.log(Yl.FINER,"After ensureline loop, line="+l+", y="+n+", terminalLineNumber="+t),null==l||!l)for(var i=n;i<t+1;i++)l=this.Us(!0);return l},ri.prototype.fr=function(t,e,l){Yl.debug("eraseInLine startColumn="+e+" endColumn="+l);for(var n=e;n<=l;n++)t.rl[n]=null;t.xe=!0},ri.prototype.wr=function(t,e,l,n){if(null!=this.gi&&null!=this.Ai){var i=this.al;-1==e&&(e=i),-1==n&&(n=i),t=Math.max(0,Math.min(t,this.height-1)),e=Math.max(0,Math.min(e,this.width-1)),l=Math.max(0,Math.min(l,this.height-1)),n=Math.max(0,Math.min(n,this.width-1));for(var s=this.Ai,r=0;r<t;){if(null==(s=s.M))return;r++}do{this.fr(s,r==t?e:0,r==l?n:this.width-1),s=s.M,r++}while(r<=l&&s)}},ri.prototype.dr=function(){var t=this.Ss();Yl.debug("cursor row="+t+" cursor="+this.al)},ri.prototype.pr=function(t,e){return 0},ri.prototype.br=function(t,e){return 0},ri.prototype.vr=function(){this.nr(0,-1)},ri.prototype.ur=function(){var t=this.gi;if(this.al>0){var e=this.al-1;this.mr(1,t,e),this.rr(e)}},ri.prototype.As=function(){this.H.height,this.height;let t=this.H.height%this.height;return(this.H.height-t)/this.height};var startVT=function(t,l,n,callbacks,i){let s=t.parentDiv;s.id;let r,h=t.height,u=t.width,o=!1,a=null,c=s;if(n&&n.screenBufferLines){let e=Number(n.screenBufferLines),i=Number(l.screenHeight);if("MAX"==l.screenWidth||"MAX"==l.screenHeight?i=ri.cs(n,c,u,h).height:(l.screenHeight=Number(l.screenHeight),l.screenWidth=Number(l.screenWidth)),e>i){r=e+i,o=!0;let l=h%i;(a=new ti(s,u,h)).wi((h-l)/i,r),u=t.width=u-20,c=ri.fs(s,u,h),s.appendChild(a.ii()),a.li(-1),s.appendChild(c)}}var f=!1;if("MAX"==l.screenWidth||"MAX"==l.screenHeight){f=!0;let t=ri.cs(n,c,u,h);l.screenHeight=t.height,l.screenWidth=t.width}else l.screenHeight=Number(l.screenHeight),l.screenWidth=Number(l.screenWidth);let w=l.screenWidth?l.screenWidth:hn,d=l.screenHeight?l.screenHeight:un;o||(r=d);var p=0,b=1,v=new ri(w,d,r,c);if(v.callbacks=callbacks,i&&(v=Object.assign(v,i)),v.cn(c,t),v.parentDiv=s,v.qn(),v.ks=o,l&&(l.termTypeString&&"string"==typeof l.termTypeString&&(v.termTypeString=l.termTypeString),void 0!==l.termType&&"number"==typeof l.termType&&(v.termType=l.termType),void 0!==l.oiaEnabled&&"boolean"==typeof l.oiaEnabled&&(v.oiaEnabled=l.oiaEnabled?1:0),l.security&&"object"==typeof l.security&&(l.security.type&&"number"==typeof l.security.type&&(p=l.security.type),l.security.badCert&&"number"==typeof l.security.badCert&&(b=l.security.badCert)),l.answerback&&"string"==typeof l.answerback)){for(var m=[],k=0;k<l.answerback.length;k++)m.push(l.answerback.charCodeAt(k));v.answerback=m}return v.termTypeString||ri.as(v),ri.us(v),a&&(v.ws=a,v.ds()),null!==n&&void 0!==n&&(v.Ml=n,null!==n.kr&&void 0!==n.kr&&(v.Pl=n.kr)),v.Hi=f,v.ln(!0),e.debug("connect = "+l.connect),v.Ql={host:l.host,port:Number(l.port),security:p,Cs:b},l.connect?v.connect(l.url,v.Ql):v.Dl=!0,v.fn(),v.H.focus(),v.callbacks&&"function"==typeof v.callbacks.onInit&&v.callbacks.onInit(),v};function hi(t,e){this.Jl=e,this.Vl=t,this.Ul=Nn,this.data=[],this.Ar=new Array(1e3),this.gr=0,this.Cr=[],this.Sr=[],this.Bl=null,this.Hl=[],this.Tr=!0,this.yr=!0,this.Er=!0,this.zl=[],this.Fr=!1,this.xr=[],this.Mr=[]}function ui(t){this.message=t,this.name="VTParseException",en.warn("Encountered exception:"+this.name+", msg:"+t)}Be(hi,gn),hi.Pr=function(t){let e=t.length,l=0;switch(e){case 2:l=31&t[0];break;case 3:l=15&t[0];break;case 4:l=7&t[0];break;case 5:l=3&t[0];break;case 6:l=1&t[0];break;default:throw new Cn("Invalid length ("+e+") of UTF8 buffer")}for(var n=1;n<t.length;n++)l<<=6,l|=63&t[n];return l},ri.prototype.mr=function(t,e,l){if(e&&e.rl){var n=0;for(let i=l+t;i<screen.width;i++)e.rl[l+n]=e.rl[i],n++;for(let t=l+n+1;t<screen.width;t++)e.rl[t]=void 0;e.xe=!0}},ri.prototype.Hs=function(t){var e=ri.ns(t);e&&(Ql.debug("Sending VT message, dump follows"),Te(t,Ql),null!=this.Tl&&this.Tl.send(JSON.stringify(e)))},ri.prototype.Nr=function(){this.Ge=0;var t=null!=this.Bi?this.Bi:0,e=null!=this.zi?this.zi:this.height-1,l=this.Ss();if(l==e&&null!=this.zi){if(this.Es(1,this.Fs(t),t,e,!1),this.nr(1,0),!this.$i)for(let t=0;t<this.al;t++)this.cr(32);this.$i&&this.rr(0)}else if(this.Ls(l))if(this.Us(),this.$i)this.rr(0);else for(let t=0;t<this.al;t++)this.cr(32);else this.nr(1,0),this.$i&&this.rr(0)},hi.prototype.Rr=function(){var t=this.Vl,e=this.Dr();if(0==e.length)t.ir(0,0);else if(1==e.length)t.ir(e[0]-1,0);else{if(2!=e.length)throw new ui("wrong number of params to CSIxf/H -'"+this.Ir()+"'");t.ir(e[0]-1,e[1]-1)}},hi.prototype.Lr=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt102":t=Zt;break;case"vt220":t=te;break;case"vt320":t=ee;break;case"linux":case"xterm":case"vt420":t=le;break;default:t=Zt,Yl.warn("Unknown term type specified:"+e.termTypeString+", sending VT102 string instead.")}e.Hs(t)},hi.prototype._r=function(){let t,e=this.Vl;switch(e.termTypeString){case"vt220":t=ne;break;case"vt320":t=ie;break;case"linux":case"xterm":case"vt420":t=se;break;default:t=ne,Yl.debug("Unknown term type="+e.termTypeString+", sending VT220 string")}t&&(Ql.debug("Sending VT identifier"),e.Hs(t))},hi.prototype.Or=function(t,e){this.Hl.push(255),this.Hl.push(t),this.Hl.push(e)},hi.prototype.Ur=function(){var t=this.Vl,e=this.zl[0];switch(Zl.debug("Handling telnet sub type b=0x"+Se(e)),e){case 31:Zl.debug("-- Telnet Sub=WINDOW_SIZE"),t.Rs();break;case 24:Zl.debug("-- Telnet Sub=TERMINAL_TYPE");let l=[0];for(let e=0;e<t.termTypeString.length;e++)l.push(t.termTypeString.charCodeAt(e));t.Ds(24,l);break;default:Zl.warn("Request for telnet sub of type 0x"+Se(e)+", but is unhandled")}},hi.prototype.Vr=function(t){switch(Zl.debug("Handling telnet option"),Zl.debug("-- b=0x"+Se(t)),this.Bl){case 253:switch(Zl.debug("-- Verb=DO"),t){case 0:this.Or(252,0);break;case 1:e.info("Server requested telnet echo"),this.Vl.Wi=!0,this.Or(251,1);break;case 5:this.Or(254,5);break;case 31:this.Or(251,31),this.Hr=!0,this.Vl.Rs();break;case 32:this.Or(252,32);break;case 24:this.Or(251,24);break;case 3:this.Or(251,3),this.yr=!0;break;default:Zl.warn("Defaulted on DO, sending WONT for b=0x"+Se(t)),this.Or(252,t)}break;case 254:switch(Zl.debug("-- Verb=DONT"),t){case 1:this.Or(252,1),this.Vl.Wi=!1,this.Tr=!0;break;case 31:break;default:this.Or(252,t),Zl.warn("Ignoring DONT for b=0x"+Se(t))}break;case 252:switch(Zl.debug("-- Verb=WONT"),t){case 1:Zl.warn("HOST WONT ECHO BUT WE DO NOT SUPPORT ECHO YET"),this.Vl.Wi=!0,this.Or(251,1);break;default:Zl.warn("Ignoring WONT for b=0x"+Se(t))}break;case 251:switch(Zl.debug("-- Verb=WILL"),t){case 0:this.Or(254,0);break;case 1:this.Er&&this.Or(253,1);break;case 5:this.Or(254,5);break;case 38:this.Or(254,38);break;default:Zl.warn("Ignoring WILL for b=0x"+Se(t))}}!1===this.Fr&&(this.Or(251,31),this.Fr=!0)},hi.prototype.clear=function(){this.Cr=[],this.Sr=[],this.Br=0,this.zr=0,this.xr=[],this.Mr=[]},hi.prototype.Jr=function(t){this.Vl&&(this.Vl.cr(t),Yl.log(Yl.FINER,"Insert to Screen: b=0x"+Se(t)+", char="+String.fromCharCode(t)+", newRow="+this.Vl.Ss()+", newCol="+this.Vl.al))},hi.prototype.jr=function(t){var e=this.Vl;Yl.debug("Execute b=0x"+Se(t));var l=!1;if(null!=e)switch(t){case 0:break;case 5:e.answerback&&Array.isArray(e.answerback)&&e.Ns(e.answerback);break;case 8:e.vr();break;case 9:var n=e.gi.rl;for(let t=e.al+1;t<e.width;t++)if(n[t]||(n[t]=new Zn(32)),e.Zi[t]){e.rr(t);break}break;case 10:case 11:case 12:e.Nr();break;case 13:e.rr(0);break;case 14:e.Oi=1;break;case 15:e.Oi=0;break;case 127:e.ur();break;case 24:case 26:l=!0;break;default:Yl.warn("Unhandled execute b=0x"+Se(t))}return l},hi.prototype.Wr=function(t){if(t<48)this.Sr.push(t);else{if(t<58)throw en.warn("Collect given low value byte, b=0x"+Se(t)),new ui("collect should not get digits");t<64&&(this.Br=t)}},hi.prototype.Gr=function(t){this.Cr.push(t)},hi.prototype.Ir=function(){try{var t=this.Cr;return 0===t.length?"":(en.debug("Param string as hex="),Te(t,en),String.fromCharCode.apply(null,t))}catch(t){return"<OOPS>"}},hi.prototype.$r=function(){try{var t=this.Sr;return en.debug("Intermediate string as hex="),Te(t,en),String.fromCharCode.apply(null,t)}catch(t){return"<OOPS>"}},hi.prototype.Xr=function(t){Yl.warn("Unimplemented: "+t)},hi.prototype.Dr=function(){var t,e=this.Cr,l=[],n=0,i=!1;for(t=0;t<e.length;t++){var s=e[t];if(59==s)l.push(n),i=!1,n=0;else{if(!(s>=48&&s<=57))throw new ui("unexpected numerical parms "+this.Ir());n=10*n+(s-48),i=!0}}i&&l.push(n);var r=new Array(l.length);for(t=0;t<r.length;t++)r[t]=l[t];return en.debug("Numerical params="+JSON.stringify(r)),r},hi.prototype.Kr=function(t){this.Xr("unhandled CSI dispatch character:0x"+Se(t))},hi.prototype.qr=function(t){var e=this.Vl,l=this.Ir();switch(Yl.debug("CSI Dispatch Start:"),Yl.debug("-- b=0x"+Se(t)+", parms="+l+", intermediate="+this.$r()),t){case 64:Yl.debug("-- type=Insert characters"),Yl.debug("IC start, line elements="+JSON.stringify(e.gi.rl));for(var n=si(l,1),i=e.al+n,s=e.gi,r=e.al;r<i;){for(var h=new Zn(32),u=s.rl[r],o=r+1;o<e.width-1;o++){var a=s.rl[o];s.rl[o]=u,u=a}s.rl[r++]=h}s.xe=!0,Yl.debug("IC end, line elements="+JSON.stringify(e.gi.rl));break;case 65:{Yl.debug("-- type=(CUU) Cursor Up");let t=si(l,1);e.nr(-t,0)}break;case 66:{Yl.debug("-- type=(CUD) Cursor Down");let t=si(l,1);e.nr(t,0)}break;case 67:{Yl.debug("-- type=(CUF) Cursor Right");let t=si(l,1);e.nr(0,t)}break;case 68:{Yl.debug("-- type=(CUB) Cursor Left");let t=si(l,1);e.nr(0,-t)}break;case 69:Yl.debug("-- type=(CNL) Cursor Next Line"),this.Kr(t);break;case 70:Yl.debug("-- type=(CPL) Cursor Previous Line"),this.Kr(t);break;case 71:{Yl.debug("-- type=(CHA) Cursor Character Absolute");let t=this.Dr(),l=e.Ss();0==t.length?e.ir(l,0):e.ir(l,t[0]-1)}break;case 72:Yl.debug("-- type=(CUP) Position Cursor"),this.Rr();break;case 73:Yl.debug("-- type=(CHT) Cursor Forward Tab"),this.Kr(t);break;case 74:if(Yl.debug("-- type=(ED) Erase in display"),e.gi)if(63==this.Br)this.Xr("should perform DECSED");else if(""==l||"0"==l){Yl.debug("-- subtype=Erase to End of screen");var c=e.al;let t=e.gi.rl;for(var f=c;f<e.width;f++)t[f]=null;let l=e.gi.M;e.gi.xe=!0;let n=e.Ss();if(n<e.height-1)for(let t=n+1;t<e.height&&l;t++)l.rl=new Array(e.width),l.xe=!0,l=l.M;e.Ge=0}else if("1"==l){Yl.debug("-- subtype=Erase from beginning");let t=e.Ai,l=e.Ss();for(let n=0;n<l;n++)t.xe=!0,t.rl=new Array(e.width),t=t.M;let n=e.gi.rl;for(let t=0;t<e.al+1;t++)n[t]=null;e.gi.xe=!0}else"2"==l?e.ln(!1):"3"==l?(Yl.debug("-- subtype=Erase saved lines"),this.Xr("Erase saved lines (xterm)")):Yl.warn("CSI J / ED / Erase display had unexpected param string="+l);break;case 75:if(Yl.debug("-- type=(EL) Erase in line"),63==this.Br)this.Xr("should perform DECSEL");else{let t=e.Ss();Yl.debug("before eraseRange insertionLine="+t),""==l||"0"==l?(Yl.debug("-- subtype=Erase right"),e.wr(t,-1,t,e.width-1)):"1"==l?(Yl.debug("-- subtype=Erase left"),e.wr(t,0,t,-1)):"2"==l?(Yl.debug("-- subtype=Erase all"),e.wr(t,0,t,e.width-1)):Yl.warn("CSI L / EL / Erase line had unexpected param string="+l)}break;case 76:{Yl.debug("-- type=(IL) Insert lines");let t=e.zi?e.zi:e.height-1,n=e.Bi?e.Bi:0,i=si(l,1);0===i&&(i=1);let s=e.Ss();if(s>t||s<n){Yl.warn("Insert line: requested but current row outside scrolling region, rejecting");break}e.Ps(i,e.gi,s,t,!0),e.rr(0)}break;case 77:{Yl.debug("-- type=(DL) Delete lines");let t=e.zi?e.zi:e.height-1,n=e.Bi?e.Bi:0,i=si(l,1);0===i&&(i=1);let s=e.Ss();if(s>t||s<n){Yl.warn("Delete line: requested but current row outside scrolling region, rejecting");break}let r=e.gi;e.Es(i,r,s,t,!0),e.rr(0)}break;case 80:Yl.debug("-- type=(DCH) Delete characters");var w=si(l,1);0===w&&(w=1);var d=e.al,p=w+d<e.width?w:e.width-1-d,b=e.gi;e.mr(p,b,d);break;case 83:Yl.debug("-- type=(SU) Scroll up"),Yl.warn("PANIC: scroll up not implemented."),e.termType===Bt?this.Xr("Scroll up # lines"):this.Xr("0x53, unknown");break;case 84:Yl.debug("-- type=(SD) Scroll down"),Yl.warn("PANIC: scroll down not implemented."),e.termType===Bt?this.Xr("Scroll down # lines"):this.Xr("0x54, unknown");break;case 88:{Yl.debug("-- type=(ECH) Erase characters"),Yl.debug("Erase characters: WARNING, concern about if allowed to erase characters with erase lock attribute");let t=si(l,1);0===t&&(t=1);let n=e.al,i=t+n<e.width?t:e.width-1-n,s=e.gi;var v=i+n;for(let t=n;t<v;t++)s.rl[t]=null;s.xe=!0}break;case 89:Yl.debug("-- type=(CVT) Character vertical tab"),this.Kr(t);break;case 90:{Yl.debug("-- type=(CBT) Character backward tab"),si(l,1);let t=e.al;if(0!=t)for(let l=t-1;l=0;l--)if(e.Zi[l],1===l){e.rr(l);break}}break;case 96:Yl.debug("-- type=(HPA) Horizontal position absolute"),e.es!=we?(Yl.warn("Cannot handle HPA in decipoint mode"),this.Kr(t)):e.rr(si(l,1)-1);break;case 97:Yl.debug("-- type=(HPR) Horizontal position relative"),this.Kr(t);break;case 98:{let n;if(Yl.debug("-- type=(REP) Repeat previous character"),0==e.al){let t=e.gi.ys;t&&(n=t.rl[t.rl.length-1])}else n=e.gi.rl[e.al-1];if(n&&n.He){let e=n.He;var m=si(l,1);Yl.warn("Should print char=0x"+Se(e)+", "+m+" times"),this.Kr(t)}else{var k=e.Ss();let t=e.Qr;var A=k*e.width+t;Yl.warn("No previous element found for REP, currentpos: r="+k+", c="+t+", pos="+A)}}break;case 99:Yl.debug("-- type=(DA) Device attributes"),63==this.Br?this.Xr("Send Device Attributes Secondary DA"):this.Br&&0!=this.Br?62==this.Br?""==l||"0"==l?this._r():Yl.warn("Unhandled device attribute command, privateChar = >, paramString="+l):this.Xr("0x63 with privateChar="+Se(this.Br)):this.Lr();break;case 100:if(Yl.debug("-- type=(VPA) Line position absolute"),e.es!=we)this.Xr("VPA with decipoint");else{var g=si(l,1);e.hr(g-1),e.ir(g-1,this.Vl.al)}break;case 101:Yl.debug("-- type=(VPR) Line position relative"),this.Kr(t);break;case 102:Yl.debug("-- type=(HVP) Horizontal vertical position"),this.Rr();break;case 103:if(Yl.debug("-- type=(TBC) Tab clear"),""==l||"0"==l)e.Zi[e.al]=0;else if("1"==l)Yl.warn("Not implemented: Tab clear of vertical tab stop");else if("2"==l)e.Zi=ri.ts();else{if("3"!=l)throw new ui("Unexpected parameter for tab clear -'"+l+"'");e.Zi=ri.ts()}break;case 104:Yl.debug("-- type=(SET) mode set");var C=this.Dr();if(63==this.Br)for(let t=0;t<C.length;t++){let l=C[t];switch(l){case 1:e.Di=1;break;case 2:e.or=!1;break;case 3:e.rr(0),e.pn(132,24);break;case 5:e.Tt.tl();break;case 6:e._s=!0,e.ir(0,0);break;case 7:e.Mi=!0;break;case 12:e.Tt.De();break;case 25:e.Tt.Ne();break;case 11:Yl.warn("Not implemented: decipoints instead of row/column");case 64:break;default:this.Xr("mode setting case=?"+l)}}else{if(0===C.length){this.Xr("Mode setting default case");break}for(let t=0;t<C.length;t++){let e=C[t];switch(e){case 2:Yl.debug("Mode setting: lock keyboard"),this.Vl.Ji=!0;break;case 4:Yl.debug("Mode setting: insert mode"),this.Vl.ji=1;break;case 12:Yl.debug("Mode setting: send/receive mode (SRM), local echo off"),this.Vl.Wi=!1;break;case 20:Yl.debug("Setting LNM true"),this.Vl.$i=!0;default:this.Xr("Mode setting case="+e)}}}break;case 105:Yl.debug("-- type=(MC) media copy"),this.Xr("various printing options");break;case 108:{Yl.debug("-- type=(RM) mode reset");let t=this.Dr();if(63==this.Br)for(let l=0;l<t.length;l++){let n=t[l];switch(n){case 1:e.Di=0;break;case 2:e.or=!0;break;case 3:e.rr(0),e.pn(80,24);break;case 5:e.Tt.ll();break;case 6:e._s=!1,e.ir(0,0);break;case 7:e.Mi=!1;break;case 12:e.Tt.Re();break;case 25:e.Tt.Me();break;case 34:case 64:break;case 1e3:this.Xr("Xterm mode resetting: dont send mouse x&y on button press & release");break;case 1001:this.Xr("Xterm mode resetting: dont use hilite mouse tracking");break;case 1002:this.Xr("Xterm mode resetting: dont use cell motion mouse tracking");break;case 1003:this.Xr("Xterm mode resetting: dont use all motion mouse tracking");break;case 1004:this.Xr("Xterm mode resetting: dont send focusin/focusout events");break;case 1005:this.Xr("Xterm mode resetting: disable utf-8 mouse mode");break;case 1006:this.Xr("Xterm mode resetting: disable sgr mouse mode");break;case 1007:this.Xr("Xterm mode resetting: disable alternate scroll mode");break;case 1010:this.Xr("Xterm mode resetting: dont scroll to bottom on tty output (rxvt)");break;case 1011:this.Xr("Xterm mode resetting: dont scroll to bottom on key press (rxvt)");break;case 1015:this.Xr("Xterm mode resetting: disable urxvt mouse mode");break;case 1034:this.Xr("Xterm mode resetting: dont interpret meta key");break;case 11:Yl.warn("Not implemented: decipoints instead of row/column");default:this.Xr("Suspected Xterm mode resetting, b="+n)}}else{if(0===t.length){this.Xr("Mode resetting default case");break}for(let e=0;e<t.length;e++){let l=t[e];switch(l){case 2:Yl.debug("Mode resetting: lock keyboard"),this.Vl.Ji=!1,Yl.debug("Mode resetting warning: not supposed to unlock if locked by DC3");break;case 4:Yl.debug("Mode resetting: replace mode"),this.Vl.ji=xn;break;case 12:Yl.debug("Mode setting: send/receive mode (SRM), local echo on"),this.Vl.Wi=!0;break;case 20:Yl.debug("Resetting LNM false"),this.Vl.$i=!1;default:this.Xr("Mode resetting case="+l)}}}}break;case 109:{Yl.debug("-- type=(SGR) set graphics rendition");let t=this.Dr();0==t.length&&(t=[0]);let n=0;for(;n<t.length;){let i=t[n];switch(i){case 0:e.Ge=0,e.$e=ri.Xe,e.We=0,e.Ze=ri.Xe,e.Ye=0,n++;break;case 1:e.Ge|=16,e.Ge&=-33,n++;break;case 2:e.Ge&=-17,e.Ge|=32,n++;break;case 4:e.Ge|=4,n++;break;case 5:e.Ge|=8,n++;break;case 7:e.Ge|=2,n++;break;case 8:e.Ge|=64,n++;break;case 21:e.Ge&=-17;break;case 22:e.Ge&=-17,e.Ge&=-33,n++;break;case 24:e.Ge&=-5,n++;break;case 25:e.Ge&=-9,n++;break;case 27:e.Ge&=-3,n++;break;case 28:e.Ge&=-65,n++;break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:e.$e=ri.Ke,e.We=i-30,Yl.debug("Set color mode=STANDARD, value=0x"+Se(e.We)),n++;break;case 38:if(n+1<t.length&&5==t[n+1])n+2<t.length?(e.$e=ri.qe,e.We=t[n+2],Yl.debug("Set color mode=TABLE, value=0x"+Se(e.We)),n+=2):(Yl.warn("Could not set color mode, bad TABLE color parameter="+l),n++);else if(n+1<t.length&&2==t[n+1])if(n+4<t.length){let l=Math.max(0,Math.min(255,t[2])),i=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.$e=ri.Qe,e.We=l<<16|i<<8|s,Yl.debug("Set color mode=RGB, value=0x"+Se(e.We)),n+=4}else Yl.warn("Could not set color mode, bad RGB color parameter="+l),n++;else Yl.warn("Unexpected parameter for SGM="+l),n++;break;case 39:e.$e=ri.Xe,e.We=0,e.Ge&=-17,e.Ge&=-33,Yl.debug("Set color mode=DEFAULT"),n++;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:e.Ze=ri.Ke,e.Ye=i-40,Yl.debug("Set bg color mode=STANDARD, value=0x"+Se(e.We)),n++;break;case 48:if(n+1<t.length&&5==t[n+1])n+2<t.length?(e.Ze=ri.qe,e.Ye=t[n+2],Yl.debug("Set bg color mode=TABLE, value=0x"+Se(e.Ye)),n+=2):(Yl.warn("Could not set bg color mode, bad TABLE color parameter="+l),n++);else if(n+1<t.length&&2==t[n+1])if(n+4<t.length){let l=Math.max(0,Math.min(255,t[2])),i=Math.max(0,Math.min(255,t[3])),s=Math.max(0,Math.min(255,t[4]));e.Ze=ri.Qe,e.Ye=l<<16|i<<8|s,Yl.debug("Set bg color mode=RGB, value=0x"+Se(e.Ye)),n+=4}else Yl.warn("Could not set bg color mode, bad RGB color parameter="+l),n++;else Yl.warn("Unexpected parameter for bg SGM="+l),n++;break;case 49:e.Ze=ri.Xe,e.Ye=0,Yl.debug("Set bg color mode=DEFAULT"),n++;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:e.$e=ri.Ke,e.We=i-90,e.Ge|=16,e.Ge&=-33,Yl.debug("Set color mode=STANDARD BOLD, value=0x"+Se(e.We)),n++;break;default:Yl.warn("Unexpected graphic rendering value="+t[n]+" in parameters="+l),n++}}}break;case 110:{Yl.debug("-- type=(DSR) device status report");let t=this.Dr();if(63==this.Br)this.Xr("DSR with ? mark");else if(t&&void 0!==t[0])switch(t[0]){case 5:{let t=[27,91,48,110];e.Hs(t)}break;case 6:{var S=String(e.Ss()+1),T=String(e.al+1);let t=[27,91];for(let e=0;e<S.length;e++)t.push(S.charCodeAt(e));t.push(59);for(let e=0;e<S.length;e++)t.push(T.charCodeAt(e));t.push(82),e.Hs(t)}break;default:this.Xr("Device Status Report (DSR) case"+t)}}break;case 112:{let t=this.Dr();if(this.Sr&&34==this.Sr[0]&&(Yl.debug("-- type=(STR) Soft terminal reset"),t.length>0))switch(t[0]){case 61:this.Yr=!0;break;case 62:if(t.length>1)switch(t[1]){case 0:this.Yr=!1;break;case 1:case 2:this.Yr=!1}else this.Yr=!1}}break;case 113:Yl.debug("-- type=(SCA) set character protection attributes"),this.Xr("select character attributes");break;case 114:{Yl.debug("-- type=(STBM) set top and bottom margins");let t=this.Dr();2!=t.length?(e.Bi=0,e.zi=e.height-1):(e.Bi=null,e.zi=null,e.hr(t[1]-1),e.Bi=t[0]-1,e.zi=t[1]-1),e.ir(0,0)}break;case 115:Yl.debug("-- type=(LRMM) set left & right margins (if enabled) ELSE (SCP) save cursor position"),this.Xr("DECLRMM: Set left/right margins OR (xterm): if DECLRMM disabled save cursor");break;case 116:Yl.debug("-- type=(RARA) Reverse attributes in rectangle"),this.Kr(t);break;case 118:Yl.debug("-- type=(CRA) Copy rectangle");break;case 119:Yl.debug("-- type=(EFR) Enable filter rectangle"),this.Kr(t);break;case 120:Yl.debug("-- type=(REQTPARM) Request terminal parameters OR (FRA) Fill rectangular");break;case 121:Yl.debug("-- type=(SACE) Select attribute change extent"),this.Kr(t);break;case 122:Yl.debug("-- type=(DECERA)  (ERA) Erase rectangular");break;default:this.Xr("unhandled CSI dispatch character:0x"+Se(t))}},hi.prototype.Zr=function(){let t=this.Vl,e=this.Mr,l=Number(String.fromCharCode.apply(null,this.xr));switch(Yl.debug("OSC dispatch: type="+l+", params="+e),l){case 0:let n=String.fromCharCode.apply(null,e);t.callbacks.titleCallback&&t.callbacks.titleCallback(n);break;case 4:this.Xr("OSC change color");break;case 5:this.Xr("OSC change special color");break;case 10:this.Xr("Change text color w/ OSC4 spec");break;case 11:this.Xr("Change backkground color w/ OSC4 spec");break;case 15:this.Xr("Change TEK text color w/ OSC4 spec");break;case 16:this.Xr("Change TEK background color w/ OSC4 spec");break;case 52:this.Xr("OSC clipboard access");break;case 104:this.Xr("Reset color number");break;case 105:this.Xr("Reset special color number");break;case 110:this.Xr("Reset window text color");break;case 111:this.Xr("Reset window background color");break;case 115:this.Xr("Reset TEK window text color");break;case 116:this.Xr("Reset TEK window background color");break;default:Yl.warn("Unknown OSC type "+l+" encountered with params="+e)}},hi.prototype.th=function(t){let e=this.Vl;Yl.debug("Escape Dispatch Start:"),Yl.debug("-- b=0x"+Se(t)),this.Ar[this.gr++]=t,Te(this.Ar,Yl,0,this.gr);var l=255&this.Ar[1];switch(l){case 32:var n=255&this.Ar[2];if(e.Yr||e.or)e.Ii=!1;else switch(n){case 70:e.Ii=!1;break;case 71:e.Ii=!0}break;case 35:if(this.Ar.length<2)throw new Cn("Encountered escape # without following byte to determine action");{let t=255&this.Ar[2];switch(t){case 51:if(e.Ge|=256,e.Ge&=-129,e.Ge&=-513,e.gi&&e.gi.rl)for(let t=0;t<e.gi.rl.length;t++)e.gi.rl[t]&&(e.gi.rl[t].Ge=e.Ge);break;case 52:if(e.Ge|=512,e.Ge&=-257,e.Ge&=-129,e.gi&&e.gi.rl)for(let t=0;t<e.gi.rl.length;t++)e.gi.rl[t]&&(e.gi.rl[t].Ge=e.Ge);break;case 53:if(e.Ge&=-129,e.Ge&=-257,e.Ge&=-513,e.gi&&e.gi.rl)for(let t=0;t<e.gi.rl.length;t++)e.gi.rl[t]&&(e.gi.rl[t].Ge=e.Ge);break;case 54:if(e.Ge|=128,e.Ge&=-257,e.Ge&=-513,e.gi&&e.gi.rl)for(let t=0;t<e.gi.rl.length;t++)e.gi.rl[t]&&(e.gi.rl[t].Ge=e.Ge);break;case 56:var i=e.Ai;i||(e.Us(),i=e.Ai);for(var s=0;s<e.height;s++){for(var r=0;r<e.width;r++)i.rl[r]?i.rl[r].Zn=69:i.rl[r]=new Zn(69);i.M||e.Us(),i=i.M}break;default:this.Xr("escape dispatch byte 0x23, modifier "+t)}}break;case 37:if(this.Ar.length<2)this.eh("Escape % seen with no following char");else{let t=255&this.Ar[2];switch(t){case 64:e.je=!1;break;case 71:e.je=!0;break;default:Yl.warn("Unhandled ESC % byte=0x"+Se(t)+" assumed to be used for UTF8")}}break;case 40:case 41:case 42:case 43:if(3==this.gr){var h=255&this.Ar[2];Yl.debug("should set Gx x=0x"+Se(l-40)+" to 0x"+h),e.Li[l-40]=t}else Yl.warn("unhandled set G0-G3 case");break;case 55:e.lh={gi:e.gi,Xi:e.Xi,al:e.al,Ge:e.Ge,$e:e.$e,We:e.We,Li:e.Li};break;case 56:e.lh?(e.gi=e.lh.gi,e.Xi=e.lh.Xi,e.al=e.lh.al,e.Ge=e.lh.Ge,e.$e=e.lh.$e,e.We=e.lh.We,e.Li=e.lh.Li):Yl.warn("Dont have saved attributes to restore from for escape 0x38");break;case 60:e.or=!1;break;case 61:e.ls=!0;break;case 62:e.ls=!1;break;case 65:Yl.debug("-- type=VT52 Cursor Up"),e.nr(-1,0);break;case 66:Yl.debug("-- type=VT52 Cursor Down"),e.nr(1,0);break;case 67:Yl.debug("-- type=VT52 Cursor Right"),e.nr(0,1);break;case 68:if(e.or)Yl.debug("-- type=VT52 Cursor Left"),e.nr(0,-1);else{Yl.debug("-- type=(IND) Index down");var u=null!=e.Bi?e.Bi:0,o=null!=e.zi?e.zi:e.height-1;e.Ss()==o&&e.Es(1,e.Fs(u),u,o,!1),e.nr(1,0)}break;case 69:e.nr(1,0),e.rr(0);break;case 72:if(e.or){Yl.debug("-- type=Move cursor home");var a=e.Ss();e.ir(a,0)}else Yl.debug("-- type=(HTS) Horizontal Tab set"),e.Zi[e.al]=1;break;case 73:break;case 77:{Yl.debug("-- type=(RI) Reverse Index");let t=null!=e.Bi?e.Bi:0,l=null!=e.zi?e.zi:e.height-1;e.Ss()==t&&e.Ps(1,e.Fs(t),t,l,!1),e.nr(-1,0)}break;case 78:e.Pi=!0;break;case 79:e.Ni=!0;break;case 80:this.Xr("P!");break;case 90:break;case 92:Yl.debug("escapeDispatch 0x5C string terminator ");break;case 95:Yl.debug("unimplemented escape code 0x5F");break;case 99:this.Xr("Hard Terminal Reset");break;case 125:Yl.warn("need to set G2 ");break;default:this.Xr("unhandled ESCAPE dispatch character=0x"+Se(l))}this.Br=0},hi.prototype.nh=function(t){return t<=23||25==t||t>=28&&t<32},hi.prototype.ih=function(t){return t<=23||25==t||t>=28&&t<32||127==t},hi.prototype.sh=function(t){if(t<192)throw new Cn("UTF8 cannot have first byte below C0");var e=255&~t;if(e>=32)this.rh=1;else if(e>=16)this.rh=2;else if(e>=8)this.rh=3;else if(e>=4)this.rh=4;else{if(!(e>=2))throw new Cn("Unexpectedly high first byte value for UTF8");this.rh=5}},hi.prototype.$s=function(t){en.debug("Parser Loop Top: b=0x"+Se(t)+" state="+hi.hh[this.Ul]);var e=0;switch(this.Ul){case Nn:this.ih(t)?(this.jr(t),e=Nn):t<32||(255===t?e=12:!0===this.Vl.je&&t>=192&&t<=253?(this.uh=[],this.uh.push(t),this.sh(t),e=17):94==t?e=18:t>127||this.Jr(t)),12!=e&&(this.Vl.Ll=!0);break;case 18:if(this.ih(t))this.Jr(94),this.jr(t),e=Nn;else if(t<32)this.Jr(94),this.Ul=Nn;else if(255===t)this.Jr(94),e=12;else if(t>=192&&t<=253)this.Jr(94),this.uh=[],this.uh.push(t),this.sh(t),e=17;else{switch(t){case 72:case 63:2===this.Vl.Ki?this.Vl.ur():1===this.Vl.Ki?this.Vl.vr():this.Vl.Ki!=_t&&(this.Jr(94),this.Jr(t));break;default:this.Jr(94),this.Jr(t)}e=Nn}break;case 17:if(this.uh.push(t),this.rh--,0===this.rh){var l=hi.Pr(this.uh);this.Jr(l),e=Nn}break;case 12:switch(this.Bl=t,this.Bl){case 255:e=Nn,this.Jr(t);break;case 250:e=14;break;case 251:case 252:case 253:case 254:e=13;break;case 247:this.jr(127);break;case 240:case 242:case 241:case 249:default:e=Nn}break;case 13:this.Vr(t),e=Nn;break;case 14:if(255===t){this.Ur(),e=12;break}this.zl.push(t),e=14;break;case 10:t>=32&&t<48?(this.Wr(t),e=19):t>=48&&t<64||59==t?(this.Gr(t),e=20):t>=60&&t<64?(this.Wr(t),e=20):58==t?e=22:t>=64&&t<127&&(e=21);break;case 19:t>=32&&t<48?(this.Wr(t),e=19):t>=48&&t<64?e=22:t>=64&&t<127&&(e=21);break;case 20:t>=48&&t<64||59==t?(this.Gr(t),e=20):58==t||t>=60&&t<64?e=22:t>=32&&t<48?(this.Wr(t),e=19):t>=64&&t<127&&(e=21);break;case 22:this.oh?(92==t&&(e=Nn),this.oh=!1):156==t?e=Nn:27==t&&(this.oh=!0,e=22);break;case 21:this.oh?(92==t&&(e=Nn),this.oh=!1):27==t?(this.oh=!0,e=21):(Yl.warn("DCS Passthrough unimplemented"),e=21);break;case 7:if(this.nh(t))e=this.jr(t)?Nn:7;else{if(this.gr=0,this.Ar[this.gr++]=27,this.Ar[this.gr++]=t,t<32)throw new ui("VT_ESCAPE_START sees b<0x20");if(t>=32&&t<48)e=8;else switch(en.debug("escape dispatch main switch"),t){case 80:e=10;break;case 91:e=2;break;case 93:e=6;break;default:if(!(t<127))throw new ui("VT_ESCAPE_START sees b>=0x7f");this.th(t),e=Nn}}break;case 8:if(this.nh(t))e=this.jr(t)?Nn:8;else{if(t<32)throw new ui("unhandled byte=0x"+Se(t)+" in VT_ESCAPE_INTERMEDIATE");t<48?(this.Wr(t),e=8):t<127?(this.th(t),e=Nn):127==t&&(e=8)}break;case 6:t>=32&&t<=127&&(this.xr.push(t),e=15);break;case 15:59===t?e=16:this.xr.push(t);break;case 16:7===t||156===t?(this.Zr(),e=Nn):this.Mr.push(t);break;case 2:this.nh(t)?e=this.jr(t)?Nn:2:t>=32&&t<48?(this.Wr(t),e=3):t<58?(this.Gr(t),e=5):t<60?58==t?e=4:(e=5,this.Gr(t)):t<64?(this.Wr(t),e=5):t<127?(this.qr(t),e=Nn):t<2&&(e=2);break;case 5:if(this.nh(t))e=this.jr(t)?Nn:5;else if(t>=32&&t<48)this.Wr(t),e=3;else if(t>=48&&t<58||59==t)this.Gr(t),e=5;else if(58==t||t>=60&&t<64)e=4;else{if(!(t<127))throw new ui("unhandled byte "+t+" in VT_CSI_PARAM");this.qr(t),e=Nn}break;case 4:if(this.nh(t))e=this.jr(t)?Nn:4;else{if(t<32)throw new ui("unhandled byte "+t+" in VT_CSI_IGNORE");if(t<64||127==t)e=4;else{if(!(t<127))throw new ui("unhandled byte "+t+" in VT_CSI_IGNORE");e=Nn}}break;case 3:if(this.nh(t))e=this.jr(t)?Nn:3;else{if(t<32)throw new ui("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");if(t<48)this.Wr(t),e=3;else if(t<64)e=4;else if(t<127)this.qr(t),e=Nn;else{if(127!=t)throw new ui("unhandled byte "+t+" in VT_CSI_INTERMEDIATE");e=3}}}if(12!==e&&14!==e&&13!==e&&(this.Vl._l=2),0==e)switch(t){case 27:this.Ul=7;break;case 155:this.Ul=2,this.clear(),this.gr=0,this.Ar[this.gr++]=27,this.Ar[this.gr++]=91;break;case 157:this.Ul=6}else{if(this.Ul!=e)switch(e){case 6:case 2:case 7:case 10:this.clear()}this.Ul=e}},hi.hh=["NO_STATE","VT_BASE","VT_CSI_START","VT_CSI_INTERMEDIATE","VT_CSI_IGNORE","VT_CSI_PARAM","VT_OSC_STRING","VT_ESCAPE_START","VT_ESCAPE_INTERMEDIATE","VT_SOS_PM_APC","VT_DCS_START","VTF","VT_TELNET_VERB","VT_TELNET_OPTION","VT_TELNET_SUB","VT_OSC_INTERMEDIATE","VT_OSC_PARAM","VT_UTF8","VT_CONTROL_CHAR","VT_DSC_INTERMEDIATE","VT_DCS_PARAM","VT_DCS_PASSTHROUGH","VT_DCS_IGNORE"];